{
  "name": "sw_expert_humor_energia",
  "nodes": [
    {
      "parameters": {
        "workflowInputs": {
          "values": [
            {
              "name": "usuario_id"
            },
            {
              "name": "mensagens"
            },
            {
              "name": "data_conversa"
            },
            {
              "name": "chat_id"
            },
            {
              "name": "usr_name"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        112,
        144
      ],
      "id": "f81a010a-e7b8-4eef-ab5a-fe632d471c6f",
      "name": "start"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Analise a conversa completa abaixo e detecte o HUMOR e ENERGIA do usu√°rio com base APENAS no que foi dito.\n\n**CONVERSA COMPLETA:**\n```json\n{{ $json.mensagens }}\n```\n\nUser name: {{ $json.name }}\n\n**SUA TAREFA:**\n1. Leia TODA a conversa (autor: \"usuario\" apenas)\n2. Detecte o HUMOR GERAL do dia (1-10):\n   - 1-3: muito negativo (tristeza profunda, desesperan√ßa)\n   - 4-5: negativo (des√¢nimo, frustra√ß√£o)\n   - 6-7: neutro/misto (altos e baixos)\n   - 8-9: positivo (animado, esperan√ßoso)\n   - 10: muito positivo (euf√≥rico, excelente)\n\n3. Detecte o N√çVEL DE ENERGIA (1-10):\n   - 1-3: exausto, sem for√ßas\n   - 4-5: cansado, baixa energia\n   - 6-7: energia moderada\n   - 8-9: disposto, energizado\n   - 10: muito energizado, hiperativo\n\n4. Identifique VARIA√á√ÉO durante a conversa:\n   - estavel: humor/energia constante\n   - ascendente: melhora ao longo da conversa\n   - descendente: piora ao longo da conversa\n   - oscilatoria: alterna muito\n\n5. Detecte PER√çODO DO DIA (se mencionado):\n   - manha, tarde, noite, madrugada\n   - Se n√£o mencionado: \"nao_identificado\"\n\n**REGRAS:**\n- Base a an√°lise APENAS nas palavras do usu√°rio\n- Considere: tom emocional, vocabul√°rio, descri√ß√µes de atividades\n- Seja preciso e realista\n- Justifique brevemente cada score\n- Ao gerar a justificativa e resumo das conversas relacionados com o humor, use sempre o nome do usu√°rio: {{ $json.name }}\n- Caso o nome do usu√°rio n√£o seja informado, use o termo Usu√°rio\n**RETORNE APENAS O JSON ESTRUTURADO**",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "Voc√™ √© um especialista em an√°lise de humor e energia em conversas.\n\nSeu trabalho √©:\n1. Detectar o humor geral do dia (escala 1-10)\n2. Avaliar o n√≠vel de energia (escala 1-10)\n3. confianca_analise de 0 a 100\n4. Identificar varia√ß√µes durante a conversa\n5. Capturar per√≠odo do dia se mencionado\n\nSeja objetivo, baseie-se apenas no texto real, e justifique suas avalia√ß√µes de forma breve.\n\nRetorne SEMPRE um JSON v√°lido com a estrutura exata solicitada.",
          "maxIterations": 3
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        352,
        144
      ],
      "id": "e04ad84a-70be-4a4b-b8c6-a92a118b4219",
      "name": "Analisador Humor & Energia"
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"humor_dia\": 4,\n  \"energia_nivel\": 6,\n  \"variacao_humor\": \"descendente\",\n  \"variacao_energia\": \"estavel\",\n  \"periodo_dia\": \"tarde\",\n  \"justificativa_humor\": \"Usu√°rio come√ßou o dia produtivo e animado, mas ao final relata tristeza profunda, ang√∫stia e desmotiva√ß√£o ap√≥s ver fotos da ex-mulher\",\n  \"justificativa_energia\": \"Menciona que caminhou bastante, fez almo√ßo, trabalhou no app - energia moderada/boa, mas manteve disposi√ß√£o f√≠sica apesar da queda emocional\",\n  \"evidencias_textuais\": [\n    \"dia estava muito bom hoje, muito produtivo\",\n    \"estava disposto, animado\",\n    \"bateu uma coisa muito ruim\",\n    \"ang√∫stia, uma tristeza muito grande\",\n    \"muito desmotivado e desanimado\"\n  ],\n  \"confianca_analise\": 95\n}",
        "autoFix": true
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        464,
        368
      ],
      "id": "452b0b86-3402-422e-b71c-f55a9862f550",
      "name": "Parser JSON Humor"
    },
    {
      "parameters": {
        "options": {
          "maxTokens": 1000,
          "temperature": 0.2
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        320,
        496
      ],
      "id": "92b2b15b-7e90-4cfa-b048-d70c2c6d7c9e",
      "name": "OpenRouter Claude",
      "credentials": {
        "openRouterApi": {
          "id": "rSnkOnnAHyfayLJt",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "INSERT INTO usuarios_humor_energia (\n  usuario_id,\n  chat_id,\n  data_registro,\n  hora_registro,\n  periodo_dia,\n  humor_dia,\n  energia_nivel,\n  variacao_humor,\n  variacao_energia,\n  justificativa_humor,\n  justificativa_energia,\n  evidencias_textuais,\n  confianca_analise\n)\nVALUES (\n  $1::uuid,\n  $2::uuid,\n  $3::date,\n  CURRENT_TIME,\n  $4::varchar(20),\n  $5::integer,\n  $6::integer,\n  $7::varchar(20),\n  $8::varchar(20),\n  $9::text,\n  $10::text,\n  $11::jsonb,\n  $12::integer\n)\nRETURNING \n  id,\n  usuario_id,\n  chat_id,\n  data_registro,\n  hora_registro,\n  humor_dia,\n  energia_nivel,\n  variacao_humor,\n  variacao_energia,\n  periodo_dia;",
        "options": {
          "queryReplacement": "=[\n  {{ $('start').item.json.usuario_id }},                       // 1\n  {{ $('start').item.json.chat_id }},                          // 2\n  {{ ((v) => v ? new Date(v).toISOString().slice(0,10) : null)($('start').item.json.data_conversa) }}, // 3\n\n  {{ $json.output.periodo_dia }},                              // 4\n  {{ $json.output.humor_dia }},                                // 5\n  {{ $json.output.energia_nivel }},                            // 6\n  {{ $json.output.variacao_humor }},                           // 7\n  {{ $json.output.variacao_energia }},                         // 8\n  {{ JSON.stringify($json.output.justificativa_humor) }},      // 9\n  {{ JSON.stringify($json.output.justificativa_energia) }},    // 10\n  {{ JSON.stringify($json.output.evidencias_textuais) }},      // 11\n  {{ $json.output.confianca_analise }}                         // 12\n]\n"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        672,
        144
      ],
      "id": "314f2218-cb5a-4dd0-89e3-6a151cebe730",
      "name": "Gravar Humor & Energia",
      "credentials": {
        "postgres": {
          "id": "8ySWxtSO7gYK5uue",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        880,
        144
      ],
      "id": "9bb9c8bf-8c93-4cf3-a699-f65c2d7c3567",
      "name": "Edit Fields"
    }
  ],
  "pinData": {
    "start": [
      {
        "json": {
          "usuario_id": "8bc57788-8534-45a9-98be-39dc81ef4e6a",
          "mensagens": "[{\"interaction\":1,\"autor\":\"usuario\",\"texto\":\"Hoje eu estou fazendo um relato do dia de ontem, porque ontem eu n√£o deixei nenhum √°udio, ainda estou fazendo alguns ajustes aqui no sistema. Ontem foi um dia bastante produtivo, consegui evoluir bastante no meu app. Estava me sentindo bastante feliz, consegui me pegar por v√°rios momentos do dia cantando, dan√ßando alegremente ali, bem tranquilo e foi um dia bastante positivo.\",\"timestamp\":\"2025-10-08T10:47:13.159Z\"},{\"interaction\":1,\"autor\":\"agente\",\"texto\":\"Aldo, √© muito positivo perceber como a satisfa√ß√£o com o progresso do seu app trouxe momentos de leveza e alegria no seu dia. Esse equil√≠brio entre produtividade e prazer √© fundamental para manter sua motiva√ß√£o em alta. Como voc√™ percebe que esses momentos de conex√£o com seu trabalho impactam suas outras √°reas da vida, especialmente nos dias em que est√° mais produtivo e feliz?\",\"timestamp\":\"2025-10-08T10:47:13.159Z\"},{\"interaction\":2,\"autor\":\"usuario\",\"texto\":\"Ent√£o, eu me sinto mais completo, n√©? Porque assim, como eu falei em outros √°udios, eu procuro manter equil√≠brio em todas as √°reas da minha vida. Mas a financeira e a de trabalho, quando ela est√° bastante evolu√≠da e eu estou conseguindo alcan√ßar meus objetivos, minhas tarefas, meus prop√≥sitos, eu me sinto bastante completo e ameniza bastante as outras quest√µes de solid√£o e etc.\",\"timestamp\":\"2025-10-08T10:47:13.159Z\"},{\"interaction\":2,\"autor\":\"agente\",\"texto\":\"Aldo, √© claro que quando as √°reas financeira e profissional est√£o alinhadas com seus objetivos, isso traz uma sensa√ß√£o profunda de completude e equil√≠brio. Essa for√ßa que voc√™ encontra nessas conquistas pode realmente ser um suporte valioso diante dos desafios emocionais que mencionou. Quais estrat√©gias ou recursos voc√™ tem utilizado para manter esse equil√≠brio constante entre trabalho, finan√ßas e seu bem-estar emocional?\",\"timestamp\":\"2025-10-08T10:47:13.159Z\"},{\"interaction\":3,\"autor\":\"usuario\",\"texto\":\"A estrat√©gia que eu uso na quest√£o financeira √© tomar o m√°ximo de cuidado, cuidando a√≠ com a quest√£o do risco, para n√£o perder dinheiro, porque eu estou com a meta bastante ousada a√≠ de recuperar o dinheiro que eu perdi ao longo desse ano, ent√£o √© bastante desafiador, eu tenho que manter sempre a aten√ß√£o. E na quest√£o do trabalho, como eu j√° falei em outros √°udios, eu estando motivado, acreditando no sucesso daquilo que eu estou fazendo, eu consigo encontrar energia. Eu estando com esses dois pilares em andamento, eu j√° me sinto bastante forte, fortalecido. Eu tenho tr√™s metas macro importantes para esse ano. Primeiro √© recuperar o valor que eu perdi e terminar esse ano com o mesmo patrim√¥nio que eu iniciei. lan√ßar o meu app at√© final do ano e encontrar um relacionamento que eu me empolgue e tenha vontade de continuar com ele.\",\"timestamp\":\"2025-10-08T10:47:13.159Z\"},{\"interaction\":3,\"autor\":\"agente\",\"texto\":\"Aldo, entendo que voc√™ est√° adotando uma postura bastante cuidadosa com a quest√£o financeira, focando na gest√£o de riscos para recuperar as perdas desse ano, o que representa um desafio consider√°vel. Al√©m disso, voc√™ encontra muita energia e motiva√ß√£o para o trabalho quando acredita no sucesso dos seus projetos, especialmente na meta de lan√ßar seu app at√© o final do ano. Outro ponto importante que voc√™ destacou √© o desejo de encontrar um relacionamento que realmente te empolgue e que voc√™ queira continuar, o que mostra que est√° atento a buscar equil√≠brio n√£o s√≥ nas √°reas financeira e profissional, mas tamb√©m na afetiva.\\n\\nPontos principais:\\n- Cuidado rigoroso na quest√£o financeira para evitar novos riscos e recuperar perdas.\\n- Motiva√ß√£o intensa no trabalho vinculada √† cren√ßa no sucesso e alcance de metas.\\n- Tr√™s metas macro para o ano: recupera√ß√£o financeira, lan√ßamento do app e relacionamento significativo.\\n- Busca por equil√≠brio e fortalecimento pessoal por meio desses pilares.\\n\\nConsegui entender bem sua situa√ß√£o?\",\"timestamp\":\"2025-10-08T10:47:13.159Z\"},{\"interaction\":4,\"autor\":\"usuario\",\"texto\":\"sim est√° correto\",\"timestamp\":\"2025-10-08T10:47:13.159Z\"},{\"interaction\":4,\"autor\":\"agente\",\"texto\":\"Fico feliz que meu entendimento tenha correspondido ao que voc√™ est√° vivendo, Aldo. Reconhe√ßo o esfor√ßo consistente que voc√™ faz para manter o equil√≠brio entre finan√ßas, trabalho e a busca por um relacionamento que traga significado, mostrando sua dedica√ß√£o e clareza de prop√≥sito. Essa combina√ß√£o de cuidado, motiva√ß√£o e metas claras √© uma base s√≥lida para seu crescimento pessoal e emocional. \\n\\nNossa conversa de hoje est√° finalizada, te espero amanh√£ para saber as novidades.\\n\\n{\\n  \\\"interaction_completa\\\": true,\\n  \\\"total_interactions\\\": 5,\\n  \\\"status\\\": \\\"completa\\\",\\n  \\\"contexto_final\\\": {\\n    \\\"situacao_emocional\\\": \\\"equilibrado com momentos de motiva√ß√£o e empenho disciplinado\\\",\\n    \\\"contextos_mencionados\\\": [\\\"finan√ßas e gest√£o de riscos\\\", \\\"desenvolvimento de aplicativo\\\", \\\"busca por relacionamento afetivo\\\"],\\n    \\\"sentimentos_expressos\\\": [\\\"motiva√ß√£o\\\", \\\"cuidado\\\", \\\"esperan√ßa\\\"],\\n    \\\"eventos_importantes\\\": [\\\"meta financeira de recupera√ß√£o\\\", \\\"lan√ßamento do app\\\", \\\"busca por conex√£o afetiva\\\"],\\n    \\\"intensidade_geral\\\": \\\"m√©dia\\\",\\n    \\\"validado_pelo_usuario\\\": true,\\n    \\\"observacoes_agente\\\": \\\"perfil disciplinado com foco em metas claras e autogest√£o emocional equilibrada\\\"\\n  },\\n  \\\"emocoes_detectadas\\\": {\\n    \\\"emocao_primaria\\\": \\\"anticipation\\\",\\n    \\\"intensidade_emocao\\\": 7,\\n    \\\"energia_detectada\\\": 6,\\n    \\\"humor_autoavaliado\\\": 7\\n  },\\n  \\\"qualidade_interacao\\\": 8,\\n  \\\"emoji_dia\\\": \\\"üòä\\\",\\n  \\\"pronta_para_especialista\\\": true\\n}\",\"timestamp\":\"2025-10-08T10:47:13.159Z\"}]",
          "data_conversa": "Wed Oct 08 2025 00:00:00 GMT+0000 (Coordinated Universal Time)",
          "chat_id": "0d24adcb-d873-4c7a-a2d7-a46304572724",
          "name": "Aldo"
        }
      }
    ]
  },
  "connections": {
    "start": {
      "main": [
        [
          {
            "node": "Analisador Humor & Energia",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Analisador Humor & Energia": {
      "main": [
        [
          {
            "node": "Gravar Humor & Energia",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parser JSON Humor": {
      "ai_outputParser": [
        [
          {
            "node": "Analisador Humor & Energia",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Claude": {
      "ai_languageModel": [
        [
          {
            "node": "Analisador Humor & Energia",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Parser JSON Humor",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Gravar Humor & Energia": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "64bb186d-fb56-4483-8cbb-6612750992c1",
  "meta": {
    "instanceId": "8b04959d79052d9a4fde27fe8830b1f9748281331c826275aabfed3697b200b7"
  },
  "id": "GykxpS5vsg8NeoOh",
  "tags": []
}