{
  "createdAt": "2025-11-27T20:13:45.434Z",
  "id": "Y435ZJF3humAmCLK",
  "name": "webhook_insights_historico",
  "description": null,
  "active": true,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "path": "insights_historico",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "webhook-node",
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -160,
        0
      ],
      "webhookId": "e4a33dac-668f-4733-aead-9e0bfa26c5ba"
    },
    {
      "parameters": {
        "jsCode": "const user_id = $input.item.json.query?.user_id;\n\nif (!user_id) {\n  throw new Error('user_id é obrigatório');\n}\n\nreturn {\n  json: {\n    user_id\n  }\n};"
      },
      "id": "code-node",
      "name": "Processar Params",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        32,
        0
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT id, tipo, categoria, titulo, descricao, icone, prioridade, criado_em\nFROM public.insights\nWHERE usuario_id = $1::uuid\nORDER BY criado_em DESC\nLIMIT 10",
        "options": {
          "queryReplacement": "={{ [$json.user_id] }}"
        }
      },
      "id": "postgres-node",
      "name": "Select insights",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        224,
        0
      ],
      "credentials": {
        "postgres": {
          "id": "8ySWxtSO7gYK5uue",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "options": {
          "responseData": "firstEntryJson"
        }
      },
      "id": "respond-node",
      "name": "Respond to Webhook",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        416,
        0
      ]
    },
    {
      "id": "code-array-node",
      "name": "Converter para Array",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        320,
        0
      ],
      "parameters": {
        "jsCode": "const items = $input.all();\nconst array = items.map(item => item.json);\nreturn [{ json: { data: array } }];"
      }
    }
  ],
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Processar Params",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Processar Params": {
      "main": [
        [
          {
            "node": "Select insights",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Select insights": {
      "main": [
        [
          {
            "node": "Converter para Array",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Converter para Array": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "saveDataErrorExecution": "all",
    "saveDataSuccessExecution": "all",
    "saveManualExecutions": true,
    "saveExecutionProgress": true,
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": false
  },
  "staticData": null,
  "meta": null,
  "pinData": {
    "Webhook": [
      {
        "json": {
          "headers": {
            "host": "mindquest-n8n.cloudfy.live",
            "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36 OPR/124.0.0.0",
            "accept": "*/*",
            "accept-encoding": "gzip, br",
            "accept-language": "en-US,en;q=0.9,pt-BR;q=0.8,pt-PT;q=0.7,pt;q=0.6,es;q=0.5",
            "cdn-loop": "cloudflare; loops=1",
            "cf-connecting-ip": "2001:818:e374:a600:60e7:e66c:b6d4:94e1",
            "cf-ipcountry": "PT",
            "cf-ray": "9a545c202d56e3c3-LIS",
            "cf-visitor": "{\"scheme\":\"https\"}",
            "origin": "http://localhost:5173",
            "priority": "u=1, i",
            "referer": "http://localhost:5173/",
            "sec-ch-ua": "\"Chromium\";v=\"140\", \"Not=A?Brand\";v=\"24\", \"Opera\";v=\"124\"",
            "sec-ch-ua-mobile": "?0",
            "sec-ch-ua-platform": "\"macOS\"",
            "sec-fetch-dest": "empty",
            "sec-fetch-mode": "cors",
            "sec-fetch-site": "cross-site",
            "x-forwarded-for": "172.68.103.44",
            "x-forwarded-host": "mindquest-n8n.cloudfy.live",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "d49265bfcab0",
            "x-real-ip": "172.68.103.44"
          },
          "params": {},
          "query": {
            "user_id": "d949d81c-9235-41ce-8b3b-6b5d593c5e24",
            "dias": "10"
          },
          "body": {},
          "webhookUrl": "https://mindquest-n8n.cloudfy.live/webhook/insights_historico",
          "executionMode": "production"
        }
      }
    ]
  },
  "activeVersionId": "456d9b98-dd6e-419e-be62-3b1e7d7a73e2",
  "shared": [
    {
      "createdAt": "2025-11-27T20:13:45.434Z",
      "role": "workflow:owner",
      "workflowId": "Y435ZJF3humAmCLK",
      "projectId": "u1M57XAwIiLpPwjp",
      "project": {
        "createdAt": "2025-09-16T16:13:20.606Z",
        "id": "u1M57XAwIiLpPwjp",
        "name": "Aldo Santos <lindualdo@hotmail.com>",
        "type": "personal",
        "icon": null,
        "description": null,
        "projectRelations": [
          {
            "createdAt": "2025-09-16T16:13:20.606Z",
            "userId": "fa864d51-475e-4765-b3b4-12788525a3e6",
            "projectId": "u1M57XAwIiLpPwjp",
            "user": {
              "createdAt": "2025-09-16T16:13:20.056Z",
              "id": "fa864d51-475e-4765-b3b4-12788525a3e6",
              "email": "lindualdo@hotmail.com",
              "firstName": "Aldo",
              "lastName": "Santos",
              "personalizationAnswers": {
                "version": "v4",
                "personalization_survey_submitted_at": "2025-09-16T16:22:10.583Z",
                "personalization_survey_n8n_version": "1.108.1"
              },
              "settings": {
                "userActivated": true,
                "firstSuccessfulWorkflowId": "jUAvu7DUAzyqZhJd",
                "userActivatedAt": 1758041156747,
                "easyAIWorkflowOnboarded": true,
                "dismissedCallouts": {
                  "preBuiltAgentsModalCallout": true
                },
                "npsSurvey": {
                  "responded": true,
                  "lastShownAt": 1759918723295
                }
              },
              "disabled": false,
              "mfaEnabled": false,
              "isPending": false
            }
          }
        ]
      }
    }
  ],
  "tags": [],
  "activeVersion": {
    "createdAt": "2025-12-05T12:13:14.667Z",
    "workflowId": "Y435ZJF3humAmCLK",
    "nodes": [
      {
        "parameters": {
          "path": "insights_historico",
          "responseMode": "responseNode",
          "options": {}
        },
        "id": "webhook-node",
        "name": "Webhook",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2.1,
        "position": [
          -160,
          0
        ],
        "webhookId": "e4a33dac-668f-4733-aead-9e0bfa26c5ba"
      },
      {
        "parameters": {
          "jsCode": "const user_id = $input.item.json.query?.user_id;\n\nif (!user_id) {\n  throw new Error('user_id é obrigatório');\n}\n\nreturn {\n  json: {\n    user_id\n  }\n};"
        },
        "id": "code-node",
        "name": "Processar Params",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          32,
          0
        ]
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "SELECT id, tipo, categoria, titulo, descricao, icone, prioridade, criado_em\nFROM public.insights\nWHERE usuario_id = $1::uuid\nORDER BY criado_em DESC\nLIMIT 10",
          "options": {
            "queryReplacement": "={{ [$json.user_id] }}"
          }
        },
        "id": "postgres-node",
        "name": "Select insights",
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          224,
          0
        ],
        "credentials": {
          "postgres": {
            "id": "8ySWxtSO7gYK5uue",
            "name": "Postgres account"
          }
        }
      },
      {
        "parameters": {
          "options": {
            "responseData": "firstEntryJson"
          }
        },
        "id": "respond-node",
        "name": "Respond to Webhook",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.4,
        "position": [
          416,
          0
        ]
      },
      {
        "id": "code-array-node",
        "name": "Converter para Array",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          320,
          0
        ],
        "parameters": {
          "jsCode": "const items = $input.all();\nconst array = items.map(item => item.json);\nreturn [{ json: { data: array } }];"
        }
      }
    ],
    "connections": {
      "Webhook": {
        "main": [
          [
            {
              "node": "Processar Params",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Processar Params": {
        "main": [
          [
            {
              "node": "Select insights",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Select insights": {
        "main": [
          [
            {
              "node": "Converter para Array",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Converter para Array": {
        "main": [
          [
            {
              "node": "Respond to Webhook",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "authors": "system migration",
    "name": null,
    "description": null
  }
}
