{
  "createdAt": "2025-11-28T19:39:38.779Z",
  "id": "Xo32TaonbDju1uF9",
  "name": "webhook_perfil_pessoal",
  "description": null,
  "active": true,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "path": "perfil-pessoal",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "webhook-get",
      "name": "Webhook GET",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -400,
        304
      ],
      "webhookId": "539a6705-809e-44ff-a6b1-3e4f7e9c729d"
    },
    {
      "parameters": {
        "jsCode": "const query = $input.first().json.query || {};\nconst user_id = query.user_id || query.userId || null;\n\nif (!user_id) {\n  throw new Error('user_id obrigat처rio');\n}\n\nreturn [{ json: { user_id: user_id } }];"
      },
      "id": "validar-get",
      "name": "Validar Params GET",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -208,
        304
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT \n    u.id as user_id,\n    u.nome_preferencia,\n    COALESCE(u.nome_assistente, NULL) as nome_assistente,\n    COALESCE(u.tom_conversa, NULL) as tom_conversa,\n    COALESCE(u.sobre_voce, NULL) as sobre_voce\nFROM usuarios u\nWHERE u.id = $1::uuid\nLIMIT 1;",
        "options": {
          "queryReplacement": "={{ [$json.user_id] }}"
        }
      },
      "id": "buscar-perfil",
      "name": "Buscar Perfil",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        0,
        304
      ],
      "credentials": {
        "postgres": {
          "id": "8ySWxtSO7gYK5uue",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const item = $input.first()?.json || {};\n\n// Verificar se perfil n찾o foi encontrado\nif (!item || Object.keys(item).length === 0 || !item.user_id) {\n  return [{\n    json: {\n      success: false,\n      error: 'Perfil n찾o encontrado'\n    }\n  }];\n}\n\nreturn [{\n  json: {\n    success: true,\n    perfil: {\n      nome_preferencia: item.nome_preferencia || null,\n      nome_assistente: item.nome_assistente || null,\n      tom_conversa: item.tom_conversa || null,\n      sobre_voce: item.sobre_voce || null\n    }\n  }\n}];"
      },
      "id": "montar-resposta-get",
      "name": "Montar Resposta GET",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        208,
        304
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {}
      },
      "id": "responder-get",
      "name": "Responder GET",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        400,
        304
      ]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "perfil-pessoal",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "webhook-post",
      "name": "Webhook POST",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -400,
        512
      ],
      "webhookId": "5bb10fb7-9cf4-460d-a418-da040dce5cad"
    },
    {
      "parameters": {
        "jsCode": "const body = $input.first().json.body || {};\nconst user_id = body.user_id || body.usuario_id || null;\n\nif (!user_id) {\n  throw new Error('user_id obrigat처rio');\n}\n\nconst dados = {\n  user_id: user_id,\n  nome_preferencia: body.nome_preferencia || null,\n  nome_assistente: body.nome_assistente || null,\n  tom_conversa: body.tom_conversa || null,\n  sobre_voce: body.sobre_voce || null\n};\n\nreturn [{ json: dados }];"
      },
      "id": "validar-post",
      "name": "Validar Params POST",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -208,
        512
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "UPDATE usuarios\nSET \n    nome_preferencia = COALESCE($2, nome_preferencia),\n    nome_assistente = COALESCE($3, nome_assistente),\n    tom_conversa = COALESCE($4, tom_conversa),\n    sobre_voce = COALESCE($5, sobre_voce),\n    atualizado_em = CURRENT_TIMESTAMP\nWHERE id = $1::uuid\nRETURNING \n    id as user_id,\n    nome_preferencia,\n    COALESCE(nome_assistente, NULL) as nome_assistente,\n    COALESCE(tom_conversa, NULL) as tom_conversa,\n    COALESCE(sobre_voce, NULL) as sobre_voce;",
        "options": {
          "queryReplacement": "={{ [$json.user_id, $json.nome_preferencia, $json.nome_assistente, $json.tom_conversa, $json.sobre_voce] }}"
        }
      },
      "id": "atualizar-perfil",
      "name": "Atualizar Perfil",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        0,
        512
      ],
      "credentials": {
        "postgres": {
          "id": "8ySWxtSO7gYK5uue",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const item = $input.first()?.json || {};\n\nif (!item || !item.user_id) {\n  return [{\n    json: {\n      success: false,\n      error: 'Erro ao atualizar perfil'\n    }\n  }];\n}\n\nreturn [{\n  json: {\n    success: true,\n    perfil: {\n      nome_preferencia: item.nome_preferencia || null,\n      nome_assistente: item.nome_assistente || null,\n      tom_conversa: item.tom_conversa || null,\n      sobre_voce: item.sobre_voce || null\n    }\n  }\n}];"
      },
      "id": "montar-resposta-post",
      "name": "Montar Resposta POST",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        208,
        512
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {}
      },
      "id": "responder-post",
      "name": "Responder POST",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        400,
        512
      ]
    }
  ],
  "connections": {
    "Webhook GET": {
      "main": [
        [
          {
            "node": "Validar Params GET",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Validar Params GET": {
      "main": [
        [
          {
            "node": "Buscar Perfil",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Buscar Perfil": {
      "main": [
        [
          {
            "node": "Montar Resposta GET",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Montar Resposta GET": {
      "main": [
        [
          {
            "node": "Responder GET",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook POST": {
      "main": [
        [
          {
            "node": "Validar Params POST",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Validar Params POST": {
      "main": [
        [
          {
            "node": "Atualizar Perfil",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Atualizar Perfil": {
      "main": [
        [
          {
            "node": "Montar Resposta POST",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Montar Resposta POST": {
      "main": [
        [
          {
            "node": "Responder POST",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "saveDataErrorExecution": "all",
    "saveDataSuccessExecution": "all",
    "saveManualExecutions": true,
    "saveExecutionProgress": true,
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": false
  },
  "staticData": null,
  "meta": null,
  "pinData": {
    "Webhook GET": [
      {
        "json": {
          "headers": {
            "host": "mindquest-n8n.cloudfy.live",
            "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/140.0.0.0 Safari/537.36 OPR/124.0.0.0",
            "accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7",
            "accept-encoding": "gzip, br",
            "accept-language": "en-US,en;q=0.9,pt-BR;q=0.8,pt-PT;q=0.7,pt;q=0.6,es;q=0.5",
            "cdn-loop": "cloudflare; loops=1",
            "cf-connecting-ip": "2001:818:e374:a600:dc6b:d0d3:9a09:8003",
            "cf-ipcountry": "PT",
            "cf-ray": "9a5c5dfd5f3b4893-LIS",
            "cf-visitor": "{\"scheme\":\"https\"}",
            "cookie": "rl_page_init_referrer=RudderEncrypt%3AU2FsdGVkX1%2FNdw5mnLVEsJlKiW9kRAAcRJw4LSce3cQ%3D; rl_page_init_referring_domain=RudderEncrypt%3AU2FsdGVkX1%2B5t5eln873eA2PnUG53bQfGtZ3v%2FvrGv8%3D; rl_anonymous_id=RudderEncrypt%3AU2FsdGVkX1%2Bk%2F4%2BGxBvphIJDuEd1qnMLSIVaDcUvjrNejwE%2F4ROS5N6X20uYi9%2FbS3POLKbZwYVyQBUQxSHuTg%3D%3D; rl_user_id=RudderEncrypt%3AU2FsdGVkX19mpEHkmg0f3jn0hQ%2F2kZwBWyAvW9bDiCCOe503BeyxGDWbJrU9hx7MzZSIZFYRN02TIDIsL2fdlilc31cE9TVHKOjQh91BCLIf1a2dd3GUHHL4APP7n8jm2X5heYgwpSOuUARkA%2BCqDMdzPcDRgy8gbI8ZfJ2d%2FGE%3D; rl_trait=RudderEncrypt%3AU2FsdGVkX19JdvtJypuz2LIZ2AlY%2Bmpjc97YnSLJh3qnmZIYz62VL4Tamba04huEMXBw0BV9Sry3AIEWD9CpkKok4PYc%2F3%2FIKmAzWbIzjyRrwcpBbuKa%2BVyqJ%2BZQJcyOomunUI1E1HKAxcoMZATM9YgopfzPA8QTfMbBSUev%2F2U%3D; rl_session=RudderEncrypt%3AU2FsdGVkX19idZEQQuIjagXPhnAnr4LmNPGajtVuoRJjughYYK0gx2D2d6DOCM9wb9G4KB0AysGoTXOLwd0mbur%2F4mspuYR5sqSHg5yHGePhPJH%2F7UQ%2B1tQlbXQ7SZykRzsR57V16jBT4oPxERTLIQ%3D%3D; ph_phc_4URIAm1uYfJO7j8kWSe0J8lc8IqnstRLS7Jx8NcakHo_posthog=%7B%22distinct_id%22%3A%228b04959d79052d9a4fde27fe8830b1f9748281331c826275aabfed3697b200b7%23fa864d51-475e-4765-b3b4-12788525a3e6%22%2C%22%24sesid%22%3A%5B1764359137162%2C%22019acbfb-7d32-7b04-adb1-efa5e917d0d3%22%2C1764358847791%5D%2C%22%24epp%22%3Atrue%2C%22%24initial_person_info%22%3A%7B%22r%22%3A%22%24direct%22%2C%22u%22%3A%22https%3A%2F%2Fmindquest-n8n.cloudfy.live%2Fsignin%3Fredirect%3D%25252F%22%7D%7D",
            "priority": "u=0, i",
            "sec-ch-ua": "\"Chromium\";v=\"140\", \"Not=A?Brand\";v=\"24\", \"Opera\";v=\"124\"",
            "sec-ch-ua-mobile": "?0",
            "sec-ch-ua-platform": "\"macOS\"",
            "sec-fetch-dest": "document",
            "sec-fetch-mode": "navigate",
            "sec-fetch-site": "none",
            "sec-fetch-user": "?1",
            "upgrade-insecure-requests": "1",
            "x-forwarded-for": "172.68.103.43",
            "x-forwarded-host": "mindquest-n8n.cloudfy.live",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "d49265bfcab0",
            "x-real-ip": "172.68.103.43"
          },
          "params": {},
          "query": {
            "user_id": "d949d81c-9235-41ce-8b3b-6b5d593c5e24"
          },
          "body": {},
          "webhookUrl": "https://mindquest-n8n.cloudfy.live/webhook-test/perfil-pessoal",
          "executionMode": "test"
        }
      }
    ]
  },
  "versionId": "78531069-e02d-4dce-954d-970f94533d34",
  "versionCounter": 21,
  "triggerCount": 2,
  "shared": [
    {
      "createdAt": "2025-11-28T19:39:38.779Z",
      "role": "workflow:owner",
      "workflowId": "Xo32TaonbDju1uF9",
      "projectId": "u1M57XAwIiLpPwjp",
      "project": {
        "createdAt": "2025-09-16T16:13:20.606Z",
        "id": "u1M57XAwIiLpPwjp",
        "name": "Aldo Santos <lindualdo@hotmail.com>",
        "type": "personal",
        "icon": null,
        "description": null,
        "projectRelations": [
          {
            "createdAt": "2025-09-16T16:13:20.606Z",
            "userId": "fa864d51-475e-4765-b3b4-12788525a3e6",
            "projectId": "u1M57XAwIiLpPwjp",
            "user": {
              "createdAt": "2025-09-16T16:13:20.056Z",
              "id": "fa864d51-475e-4765-b3b4-12788525a3e6",
              "email": "lindualdo@hotmail.com",
              "firstName": "Aldo",
              "lastName": "Santos",
              "personalizationAnswers": {
                "version": "v4",
                "personalization_survey_submitted_at": "2025-09-16T16:22:10.583Z",
                "personalization_survey_n8n_version": "1.108.1"
              },
              "settings": {
                "userActivated": true,
                "firstSuccessfulWorkflowId": "jUAvu7DUAzyqZhJd",
                "userActivatedAt": 1758041156747,
                "easyAIWorkflowOnboarded": true,
                "dismissedCallouts": {
                  "preBuiltAgentsModalCallout": true
                },
                "npsSurvey": {
                  "responded": true,
                  "lastShownAt": 1759918723295
                }
              },
              "disabled": false,
              "mfaEnabled": false,
              "isPending": false
            }
          }
        ]
      }
    }
  ],
  "tags": []
}
