{
  "createdAt": "2025-12-18T00:00:00.000Z",
  "id": "cQz4nq1h3Kp9Lm2N",
  "name": "sw_mentor_notificacoes_conquistas_v1",
  "description": null,
  "active": false,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "model": "google/gemini-2.5-flash",
        "options": {}
      },
      "id": "7167cb5c-24ae-4aea-9728-e0dd9f06e84a",
      "name": "OpenRouter Conquistas",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        2400,
        160
      ],
      "credentials": {
        "openRouterApi": {
          "id": "rSnkOnnAHyfayLJt",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"titulo\": {\n      \"type\": \"string\",\n      \"description\": \"T√≠tulo curto para push (max 50 chars)\"\n    },\n    \"corpo_push\": {\n      \"type\": \"string\",\n      \"description\": \"Vers√£o curta para push (max 100 chars)\"\n    },\n    \"corpo_whatsapp\": {\n      \"type\": \"string\",\n      \"description\": \"Mensagem completa para WhatsApp\"\n    },\n    \"contexto_mentor\": {\n      \"type\": \"string\",\n      \"description\": \"Contexto para continuidade se usu√°rio responder\"\n    },\n    \"subtipo\": {\n      \"type\": \"string\",\n      \"description\": \"Subtipo (deve ser exatamente o subtipo recebido)\"\n    }\n  },\n  \"required\": [\n    \"titulo\",\n    \"corpo_push\",\n    \"corpo_whatsapp\",\n    \"contexto_mentor\",\n    \"subtipo\"\n  ]\n}",
        "autoFix": true
      },
      "id": "0390e9e4-997e-4e91-a8c3-4c653e6c9625",
      "name": "Parser Conquistas",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        2720,
        352
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=<notification_request>\n<type>conquista</type>\n\n<user>\n<name>{{ $('start').first().json.nome_preferencia }}</name>\n<preferred_tone>{{ $('start').first().json.tom_conversa || 'empatico' }}</preferred_tone>\n</user>\n\n<subtipo>{{ $('start').first().json.contexto.subtipo }}</subtipo>\n\n<context>\n{{ JSON.stringify($('start').first().json.contexto) }}\n</context>\n</notification_request>\n\nCrie a notifica√ß√£o de conquistas baseada apenas no contexto recebido.\nRetorne APENAS o JSON.",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=# System Prompt - Mentor Notifica√ß√µes (Conquistas) v1.0\n\n<role>\nVoc√™ √© o Mentor MindQuest em modo proativo, celebrando conquistas reais do usu√°rio.\nSeu objetivo √© reconhecer progresso sem infantilizar e sem parecer rob√¥.\n</role>\n\n<objective>\nCriar UMA mensagem de notifica√ß√£o que:\n- Parabenize e reconhe√ßa o progresso (n√≠vel, streak, quests conclu√≠das)\n- Seja curta, humana e motivadora\n- N√£o pressione o usu√°rio\n- Termine com uma pergunta simples para abrir conversa\n</objective>\n\n<context_received>\nVoc√™ receber√° um JSON em <context> com poss√≠veis eventos:\n- nivel_novo: n√∫mero do n√≠vel (se houve novo n√≠vel ainda n√£o celebrado)\n- nivel_atual, nivel_nome, estagio, estagio_nome, xp_total, xp_minimo, xp_proximo_nivel\n- streak_conversa_dias e/ou streak_conversa_marco (3/5/10/15)\n- streak_quest_dias e/ou streak_quest_marco (3/5/10/15)\n- quests_concluidas_total e quests_concluidas_titulos (t√≠tulos)\n- subtipo: string do evento principal (ex: nivel_2, streak_conversa_5, streak_quest_10, quest_concluida)\n</context_received>\n\n<guidelines>\nDEVE:\n- Incluir o nome do usu√°rio\n- Citar apenas os eventos presentes (n√£o inventar)\n- Se houver quests conclu√≠das hoje, listar apenas os t√≠tulos (sem IDs/descri√ß√µes)\n- Manter tom alinhado ao `preferred_tone`\n- Definir `subtipo` exatamente igual ao valor recebido em <subtipo>\n\nN√ÉO DEVE:\n- Falar de termos t√©cnicos (banco, XP_minimo, etc.)\n- Cobrar ou pressionar (‚Äúvoc√™ TEM que...‚Äù)\n- Exagerar emojis (m√°x 1 fora de t√≠tulos)\n</guidelines>\n\n<whatsapp_format>\nUse esta formata√ß√£o (WhatsApp):\n- Negrito: *texto*\n- Bullets: ‚Ä¢\n- T√≠tulos com emoji:\n  üéâ *Conquistas de hoje*\n  üß≠ *Jornada*\n  üî• *Sequ√™ncias*\n  ‚úÖ *Quests conclu√≠das*\n\nEstrutura sugerida:\nüéâ *Conquistas de hoje*\n<1‚Äì3 bullets com os eventos>\n\n<1‚Äì2 frases curtas reconhecendo e conectando>\n<pergunta final>\n</whatsapp_format>\n\n<response_format>\nRetorne APENAS este JSON:\n{\n  \"titulo\": \"...\",\n  \"corpo_push\": \"...\",\n  \"corpo_whatsapp\": \"...\",\n  \"contexto_mentor\": \"...\",\n  \"subtipo\": \"...\"\n}\n</response_format>\n"
        }
      },
      "id": "a16d589a-7359-4bfb-b65a-c05c23102ce3",
      "name": "Mentor Notificacoes (conquistas)",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        2560,
        144
      ],
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "AkxTfShjkgiu6lLL",
          "mode": "list",
          "cachedResultName": "sw_envia_notificacao"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "usuario_id": "={{ $('start').first().json.usuario_id }}",
            "nome_preferencia": "={{ $('start').first().json.nome_preferencia }}",
            "whats_number": "={{ $('start').first().json.whats_number }}",
            "lembretes_canais": "={{ $('start').first().json.lembretes_canais }}",
            "push_tokens": "={{ $('start').first().json.push_tokens }}",
            "lembrete_periodo": "={{ 'conquista' }}",
            "notificacao": "={{ $json.output }}"
          },
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        3440,
        144
      ],
      "id": "22fcbe3f-2876-45e2-93b7-fbf82fd91bcf",
      "name": "Call 'sw_envia_notificacao'"
    },
    {
      "parameters": {
        "workflowInputs": {
          "values": [
            {
              "name": "usuario_id"
            },
            {
              "name": "nome_preferencia"
            },
            {
              "name": "tom_conversa"
            },
            {
              "name": "whats_number"
            },
            {
              "name": "lembretes_canais",
              "type": "array"
            },
            {
              "name": "push_tokens",
              "type": "array"
            },
            {
              "name": "contexto",
              "type": "object"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        1664,
        144
      ],
      "id": "5adb91d7-26e6-4412-8dce-0391574c0882",
      "name": "start"
    }
  ],
  "connections": {
    "OpenRouter Conquistas": {
      "ai_languageModel": [
        [
          {
            "node": "Mentor Notificacoes (conquistas)",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Parser Conquistas",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Parser Conquistas": {
      "ai_outputParser": [
        [
          {
            "node": "Mentor Notificacoes (conquistas)",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "start": {
      "main": [
        [
          {
            "node": "Mentor Notificacoes (conquistas)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mentor Notificacoes (conquistas)": {
      "main": [
        [
          {
            "node": "Call 'sw_envia_notificacao'",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": null
}