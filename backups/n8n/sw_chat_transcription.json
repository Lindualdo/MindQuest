{
  "createdAt": "2025-09-16T16:29:47.629Z",
  "id": "jUAvu7DUAzyqZhJd",
  "name": "sw_chat_transcription",
  "description": null,
  "active": false,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "workflowInputs": {
          "values": [
            {
              "name": "body.instance"
            },
            {
              "name": "body.data.key.remoteJid"
            },
            {
              "name": "body.data.key.id"
            },
            {
              "name": "body.data.key.fromMe",
              "type": "boolean"
            },
            {
              "name": "body.data.pushName"
            },
            {
              "name": "body.data.message.conversation"
            },
            {
              "name": "body.data.messageType"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        -640,
        -704
      ],
      "id": "b4b514a8-364f-429e-b923-72e411d4208e",
      "name": "When Executed by Another Workflow"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "284b8bca-e472-4e25-b990-e70d63a058ce",
              "name": "body.instance",
              "value": "={{ $('When Executed by Another Workflow').item.json['body.instance'] }}",
              "type": "string"
            },
            {
              "id": "64937688-86f2-4ee4-ae4e-73a7283a2366",
              "name": "body.data.key.remoteJid",
              "value": "={{ $('When Executed by Another Workflow').item.json['body.data.key.remoteJid'] }}",
              "type": "string"
            },
            {
              "id": "ee07a7b7-014c-4d6d-b59d-710466249fc8",
              "name": "body.data.key.id",
              "value": "={{ $('When Executed by Another Workflow').item.json['body.data.key.id'] }}",
              "type": "string"
            },
            {
              "id": "94a0fbdc-8cf5-404a-af73-64507b3b9aeb",
              "name": "body.data.key.fromMe",
              "value": "={{ $('When Executed by Another Workflow').item.json['body.data.key.fromMe'] }}",
              "type": "boolean"
            },
            {
              "id": "24d86d8a-d963-4503-abd4-25c33c101f8f",
              "name": "body.data.message.conversation",
              "value": "={{ $('When Executed by Another Workflow').item.json['body.data.message.conversation'] }}",
              "type": "string"
            },
            {
              "id": "080fcd81-0d99-4290-b550-1830065b886a",
              "name": "body.data.messageType",
              "value": "={{ $('When Executed by Another Workflow').item.json['body.data.messageType'] }}",
              "type": "string"
            },
            {
              "id": "bfe60004-fe7c-4274-bc83-572682a5c723",
              "name": "body.data.pushName",
              "value": "={{ $('When Executed by Another Workflow').item.json['body.data.pushName'] }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -240,
        -704
      ],
      "id": "12e1dc2e-dfab-4389-a8be-4d0dfc7e9d3f",
      "name": "Dados"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.body.data.messageType }}",
                    "rightValue": "conversation",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "f0916afc-25fd-4d21-937c-7ed6a006cb54"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Texto"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "05927082-77a0-4936-88f5-d3c6a0e22b8e",
                    "leftValue": "={{ $json.body.data.messageType }}",
                    "rightValue": "audioMessage",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Audio"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "e08071c3-92f9-4711-b0ad-84dcbcc90462",
                    "leftValue": "={{ $json.body.data.messageType }}",
                    "rightValue": "imageMessage",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "imagem"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "fa8b358a-9df5-42b8-a5a4-c52fe0ce8b15",
                    "leftValue": "={{ $json.body.data.messageType }}",
                    "rightValue": "documentMessage",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "pdf"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -32,
        -704
      ],
      "id": "5acf4360-dee0-4969-bba1-787e2ee2055a",
      "name": "msg type"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c0a3bf2c-8965-46c3-8e07-1d56b2965b4b",
              "name": "message",
              "value": "={{ $json.body.data.message.conversation }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        304,
        -864
      ],
      "id": "7edbdefd-723d-48b5-bace-b244d60d7642",
      "name": "text message"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "4d9d30a1-d4d6-4778-8c1a-c36ff6df78b8",
              "name": "message",
              "value": "={{ $json.message }}",
              "type": "string"
            },
            {
              "id": "307e9e69-1cb8-496a-8812-aa341201630a",
              "name": "WhstsApp_Number",
              "value": "={{ $('get_usr').item.json.whatsapp_numero }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        496,
        -864
      ],
      "id": "12561198-d69b-439d-bc6c-82e741c49d86",
      "name": "message"
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "data.base64",
        "options": {
          "mimeType": "audio/mpeg"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        528,
        -560
      ],
      "id": "47458426-4440-4dba-ba44-4ecd2772f544",
      "name": "Convert to File"
    },
    {
      "parameters": {
        "resource": "chat-api",
        "operation": "get-media-base64",
        "instanceName": "={{ $json.body.instance }}",
        "messageId": "={{ $json.body.data.key.id }}"
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        320,
        -560
      ],
      "id": "685307c7-2cba-41a5-9c48-0b3fc7e0a0f4",
      "name": "Obter media em base64",
      "credentials": {
        "evolutionApi": {
          "id": "H4gurJcNVV0yrS90",
          "name": "Evolution account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.groq.com/openai/v1/audio/transcriptions",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "groqApi",
        "sendBody": true,
        "contentType": "multipart-form-data",
        "bodyParameters": {
          "parameters": [
            {
              "name": "model",
              "value": "whisper-large-v3-turbo"
            },
            {
              "name": "temperature",
              "value": "0"
            },
            {
              "name": "response_format",
              "value": "verbose_json"
            },
            {
              "name": "language",
              "value": "pt"
            },
            {
              "parameterType": "formBinaryData",
              "name": "file",
              "inputDataFieldName": "data"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        752,
        -560
      ],
      "id": "fcc9e54c-39d4-4c9c-82b5-8606b39c3473",
      "name": "Transcrição",
      "credentials": {
        "groqApi": {
          "id": "YXMxpL5yutaOKb4r",
          "name": "Groq account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "24681a22-0e9b-47dd-abb6-a1d8e0eaad4a",
              "name": "message",
              "value": "={{ $json.text }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        960,
        -560
      ],
      "id": "56df0799-47be-44c8-a26b-1ecd1e75ea9b",
      "name": "audio message"
    },
    {
      "parameters": {
        "content": "Transcrição",
        "height": 224,
        "width": 1136,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        288,
        -608
      ],
      "id": "a42e2e9f-0956-4bd3-a587-35fa08173722",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "value": "public",
          "mode": "list",
          "cachedResultName": "public"
        },
        "table": {
          "__rl": true,
          "value": "usuarios",
          "mode": "list",
          "cachedResultName": "usuarios"
        },
        "limit": 1,
        "where": {
          "values": [
            {
              "column": "whatsapp_numero",
              "value": "={{ $json['body.data.key.remoteJid'].split(\"@\")[0] }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -432,
        -704
      ],
      "id": "8c2a4059-3c58-4e0a-9c19-9f9261c2cf3f",
      "name": "get_usr",
      "credentials": {
        "postgres": {
          "id": "8ySWxtSO7gYK5uue",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "4d9d30a1-d4d6-4778-8c1a-c36ff6df78b8",
              "name": "message",
              "value": "={{ $json.message }}",
              "type": "string"
            },
            {
              "id": "307e9e69-1cb8-496a-8812-aa341201630a",
              "name": "WhstsApp_Number",
              "value": "={{$('get_usr').first().json.whatsapp_numero}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1216,
        -864
      ],
      "id": "96189238-e60d-46c3-a715-75cbea9d1586",
      "name": "msg"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "4d9d30a1-d4d6-4778-8c1a-c36ff6df78b8",
              "name": "message",
              "value": "=Poxa! que pena ainda não consigo ler imagens ☺️",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        320,
        -288
      ],
      "id": "8cd32892-496d-45d0-9129-d8da52b72902",
      "name": "msg1"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "DJB5qWudX1Hqap1O",
          "mode": "list",
          "cachedResultUrl": "/workflow/DJB5qWudX1Hqap1O",
          "cachedResultName": "sw_evolution_send_message_v2"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "instanceName": "={{ $('When Executed by Another Workflow').item.json['body.instance'] }}",
            "remoteJidOrNumber": "={{ $('When Executed by Another Workflow').item.json['body.data.key.remoteJid'] }}",
            "messageText": "={{ $json.message }}",
            "linkPreview": "false",
            "minDelayMs": "3000"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "instanceName",
              "displayName": "instanceName",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "remoteJidOrNumber",
              "displayName": "remoteJidOrNumber",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "messageText",
              "displayName": "messageText",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "linkPreview",
              "displayName": "linkPreview",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "minDelayMs",
              "displayName": "minDelayMs",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {
          "waitForSubWorkflow": true
        }
      },
      "id": "3c02c2b4-3ee9-42c9-baa2-2039186ea683",
      "name": "envia_mensagem",
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        544,
        -288
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "4d9d30a1-d4d6-4778-8c1a-c36ff6df78b8",
              "name": "message",
              "value": "=Poxa! que pena ainda não consigo ler documentos ☺️",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        320,
        -48
      ],
      "id": "750c6c1b-2cde-4cd1-911c-239eb6efdc65",
      "name": "msg2"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "DJB5qWudX1Hqap1O",
          "mode": "list",
          "cachedResultUrl": "/workflow/DJB5qWudX1Hqap1O",
          "cachedResultName": "sw_evolution_send_message_v2"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "instanceName": "={{ $('When Executed by Another Workflow').item.json['body.instance'] }}",
            "remoteJidOrNumber": "={{ $('When Executed by Another Workflow').item.json['body.data.key.remoteJid'] }}",
            "messageText": "={{ $json.message }}",
            "linkPreview": "false",
            "minDelayMs": "3000"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "instanceName",
              "displayName": "instanceName",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "remoteJidOrNumber",
              "displayName": "remoteJidOrNumber",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "messageText",
              "displayName": "messageText",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "linkPreview",
              "displayName": "linkPreview",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "minDelayMs",
              "displayName": "minDelayMs",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {
          "waitForSubWorkflow": true
        }
      },
      "id": "ae3bedee-4e37-428a-b4a9-21b3da6cea61",
      "name": "envia_mensagem1",
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        544,
        -48
      ]
    }
  ],
  "connections": {
    "When Executed by Another Workflow": {
      "main": [
        [
          {
            "node": "get_usr",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Dados": {
      "main": [
        [
          {
            "node": "msg type",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "msg type": {
      "main": [
        [
          {
            "node": "text message",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Obter media em base64",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "msg1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "msg2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "text message": {
      "main": [
        [
          {
            "node": "message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File": {
      "main": [
        [
          {
            "node": "Transcrição",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Obter media em base64": {
      "main": [
        [
          {
            "node": "Convert to File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Transcrição": {
      "main": [
        [
          {
            "node": "audio message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "audio message": {
      "main": [
        [
          {
            "node": "msg",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get_usr": {
      "main": [
        [
          {
            "node": "Dados",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "message": {
      "main": [
        [
          {
            "node": "msg",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "msg1": {
      "main": [
        [
          {
            "node": "envia_mensagem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "msg2": {
      "main": [
        [
          {
            "node": "envia_mensagem1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {
    "When Executed by Another Workflow": [
      {
        "json": {
          "body.instance": "MindQuest",
          "body.data.key.remoteJid": "351932786582@s.whatsapp.net",
          "body.data.key.id": "3BD8FDE4BBB35C46318E",
          "body.data.key.fromMe": false,
          "body.data.pushName": "Aldo Santos",
          "body.data.messageType": "documentMessage"
        },
        "pairedItem": {
          "item": 0
        }
      }
    ]
  },
  "activeVersionId": null,
  "shared": [
    {
      "createdAt": "2025-09-16T16:29:47.629Z",
      "role": "workflow:owner",
      "workflowId": "jUAvu7DUAzyqZhJd",
      "projectId": "u1M57XAwIiLpPwjp",
      "project": {
        "createdAt": "2025-09-16T16:13:20.606Z",
        "id": "u1M57XAwIiLpPwjp",
        "name": "Aldo Santos <lindualdo@hotmail.com>",
        "type": "personal",
        "icon": null,
        "description": null,
        "projectRelations": [
          {
            "createdAt": "2025-09-16T16:13:20.606Z",
            "userId": "fa864d51-475e-4765-b3b4-12788525a3e6",
            "projectId": "u1M57XAwIiLpPwjp",
            "user": {
              "createdAt": "2025-09-16T16:13:20.056Z",
              "id": "fa864d51-475e-4765-b3b4-12788525a3e6",
              "email": "lindualdo@hotmail.com",
              "firstName": "Aldo",
              "lastName": "Santos",
              "personalizationAnswers": {
                "version": "v4",
                "personalization_survey_submitted_at": "2025-09-16T16:22:10.583Z",
                "personalization_survey_n8n_version": "1.108.1"
              },
              "settings": {
                "userActivated": true,
                "firstSuccessfulWorkflowId": "jUAvu7DUAzyqZhJd",
                "userActivatedAt": 1758041156747,
                "easyAIWorkflowOnboarded": true,
                "dismissedCallouts": {
                  "preBuiltAgentsModalCallout": true
                },
                "npsSurvey": {
                  "responded": true,
                  "lastShownAt": 1759918723295
                }
              },
              "disabled": false,
              "mfaEnabled": false,
              "isPending": false
            }
          }
        ]
      }
    }
  ],
  "tags": [],
  "activeVersion": null
}
