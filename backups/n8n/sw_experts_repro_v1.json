{
  "createdAt": "2025-12-19T10:24:20.692Z",
  "id": "PNFN2i4YaWclauDh",
  "name": "sw_experts_repro_v1",
  "description": null,
  "active": false,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "workflowInputs": {
          "values": [
            {
              "name": "chat_id"
            }
          ]
        }
      },
      "id": "b5d466ce-3b80-42f4-a72b-501290dca436",
      "name": "start",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        496,
        96
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "-- Reprocessamento: qualquer data e flags de faltantes (com marcador p/ casos 'vazio')\nSELECT\n  c.id AS chat_id,\n  c.usuario_id,\n  c.data_conversa,\n  u.nome_preferencia AS usr_nome_preferencia,\n  c.mensagens,\n  (\n    NOT EXISTS (SELECT 1 FROM usuarios_sabotadores us WHERE us.chat_id = c.id)\n    AND NOT EXISTS (\n      SELECT 1 FROM ops_chat_experts_status s\n      WHERE s.chat_id = c.id AND s.processed_sabotadores = true\n    )\n  ) AS missing_sabotadores,\n  (\n    NOT EXISTS (SELECT 1 FROM usuarios_emocoes ue WHERE ue.chat_id = c.id)\n    AND NOT EXISTS (\n      SELECT 1 FROM ops_chat_experts_status s\n      WHERE s.chat_id = c.id AND s.processed_emocoes = true\n    )\n  ) AS missing_emocoes,\n  NOT EXISTS (SELECT 1 FROM usuarios_humor_energia uh WHERE uh.chat_id = c.id) AS missing_humor,\n  NOT EXISTS (SELECT 1 FROM usuarios_perfis up WHERE up.chat_id = c.id) AS missing_bigfive\nFROM usr_chat c\nJOIN usuarios u ON u.id = c.usuario_id\nWHERE c.id = $1::uuid;",
        "options": {
          "queryReplacement": "={{ [$json.chat_id] }}"
        }
      },
      "id": "0a1a32cc-4039-4d2f-90c0-f36a0cea36a6",
      "name": "Buscar Chat + Flags",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        736,
        96
      ],
      "credentials": {
        "postgres": {
          "id": "8ySWxtSO7gYK5uue",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "missing-sabotadores",
              "leftValue": "={{ $json.missing_sabotadores }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "8996b18a-17fa-416d-be62-062708f9c6aa",
      "name": "Falta Sabotadores?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1056,
        -464
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "missing-emocoes",
              "leftValue": "={{ $json.missing_emocoes }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "0ad21d3b-f204-4053-8548-27b302ab8dff",
      "name": "Falta Emo√ß√µes?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1072,
        80
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "missing-humor",
              "leftValue": "={{ $json.missing_humor }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "39cda6d2-6db9-463f-8c6e-250a1bfc5a6a",
      "name": "Falta Humor/Energia?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1216,
        496
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "missing-bigfive",
              "leftValue": "={{ $json.missing_bigfive }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "2e5f6ee6-f296-44a3-acd1-a636f664e2cb",
      "name": "Falta BigFive?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        976,
        1104
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT jsonb_agg(\n  jsonb_build_object('codigo', codigo, 'nome', nome)\n  ORDER BY codigo\n) AS catalogo_sabotadores\nFROM sabotadores_catalogo;",
        "options": {}
      },
      "id": "d6279f85-e167-4d1c-8e88-97b19d085bc8",
      "name": "Buscar Cat√°logo Sabotadores",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        1296,
        -464
      ],
      "credentials": {
        "postgres": {
          "id": "8ySWxtSO7gYK5uue",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "options": {
          "maxTokens": 2000,
          "temperature": 0.2
        }
      },
      "id": "4277958c-b72c-4f69-88f3-ea5c796da41d",
      "name": "LLM Sabotadores",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        1504,
        -208
      ],
      "credentials": {
        "openRouterApi": {
          "id": "rSnkOnnAHyfayLJt",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"sabotadores_detectados\": [\n    {\n      \"codigo\": 1,\n      \"intensidade\": 75,\n      \"contexto\": \"relacionamentos\",\n      \"frases_gatilho\": [\n        \"me senti desprezado\",\n        \"ela n√£o gostava mais de mim\"\n      ],\n      \"insights\": \"Autocr√≠tica intensa sobre valor pessoal.\",\n      \"confiabilidade\": 90,\n      \"apelido\": \"Sr. Exigente\",\n      \"contramedida\": \"Praticar autocompaix√£o por 3 minutos\"\n    }\n  ]\n}",
        "autoFix": true
      },
      "id": "e1aa4050-9d43-4269-ba60-5e084e6e8a31",
      "name": "Parser Sabotadores",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        1728,
        -224
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Analise a conversa e identifique sabotadores internos segundo Shirzad Chamine.\n\n**CONVERSA:**\n```json\n{{ JSON.stringify($('Buscar Chat + Flags').first().json.mensagens) }}\n```\nNome do usu√°rio: {{ $('Buscar Chat + Flags').first().json.usr_nome_preferencia }}\n\n**SABOTADORES V√ÅLIDOS (use APENAS estes c√≥digos):**\n{{ JSON.stringify($json.catalogo_sabotadores) }}\n\n\n**CR√çTICO: o campo \"codigo\" DEVE ser um n√∫mero de 1 a 10 da lista acima**\n\n**SUA TAREFA:**\n1. Leia APENAS mensagens do usu√°rio (autor: \"usuario\")\n2. Identifique sabotadores ativos (m√≠nimo intensidade 30)\n3. Para cada sabotador:\n   - Intensidade: 0-100\n   - Contexto: vida_pessoal|profissional|financeiro|relacionamentos|saude|familia\n   - Frases gatilho: 2-4 frases CURTAS (m√°x 15 palavras)\n   - Insights: como impacta (use nome do usu√°rio na 3¬™ pessoa)\n   - Confiabilidade: 0-100\n   - Apelido: curto e humanizado\n   - Contramedida: UMA a√ß√£o pr√°tica\n\n**REGRAS:**\n- Intensidade 0-100 (N√ÉO 0-10)\n- Apenas sabotadores com intensidade ‚â• 30\n- Se n√£o houver sabotadores, retorne array vazio\n- Retorne APENAS JSON estruturado",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=Voc√™ √© especialista em detectar sabotadores internos segundo Shirzad Chamine.\n\nSeu trabalho:\n1. Identificar padr√µes de pensamento autodestrutivos\n2. Avaliar intensidades na escala 0-100 (IMPORTANTE: N√ÉO use 0-10)\n3. Extrair TRECHOS CURTOS E ESPEC√çFICOS como frases gatilho (n√£o textos longos)\n4. Classificar contextos corretamente\n5. Criar apelidos humanizados e contramedidas pr√°ticas\n\nREGRA CR√çTICA: Use APENAS os c√≥digos num√©ricos (1-10) da lista abaixo.\nSABOTADORES V√ÅLIDOS: {{ JSON.stringify($json.catalogo_sabotadores) }}\n\nEscala de intensidade 0-100:\n- 0-20: muito fraca\n- 21-40: fraca\n- 41-60: moderada\n- 61-80: forte\n- 81-100: muito forte\n\nFRASES GATILHO:\n- Devem ser trechos CURTOS (m√°ximo 15 palavras)\n- Extraia 2-4 frases espec√≠ficas que evidenciam o sabotador\n- N√ÉO copie o texto inteiro\n- Exemplo bom: \"me senti desprezado\", \"ela n√£o gostava mais de mim\"\n- Exemplo ruim: texto completo de 50+ palavras\n\nSeja criterioso: apenas inclua sabotadores com evid√™ncias claras e intensidade ‚â• 30.\n\nRetorne SEMPRE JSON v√°lido.",
          "maxIterations": 3
        }
      },
      "id": "b2b47888-b5f1-4d25-80de-bdeba536d34a",
      "name": "sabotadores",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        1616,
        -464
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "-- REPRO: INSERT simples (somente quando n√£o existe dado no chat)\nWITH sabotadores_input AS (\n  SELECT \n    $1::uuid as usuario_id,\n    $2::uuid as chat_id,\n    $3::jsonb as sabotadores_array\n),\nsabotadores_com_id AS (\n  SELECT \n    si.usuario_id,\n    si.chat_id,\n    sc.id AS sabotador_id,\n    (sabotador->>'intensidade')::integer AS intensidade,\n    (sabotador->>'contexto')::varchar(100) AS contexto,\n    (sabotador->>'insights')::text AS insights,\n    (sabotador->>'apelido')::varchar(50) AS apelido,\n    (sabotador->>'contramedida')::text AS contramedida\n  FROM sabotadores_input si,\n       jsonb_array_elements(si.sabotadores_array) AS sabotador\n  JOIN sabotadores_catalogo sc ON sc.codigo = (sabotador->>'codigo')::integer\n  WHERE (sabotador->>'intensidade')::integer >= 30\n)\nINSERT INTO usuarios_sabotadores (\n  usuario_id,\n  chat_id,\n  sabotador_id,\n  intensidade_media,\n  intensidade_acumulada_dia,\n  total_deteccoes_dia,\n  total_deteccoes,\n  contexto_principal,\n  insight_atual,\n  apelido_personalizado,\n  contramedida_ativa,\n  sabotador_predominante,\n  data_ultima_atividade\n)\nSELECT \n  usuario_id,\n  chat_id,\n  sabotador_id,\n  intensidade,\n  intensidade,\n  1,\n  1,\n  contexto,\n  insights,\n  apelido,\n  contramedida,\n  true,\n  CURRENT_DATE\nFROM sabotadores_com_id\nRETURNING id, sabotador_id, intensidade_media;",
        "options": {
          "queryReplacement": "={{ [\n  $('Buscar Chat + Flags').first().json.usuario_id,\n  $('Buscar Chat + Flags').first().json.chat_id,\n  JSON.stringify($json.output.sabotadores_detectados || [])\n] }}"
        }
      },
      "id": "f13722ea-9af5-4300-9d88-5ccb997c076f",
      "name": "Gravar Sabotadores",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        1984,
        -464
      ],
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "8ySWxtSO7gYK5uue",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "options": {
          "maxTokens": 1500,
          "temperature": 0.2
        }
      },
      "id": "d1036785-5793-4390-a06c-23ac5a348472",
      "name": "LLM PANAS",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        1504,
        272
      ],
      "credentials": {
        "openRouterApi": {
          "id": "rSnkOnnAHyfayLJt",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"emocoes_detectadas\": [\n    {\n      \"emocao_id\": \"sadness\",\n      \"nome_pt\": \"tristeza\",\n      \"intensidade\": 85,\n      \"contexto\": \"NEGATIVA\",\n      \"evidencias\": [\"saudade\", \"solid√£o\", \"ang√∫stia\", \"me senti desprezado\"]\n    }\n  ],\n  \"classificacao_panas\": \"negativa\",\n  \"justificativa_panas\": \"...\",\n  \"confianca_analise\": 90\n}",
        "autoFix": true
      },
      "id": "f5aee2a4-5753-4103-b060-e2f562e8ca68",
      "name": "Parser PANAS",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        1760,
        240
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=### User Prompt\nDADOS DA CONVERSA:\nMensagens (JSON): {{ JSON.stringify($json.mensagens) }}\n\nExecute a an√°lise emocional conforme descrito no System Prompt, identifique emo√ß√µes de Plutchik, atribua intensidade, contexto e evid√™ncia, e ent√£o classifique o sentimento global (PANAS).\n\nRetorne somente o JSON estruturado conforme as regras.",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=### System Prompt ‚Äî Classificador Emocional (Plutchik + PANAS)\n\nVoc√™ √© um especialista em an√°lise emocional com base nas **oito emo√ß√µes prim√°rias de Robert Plutchik** e em agrega√ß√£o de afeto inspirada no **PANAS**.\n\n---\n\n#### üéØ Objetivo\nLer **todas as mensagens da conversa** e identificar **as emo√ß√µes prim√°rias presentes**, classificando-as conforme o modelo Plutchik e agregando o resultado segundo a escala PANAS.\n\n---\n\n#### üß† Tarefa passo a passo\n1. Analise **todas as mensagens** fornecidas.\n2. Detecte quais emo√ß√µes prim√°rias est√£o presentes (apenas as listadas abaixo).\n3. Para cada emo√ß√£o detectada, retorne os campos:\n   - `emocao_id`: slug obrigat√≥rio (ver **Vocabul√°rio permitido**).\n   - `intensidade`: n√∫mero inteiro de **0 a 100**.\n   - `contexto`: valor fixo (**POSITIVA**, **NEGATIVA** ou **NEUTRA**) conforme tabela de polaridade.\n   - `evidencias`: lista de **trechos literais da conversa** (1‚Äì5 itens) que justifiquem a detec√ß√£o.\n\n4. Ap√≥s listar todas as emo√ß√µes, gere um objeto `classificacao_geral` conforme as regras PANAS descritas abaixo.\n\n---\n\n#### üî§ Vocabul√°rio permitido\n| emocao_id | Nome (PT)      | Polaridade |\n|------------|----------------|-------------|\n| joy        | Alegria        | POSITIVA    |\n| trust      | Confian√ßa      | POSITIVA    |\n| anticipation| Expectativa   | POSITIVA    |\n| sadness    | Tristeza       | NEGATIVA    |\n| fear       | Medo           | NEGATIVA    |\n| anger      | Raiva          | NEGATIVA    |\n| disgust    | Nojo           | NEGATIVA    |\n| surprise   | Surpresa       | NEUTRA      |\n\n> **Proibi√ß√£o:** Nenhum outro valor al√©m dos 8 acima pode aparecer em `emocao_id`.\n\n---\n\n#### ‚öñÔ∏è Mapeamento de polaridade\nUse **apenas** os seguintes contextos fixos:\n- POSITIVA ‚Üí joy, trust, anticipation\n- NEGATIVA ‚Üí sadness, fear, anger, disgust\n- NEUTRA ‚Üí surprise\n\n---\n\n#### üìä Regras de agrega√ß√£o e classifica√ß√£o global\n- Somente emo√ß√µes com `intensidade ‚â• 45` participam do c√°lculo PANAS.\n- Se `total = 0`, classifique como **NEUTRA**.\n- Se diferen√ßa entre positivas e negativas < 20%, classifique como **NEUTRA**.\n\n---\n\nRetorne **somente** JSON v√°lido.",
          "maxIterations": 5
        }
      },
      "id": "8680b82d-d8d6-4615-a911-cde8bebf85de",
      "name": "panas e emocoes",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        1568,
        16
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "-- UPSERT emo√ß√µes: 1 registro por (chat_id, emocao_id)\nWITH emocoes_json AS (\n  SELECT \n    $1::uuid AS usuario_id,\n    $2::uuid AS chat_id,\n    $3::date AS data_conversa,\n    jsonb_array_elements($4::jsonb) AS emocao\n)\nINSERT INTO usuarios_emocoes (\n  usuario_id, chat_id, emocao_id, intensidade, intensidade_acumulada,\n  ocorrencias_dia, detectado_em, contexto, evidencias, emocao_pt\n)\nSELECT \n  ej.usuario_id, ej.chat_id,\n  (ej.emocao->>'emocao_id')::varchar(20),\n  (ej.emocao->>'intensidade')::integer,\n  (ej.emocao->>'intensidade')::integer,\n  1,\n  ej.data_conversa,\n  (ej.emocao->>'contexto')::varchar(100),\n  (ej.emocao->>'evidencias')::jsonb,\n  (ej.emocao->>'nome_pt')::varchar(20)\nFROM emocoes_json ej\nWHERE (ej.emocao->>'intensidade')::integer >= 45\nON CONFLICT (chat_id, emocao_id) DO UPDATE SET\n  ocorrencias_dia = usuarios_emocoes.ocorrencias_dia + 1,\n  intensidade_acumulada = usuarios_emocoes.intensidade_acumulada + EXCLUDED.intensidade,\n  intensidade = (usuarios_emocoes.intensidade_acumulada + EXCLUDED.intensidade) / \n                (usuarios_emocoes.ocorrencias_dia + 1),\n  evidencias = usuarios_emocoes.evidencias || EXCLUDED.evidencias,\n  contexto = EXCLUDED.contexto,\n  criado_em = NOW()\nRETURNING id, emocao_id, intensidade, ocorrencias_dia;",
        "options": {
          "queryReplacement": "={{ [\n  $('Buscar Chat + Flags').first().json.usuario_id,\n  $('Buscar Chat + Flags').first().json.chat_id,\n  ((v) => v ? new Date(v).toISOString().slice(0,10) : null)($('Buscar Chat + Flags').first().json.data_conversa),\n  JSON.stringify($json.output.emocoes_detectadas || [])\n] }}"
        }
      },
      "id": "2ee05823-35a2-415d-9a9a-f6794a824d12",
      "name": "Gravar Emo√ß√µes",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        1936,
        16
      ],
      "credentials": {
        "postgres": {
          "id": "8ySWxtSO7gYK5uue",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "options": {
          "maxTokens": 1000,
          "temperature": 0.2
        }
      },
      "id": "07c3e4d1-646a-469c-ac37-cd53db8776a3",
      "name": "LLM Humor",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        1712,
        800
      ],
      "credentials": {
        "openRouterApi": {
          "id": "rSnkOnnAHyfayLJt",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"humor_dia\": 6,\n  \"energia_nivel\": 6,\n  \"variacao_humor\": \"estavel\",\n  \"variacao_energia\": \"estavel\",\n  \"periodo_dia\": \"nao_identificado\",\n  \"justificativa_humor\": \"...\",\n  \"justificativa_energia\": \"...\",\n  \"evidencias_textuais\": [\"...\"],\n  \"confianca_analise\": 80\n}",
        "autoFix": true
      },
      "id": "0f63882a-469f-4abc-b218-5fae85113e8a",
      "name": "Parser Humor",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        1968,
        752
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Analise a conversa completa abaixo e detecte o HUMOR e ENERGIA do usu√°rio com base APENAS no que foi dito.\n\n**CONVERSA COMPLETA:**\n```json\n{{ JSON.stringify($json.mensagens) }}\n```\n\nNome do usu√°rio: {{ $json.usr_nome_preferencia }}\n\n**RETORNE APENAS O JSON ESTRUTURADO**",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=Voc√™ √© um especialista em an√°lise de humor e energia em conversas.\n\n### Escalas obrigat√≥rias\n- `humor_dia`: inteiro de 1 a 10 (1=p√©ssimo, 5=neutro, 10=excelente)\n- `energia_nivel`: inteiro de 1 a 10 (1=exausto, 5=normal, 10=energizado)\n- `confianca_analise`: inteiro de 0 a 100\n\n### Valores permitidos\n- `periodo_dia`: \"madrugada\" | \"manha\" | \"tarde\" | \"noite\" | \"nao_identificado\"\n- `variacao_humor`: \"estavel\" | \"ascendente\" | \"descendente\" | \"oscilatoria\"\n- `variacao_energia`: \"estavel\" | \"ascendente\" | \"descendente\" | \"oscilatoria\"\n\n### Regras\n1. Analise APENAS mensagens do usu√°rio (autor: \"usuario\")\n2. Se n√£o houver evid√™ncia clara, use valores neutros (humor=5, energia=5)\n3. `evidencias_textuais`: 2-5 trechos curtos que justifiquem a an√°lise\n4. Justificativas devem ser concisas (m√°x 200 caracteres)\n\nRetorne SEMPRE JSON v√°lido no formato solicitado.",
          "maxIterations": 3
        }
      },
      "id": "ed5ce0ab-d14a-4bab-8ca6-e90ba5d5888e",
      "name": "humor e energia",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        1776,
        496
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "-- UPSERT humor/energia: 1 registro por chat\nINSERT INTO usuarios_humor_energia (\n  usuario_id, chat_id, data_registro, hora_registro,\n  periodo_dia, humor_dia, humor_acumulado, energia_nivel, energia_acumulada,\n  ocorrencias_dia, variacao_humor, variacao_energia,\n  justificativa_humor, justificativa_energia,\n  evidencias_textuais, confianca_analise\n)\nVALUES (\n  $1::uuid, $2::uuid, $3::date, CURRENT_TIME,\n  CASE\n    WHEN $4 IS NULL THEN 'nao_identificado'\n    WHEN $4 ILIKE '%madrug%' THEN 'madrugada'\n    WHEN $4 ILIKE '%manh%' THEN 'manha'\n    WHEN $4 ILIKE '%tard%' THEN 'tarde'\n    WHEN $4 ILIKE '%noite%' THEN 'noite'\n    ELSE LEFT($4::varchar, 20)\n  END,\n  $5::integer, $5::integer, $6::integer, $6::integer,\n  1,\n  CASE\n    WHEN $7 IS NULL THEN 'estavel'\n    WHEN $7 ILIKE '%oscil%' THEN 'oscilatoria'\n    WHEN $7 ILIKE '%ascend%' OR $7 ILIKE '%sub%' THEN 'ascendente'\n    WHEN $7 ILIKE '%descend%' OR $7 ILIKE '%queda%' OR $7 ILIKE '%cai%' THEN 'descendente'\n    ELSE LEFT($7::varchar, 20)\n  END,\n  CASE\n    WHEN $8 IS NULL THEN 'estavel'\n    WHEN $8 ILIKE '%oscil%' THEN 'oscilatoria'\n    WHEN $8 ILIKE '%ascend%' OR $8 ILIKE '%sub%' THEN 'ascendente'\n    WHEN $8 ILIKE '%descend%' OR $8 ILIKE '%queda%' OR $8 ILIKE '%cai%' THEN 'descendente'\n    ELSE LEFT($8::varchar, 20)\n  END,\n  $9, $10, $11::jsonb,\n  CASE\n    WHEN $12 IS NULL THEN NULL\n    ELSE LEAST(\n      GREATEST(\n        CASE\n          WHEN $12::numeric BETWEEN 0 AND 1 THEN ROUND($12::numeric * 100)\n          ELSE ROUND($12::numeric)\n        END,\n        0\n      ),\n      100\n    )::integer\n  END\n)\nON CONFLICT (chat_id) DO UPDATE SET\n  ocorrencias_dia = usuarios_humor_energia.ocorrencias_dia + 1,\n  humor_acumulado = usuarios_humor_energia.humor_acumulado + EXCLUDED.humor_dia,\n  energia_acumulada = usuarios_humor_energia.energia_acumulada + EXCLUDED.energia_nivel,\n  humor_dia = (usuarios_humor_energia.humor_acumulado + EXCLUDED.humor_dia) / \n              (usuarios_humor_energia.ocorrencias_dia + 1),\n  energia_nivel = (usuarios_humor_energia.energia_acumulada + EXCLUDED.energia_nivel) / \n                  (usuarios_humor_energia.ocorrencias_dia + 1),\n  hora_registro = CURRENT_TIME,\n  periodo_dia = EXCLUDED.periodo_dia,\n  variacao_humor = EXCLUDED.variacao_humor,\n  variacao_energia = EXCLUDED.variacao_energia,\n  justificativa_humor = EXCLUDED.justificativa_humor,\n  justificativa_energia = EXCLUDED.justificativa_energia,\n  evidencias_textuais = usuarios_humor_energia.evidencias_textuais || EXCLUDED.evidencias_textuais,\n  confianca_analise = EXCLUDED.confianca_analise,\n  detectado_em = NOW()\nRETURNING id, humor_dia, energia_nivel, ocorrencias_dia;",
        "options": {
          "queryReplacement": "={{ [\n  $('Buscar Chat + Flags').first().json.usuario_id,\n  $('Buscar Chat + Flags').first().json.chat_id,\n  ((v) => v ? new Date(v).toISOString().slice(0,10) : null)($('Buscar Chat + Flags').first().json.data_conversa),\n  $json.output.periodo_dia,\n  $json.output.humor_dia,\n  $json.output.energia_nivel,\n  $json.output.variacao_humor,\n  $json.output.variacao_energia,\n  JSON.stringify($json.output.justificativa_humor),\n  JSON.stringify($json.output.justificativa_energia),\n  JSON.stringify($json.output.evidencias_textuais || []),\n  $json.output.confianca_analise\n] }}"
        }
      },
      "id": "639447fb-5ec7-4f74-9913-a66f97ad8685",
      "name": "Gravar Humor",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        2032,
        496
      ],
      "credentials": {
        "postgres": {
          "id": "8ySWxtSO7gYK5uue",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "HDTrSrJiBIv2FFks",
          "mode": "list",
          "cachedResultUrl": "/workflow/HDTrSrJiBIv2FFks",
          "cachedResultName": "sw_get_history"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "usr_id": "={{ $json.usuario_id }}"
          }
        },
        "options": {
          "waitForSubWorkflow": true
        }
      },
      "id": "025288c1-e0af-4926-8728-62ac7fa3d720",
      "name": "Buscar Hist√≥rico BigFive",
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        1248,
        1056
      ],
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "functionCode": "const chat = $items('Buscar Chat + Flags')[0]?.json ?? {};\nconst historyItems = $items('Buscar Hist√≥rico BigFive').map((item) => item.json).filter(Boolean);\nconst formatDate = (value) => {\n  if (!value) return null;\n  const parsed = new Date(value);\n  if (Number.isNaN(parsed.getTime())) return value;\n  return parsed.toISOString().slice(0, 10);\n};\nconst historicoOrdenado = historyItems\n  .map((entry) => ({\n    data: formatDate(entry.data_conversa),\n    resumo: entry.resumo_conversa ?? ''\n  }))\n  .filter((entry) => entry.data || entry.resumo)\n  .sort((a, b) => {\n    if (!a.data || !b.data) return 0;\n    return a.data < b.data ? 1 : -1;\n  });\nconst historicoResumo = historicoOrdenado.length\n  ? historicoOrdenado\n      .map((entry) => `- ${entry.data ?? 'data indeterminada'}: ${entry.resumo || 'sem resumo dispon√≠vel'}`)\n      .join('\\n')\n  : 'Sem hist√≥rico relevante nos √∫ltimos 5 dias.';\nreturn [\n  {\n    json: {\n      ...chat,\n      historico_resumo: historicoResumo,\n      historico_itens: historicoOrdenado\n    }\n  }\n];"
      },
      "id": "d81a84c5-9eef-4017-9a5c-cfe5bd19bdc7",
      "name": "Preparar Contexto BigFive",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        1472,
        1056
      ]
    },
    {
      "parameters": {
        "options": {
          "maxTokens": 2000,
          "temperature": 0.2
        }
      },
      "id": "041bf991-1c8a-4d1a-9773-b148a7795b33",
      "name": "LLM BigFive",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        1584,
        1328
      ],
      "credentials": {
        "openRouterApi": {
          "id": "rSnkOnnAHyfayLJt",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"big_five\": {\n    \"openness\": {\"score\": 62, \"confiabilidade\": 78, \"evidencias\": [\"...\"]},\n    \"conscientiousness\": {\"score\": 54, \"confiabilidade\": 65, \"evidencias\": [\"...\"]},\n    \"extraversion\": {\"score\": 41, \"confiabilidade\": 60, \"evidencias\": [\"...\"]},\n    \"agreeableness\": {\"score\": 70, \"confiabilidade\": 72, \"evidencias\": [\"...\"]},\n    \"neuroticism\": {\"score\": 58, \"confiabilidade\": 68, \"evidencias\": [\"...\"]}\n  },\n  \"perfil_primario\": \"agreeableness\",\n  \"resumo_perfil\": \"...\",\n  \"insuficiente\": false\n}",
        "autoFix": true
      },
      "id": "1ec3f2b3-1bb3-4645-bae1-a8e84341e6c0",
      "name": "Parser BigFive",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        1840,
        1296
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Use a conversa ATUAL como fonte principal e estime o perfil Big Five (OCEAN), tratando o hist√≥rico recente apenas como contexto complementar.\n\n**HIST√ìRICO (resumos √∫ltimos 5 dias):**\n{{ $json.historico_resumo }}\n\n**CONVERSA ATUAL (JSON):**\n```json\n{{ JSON.stringify($json.mensagens) }}\n```\n\n**Nome do usu√°rio:** {{ $json.usr_nome_preferencia }}\n\nREGRAS CR√çTICAS:\n- Use APENAS mensagens com autor = \"usuario\".\n- `score` e `confiabilidade` devem ser INTEIROS 0-100 (n√£o use 0-1).\n- `perfil_primario` deve ser EXATAMENTE um destes valores (sem texto livre):\n  - openness\n  - conscientiousness\n  - extraversion\n  - agreeableness\n  - neuroticism\n  - misto\n- `resumo_perfil` √© texto curto (at√© 400 caracteres).\n\nRetorne APENAS JSON v√°lido no formato solicitado.",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=Voc√™ √© um assistente especialista em Big Five (OCEAN) e √©tica em IA.\n\nRegras:\n- N√£o invente fatos.\n- Evid√™ncias devem ser trechos curtos do usu√°rio.\n- `score` e `confiabilidade`: inteiros 0-100.\n- `perfil_primario`: apenas {openness, conscientiousness, extraversion, agreeableness, neuroticism, misto}.\n\nRetorne SEMPRE JSON v√°lido no formato solicitado.",
          "maxIterations": 3
        }
      },
      "id": "327662ed-723b-4d21-bbf5-e4beb55165a4",
      "name": "Big Five",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        1696,
        1056
      ]
    },
    {
      "parameters": {
        "functionCode": "const chat = $items('Buscar Chat + Flags')[0]?.json ?? {};\nconst payload = $json.output ?? {};\n\nconst traits = ['openness','conscientiousness','extraversion','agreeableness','neuroticism'];\nconst validTraits = new Set(traits);\n\nconst normalizeKey = (value) => {\n  if (typeof value !== 'string') return null;\n  const normalized = value.trim().toLowerCase();\n  if (!normalized) return null;\n  if (normalized === 'misto') return 'misto';\n  if (validTraits.has(normalized)) return normalized;\n  return null;\n};\n\nconst normalizeInt0to100 = (value) => {\n  const num = Number(value);\n  if (!Number.isFinite(num)) return null;\n  const scaled = num >= 0 && num <= 1 ? num * 100 : num;\n  const rounded = Math.round(scaled);\n  if (rounded < 0) return 0;\n  if (rounded > 100) return 100;\n  return rounded;\n};\n\nconst scores = traits.map((key) => {\n  const data = payload.big_five?.[key] ?? {};\n  const score = normalizeInt0to100(data.score);\n  const confianca = normalizeInt0to100(data.confiabilidade);\n  return {\n    id: key,\n    score,\n    confiabilidade: confianca\n  };\n});\n\nconst sorted = [...scores].sort((a, b) => (b.score ?? 0) - (a.score ?? 0));\n\n// Pode vir errado (ex.: frase longa). S√≥ persiste se for um valor permitido.\nconst originalPrimaryRaw = payload.perfil_primario ?? null;\nconst originalPrimary = normalizeKey(originalPrimaryRaw);\n\nlet primary = originalPrimary;\nif (!primary || primary === 'misto' || !validTraits.has(primary)) {\n  primary = sorted[0]?.id ?? null;\n}\n\nlet secondary = sorted.find((entry) => entry.id !== primary)?.id ?? null;\nif (!secondary && sorted[1]) secondary = sorted[1].id;\n\nconst sumConfianca = scores.reduce((acc, entry) => acc + (entry.confiabilidade ?? 0), 0);\nconst confiancaMedia = scores.length ? Math.round(sumConfianca / scores.length) : null;\n\nlet dataConversa = null;\nif (chat.data_conversa) {\n  const parsed = new Date(chat.data_conversa);\n  if (!isNaN(parsed)) dataConversa = parsed.toISOString().slice(0, 10);\n}\nif (!dataConversa) dataConversa = new Date().toISOString().slice(0, 10);\n\nconst result = {\n  usuario_id: chat.usuario_id ?? null,\n  chat_id: chat.chat_id ?? chat.id ?? null,\n  data_conversa: dataConversa,\n\n  // `usuarios_perfis.perfil_original` estoura se vier texto longo; guardamos apenas se for v√°lido.\n  perfil_original: originalPrimary,\n  perfil_primario: primary,\n  perfil_secundario: secondary,\n\n  resumo_perfil: typeof payload.resumo_perfil === 'string' ? payload.resumo_perfil : null,\n  insuficiente: Boolean(payload.insuficiente),\n  confianca_media: Number.isFinite(confiancaMedia) ? confiancaMedia : null,\n  raw_resposta: payload\n};\n\nfor (const trait of traits) {\n  const data = payload.big_five?.[trait] ?? {};\n  result[`score_${trait}`] = normalizeInt0to100(data.score);\n  result[`confianca_${trait}`] = normalizeInt0to100(data.confiabilidade);\n}\n\nreturn [{ json: result }];"
      },
      "id": "236d5bf0-859e-492f-9168-eb3e4a166095",
      "name": "Preparar Registro BigFive",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        2048,
        1056
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "INSERT INTO usuarios_perfis (\n  usuario_id,\n  chat_id,\n  data_conversa,\n  perfil_original,\n  perfil_primario,\n  perfil_secundario,\n  resumo_perfil,\n  insuficiente,\n  score_openness,\n  score_conscientiousness,\n  score_extraversion,\n  score_agreeableness,\n  score_neuroticism,\n  confianca_openness,\n  confianca_conscientiousness,\n  confianca_extraversion,\n  confianca_agreeableness,\n  confianca_neuroticism,\n  confianca_media,\n  raw_resposta,\n  criado_em,\n  atualizado_em\n)\nVALUES (\n  $1::uuid,\n  $2::uuid,\n  $3::date,\n  $4::varchar,\n  $5::varchar,\n  $6::varchar,\n  $7::text,\n  $8::boolean,\n  $9::integer,\n  $10::integer,\n  $11::integer,\n  $12::integer,\n  $13::integer,\n  $14::integer,\n  $15::integer,\n  $16::integer,\n  $17::integer,\n  $18::integer,\n  $19::integer,\n  $20::jsonb,\n  NOW(),\n  NOW()\n)\nON CONFLICT (chat_id) DO UPDATE SET\n  perfil_original = EXCLUDED.perfil_original,\n  perfil_primario = EXCLUDED.perfil_primario,\n  perfil_secundario = EXCLUDED.perfil_secundario,\n  resumo_perfil = EXCLUDED.resumo_perfil,\n  insuficiente = EXCLUDED.insuficiente,\n  score_openness = EXCLUDED.score_openness,\n  score_conscientiousness = EXCLUDED.score_conscientiousness,\n  score_extraversion = EXCLUDED.score_extraversion,\n  score_agreeableness = EXCLUDED.score_agreeableness,\n  score_neuroticism = EXCLUDED.score_neuroticism,\n  confianca_openness = EXCLUDED.confianca_openness,\n  confianca_conscientiousness = EXCLUDED.confianca_conscientiousness,\n  confianca_extraversion = EXCLUDED.confianca_extraversion,\n  confianca_agreeableness = EXCLUDED.confianca_agreeableness,\n  confianca_neuroticism = EXCLUDED.confianca_neuroticism,\n  confianca_media = EXCLUDED.confianca_media,\n  raw_resposta = EXCLUDED.raw_resposta,\n  atualizado_em = NOW()\nRETURNING id, perfil_primario;",
        "options": {
          "queryReplacement": "={{ [\n  $json.usuario_id ?? null,\n  $json.chat_id ?? null,\n  $json.data_conversa ?? null,\n  $json.perfil_original ?? null,\n  $json.perfil_primario ?? null,\n  $json.perfil_secundario ?? null,\n  $json.resumo_perfil ?? null,\n  $json.insuficiente === true,\n  $json.score_openness ?? null,\n  $json.score_conscientiousness ?? null,\n  $json.score_extraversion ?? null,\n  $json.score_agreeableness ?? null,\n  $json.score_neuroticism ?? null,\n  $json.confianca_openness ?? null,\n  $json.confianca_conscientiousness ?? null,\n  $json.confianca_extraversion ?? null,\n  $json.confianca_agreeableness ?? null,\n  $json.confianca_neuroticism ?? null,\n  $json.confianca_media ?? null,\n  $json.raw_resposta ?? {}\n] }}"
        }
      },
      "id": "ea82fe54-f883-4342-9da8-c42f1f9b3c69",
      "name": "Gravar BigFive",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        2224,
        1056
      ],
      "credentials": {
        "postgres": {
          "id": "8ySWxtSO7gYK5uue",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "79d69d97-4592-4f1a-a241-f5aa4af9ec22",
              "name": "result",
              "value": "true",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        3200,
        288
      ],
      "id": "de64be79-d4a5-4722-87d0-5d5a6938468b",
      "name": "Edit Fields"
    },
    {
      "id": "07157f84-7adf-4173-91bb-cfab07c2df54",
      "name": "Marcar Sabotadores Processado",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        2240,
        -464
      ],
      "parameters": {
        "operation": "executeQuery",
        "query": "-- Marca sabotadores como processado (mesmo se 0 detectados)\nINSERT INTO ops_chat_experts_status (chat_id, usuario_id, processed_sabotadores, updated_at)\nVALUES ($1::uuid, $2::uuid, true, NOW())\nON CONFLICT (chat_id) DO UPDATE SET\n  usuario_id = EXCLUDED.usuario_id,\n  processed_sabotadores = true,\n  updated_at = NOW()\nRETURNING chat_id, processed_sabotadores;",
        "options": {
          "queryReplacement": "={{ [ $('Buscar Chat + Flags').first().json.chat_id, $('Buscar Chat + Flags').first().json.usuario_id ] }}"
        }
      },
      "credentials": {
        "postgres": {
          "id": "8ySWxtSO7gYK5uue",
          "name": "Postgres account"
        }
      }
    },
    {
      "id": "770c244f-08c0-43b4-b1ff-aa564354c757",
      "name": "Marcar Emo√ß√µes Processado",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        2144,
        16
      ],
      "parameters": {
        "operation": "executeQuery",
        "query": "-- Marca emo√ß√µes como processado (mesmo se 0 emo√ß√µes detectadas)\nINSERT INTO ops_chat_experts_status (chat_id, usuario_id, processed_emocoes, updated_at)\nVALUES ($1::uuid, $2::uuid, true, NOW())\nON CONFLICT (chat_id) DO UPDATE SET\n  usuario_id = EXCLUDED.usuario_id,\n  processed_emocoes = true,\n  updated_at = NOW()\nRETURNING chat_id, processed_emocoes;",
        "options": {
          "queryReplacement": "={{ [ $('Buscar Chat + Flags').first().json.chat_id, $('Buscar Chat + Flags').first().json.usuario_id ] }}"
        }
      },
      "credentials": {
        "postgres": {
          "id": "8ySWxtSO7gYK5uue",
          "name": "Postgres account"
        }
      }
    }
  ],
  "connections": {
    "start": {
      "main": [
        [
          {
            "node": "Buscar Chat + Flags",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Buscar Chat + Flags": {
      "main": [
        [
          {
            "node": "Falta Sabotadores?",
            "type": "main",
            "index": 0
          },
          {
            "node": "Falta Emo√ß√µes?",
            "type": "main",
            "index": 0
          },
          {
            "node": "Falta Humor/Energia?",
            "type": "main",
            "index": 0
          },
          {
            "node": "Falta BigFive?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Falta Sabotadores?": {
      "main": [
        [
          {
            "node": "Buscar Cat√°logo Sabotadores",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Buscar Cat√°logo Sabotadores": {
      "main": [
        [
          {
            "node": "sabotadores",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "sabotadores": {
      "main": [
        [
          {
            "node": "Gravar Sabotadores",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Falta Emo√ß√µes?": {
      "main": [
        [
          {
            "node": "panas e emocoes",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "panas e emocoes": {
      "main": [
        [
          {
            "node": "Gravar Emo√ß√µes",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Falta Humor/Energia?": {
      "main": [
        [
          {
            "node": "humor e energia",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Falta BigFive?": {
      "main": [
        [
          {
            "node": "Buscar Hist√≥rico BigFive",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Buscar Hist√≥rico BigFive": {
      "main": [
        [
          {
            "node": "Preparar Contexto BigFive",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Preparar Contexto BigFive": {
      "main": [
        [
          {
            "node": "Big Five",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Big Five": {
      "main": [
        [
          {
            "node": "Preparar Registro BigFive",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Preparar Registro BigFive": {
      "main": [
        [
          {
            "node": "Gravar BigFive",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "LLM Sabotadores": {
      "ai_languageModel": [
        [
          {
            "node": "sabotadores",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Parser Sabotadores",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Parser Sabotadores": {
      "ai_outputParser": [
        [
          {
            "node": "sabotadores",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "LLM PANAS": {
      "ai_languageModel": [
        [
          {
            "node": "panas e emocoes",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Parser PANAS",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Parser PANAS": {
      "ai_outputParser": [
        [
          {
            "node": "panas e emocoes",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "LLM Humor": {
      "ai_languageModel": [
        [
          {
            "node": "humor e energia",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Parser Humor",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Parser Humor": {
      "ai_outputParser": [
        [
          {
            "node": "humor e energia",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "LLM BigFive": {
      "ai_languageModel": [
        [
          {
            "node": "Big Five",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Parser BigFive",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Parser BigFive": {
      "ai_outputParser": [
        [
          {
            "node": "Big Five",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Gravar Humor": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gravar BigFive": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "humor e energia": {
      "main": [
        [
          {
            "node": "Gravar Humor",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gravar Sabotadores": {
      "main": [
        [
          {
            "node": "Marcar Sabotadores Processado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Marcar Sabotadores Processado": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gravar Emo√ß√µes": {
      "main": [
        [
          {
            "node": "Marcar Emo√ß√µes Processado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Marcar Emo√ß√µes Processado": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": false
  },
  "staticData": null,
  "meta": null,
  "pinData": {
    "start": [
      {
        "json": {
          "chat_id": "2434b29a-4e59-4b0c-bca5-d14d83a9e966"
        },
        "pairedItem": {
          "item": 0
        }
      }
    ]
  },
  "activeVersionId": null,
  "shared": [
    {
      "createdAt": "2025-12-19T10:24:20.692Z",
      "role": "workflow:owner",
      "workflowId": "PNFN2i4YaWclauDh",
      "projectId": "u1M57XAwIiLpPwjp",
      "project": {
        "createdAt": "2025-09-16T16:13:20.606Z",
        "id": "u1M57XAwIiLpPwjp",
        "name": "Aldo Santos <lindualdo@hotmail.com>",
        "type": "personal",
        "icon": null,
        "description": null,
        "projectRelations": [
          {
            "createdAt": "2025-09-16T16:13:20.606Z",
            "userId": "fa864d51-475e-4765-b3b4-12788525a3e6",
            "projectId": "u1M57XAwIiLpPwjp",
            "user": {
              "createdAt": "2025-09-16T16:13:20.056Z",
              "id": "fa864d51-475e-4765-b3b4-12788525a3e6",
              "email": "lindualdo@hotmail.com",
              "firstName": "Aldo",
              "lastName": "Santos",
              "personalizationAnswers": {
                "version": "v4",
                "personalization_survey_submitted_at": "2025-09-16T16:22:10.583Z",
                "personalization_survey_n8n_version": "1.108.1"
              },
              "settings": {
                "userActivated": true,
                "firstSuccessfulWorkflowId": "jUAvu7DUAzyqZhJd",
                "userActivatedAt": 1758041156747,
                "easyAIWorkflowOnboarded": true,
                "dismissedCallouts": {
                  "preBuiltAgentsModalCallout": true
                },
                "npsSurvey": {
                  "responded": true,
                  "lastShownAt": 1759918723295
                }
              },
              "disabled": false,
              "mfaEnabled": false,
              "isPending": false
            }
          }
        ]
      }
    }
  ],
  "tags": [],
  "activeVersion": null
}
