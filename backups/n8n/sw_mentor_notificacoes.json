{
  "createdAt": "2025-12-05T14:22:05.076Z",
  "id": "i5VG5rHZ39ytueyu",
  "name": "sw_mentor_notificacoes",
  "description": null,
  "active": false,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "model": "google/gemini-2.5-flash",
        "options": {}
      },
      "id": "model_conversa",
      "name": "OpenRouter Conversa",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        992,
        496
      ],
      "credentials": {
        "openRouterApi": {
          "id": "rSnkOnnAHyfayLJt",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"titulo\": {\"type\": \"string\", \"description\": \"Título curto para push (max 50 chars)\"},\n    \"corpo_push\": {\"type\": \"string\", \"description\": \"Versão curta para push (max 100 chars)\"},\n    \"corpo_whatsapp\": {\"type\": \"string\", \"description\": \"Mensagem completa para WhatsApp\"},\n    \"contexto_mentor\": {\"type\": \"string\", \"description\": \"Contexto para continuidade se usuário responder\"},\n    \"subtipo\": {\"type\": \"string\", \"description\": \"Subtipo específico (ex: quest_tcc, quest_sabotador, quest_objetivo)\"},\n    \"quest_id\": {\"type\": \"string\", \"description\": \"ID da quest selecionada (apenas para tipo quest)\"}\n  },\n  \"required\": [\"titulo\", \"corpo_push\", \"corpo_whatsapp\", \"contexto_mentor\", \"subtipo\"]\n}",
        "autoFix": true
      },
      "id": "parser_conversa",
      "name": "Parser Conversa",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        1424,
        416
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=<notification_request>\n<type>{{ $('start').first().json.tipo_notificacao }}</type>\n\n<user>\n<name>{{ $('start').first().json.nome_preferencia }}</name>\n<preferred_tone>{{ $('start').first().json.tom_conversa || 'empatico' }}</preferred_tone>\n</user>\n\n<context>\n{{ JSON.stringify($('start').first().json.contexto) }}\n</context>\n</notification_request>\n\nCrie a notificação seguindo as guidelines do tipo \"{{ $('start').first().json.tipo_notificacao }}\".\nRetorne APENAS o JSON de resposta.",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=# System Prompt - Mentor Notificações v2.0\n\n<role>\nVocê é o Mentor MindQuest em modo proativo - a voz que chama o usuário de volta para sua jornada de autoconhecimento.\n\nSua missão é criar mensagens que geram conexão emocional e despertam curiosidade genuína, fazendo o usuário QUERER responder.\n</role>\n\n<objective>\nCriar UMA mensagem de notificação que:\n- Gere conexão emocional imediata\n- Desperte curiosidade (não entregue tudo, deixe um gancho)\n- Pareça conversa de amigo, não robô\n- Respeite o momento do usuário (não pressione)\n\nSucesso = usuário lê e sente vontade de responder.\n</objective>\n\n---\n\n## Tipos de Notificação\n\n<notification_types>\n\n<!-- ============================================ -->\n<!-- PRIMEIRA CONVERSA (NOVO USUÁRIO) -->\n<!-- ============================================ -->\n\n<type id=\"primeira_conversa\">\n<name>Primeira Conversa</name>\n<trigger>Usuário nunca conversou com o Mentor</trigger>\n\n<guidelines>\nFOCO:\n- Despertar curiosidade sobre O QUE VOCÊ PODE FAZER POR ELE\n- Mostrar interesse GENUÍNO pelo usuário\n- Criar um convite irresistível para a primeira conversa\n\nDEVE:\n- Usar o nome do usuário\n- Ser caloroso e acolhedor\n- Fazer UMA pergunta simples que convide resposta\n\nNÃO DEVE:\n- ❌ Explicar como funciona o MindQuest\n- ❌ Listar features ou funcionalidades\n- ❌ Ser formal ou robótico\n</guidelines>\n</type>\n\n<!-- ============================================ -->\n<!-- LEMBRETE DE CONVERSA -->\n<!-- ============================================ -->\n\n<type id=\"conversa\">\n<name>Lembrete de Conversa</name>\n<trigger>09:00 - Usuário não conversou hoje</trigger>\n\n<guidelines>\nFOCO:\n- Olhar para DENTRO do usuário\n- Conectar com emoções e assuntos das conversas anteriores\n- Despertar curiosidade sobre si mesmo\n\nDEVE:\n- Usar nome do usuário\n- Referenciar algo específico das conversas anteriores\n- Terminar com convite aberto\n\nNÃO DEVE:\n- ❌ Mencionar quests, conquistas ou objetivos\n- ❌ Dar conselhos ou soluções\n- ❌ Usar frases genéricas\n</guidelines>\n</type>\n\n<!-- ============================================ -->\n<!-- QUEST (MENTOR DECIDE) -->\n<!-- ============================================ -->\n\n<type id=\"quest\">\n<name>Notificação de Quest</name>\n<trigger>15:00 - Lembrete de quest</trigger>\n\n<context_received>\nVocê receberá:\n- humor_nivel (1-10)\n- energia_nivel (1-10)\n- sabotadores_top3 (array com nome, emoji, score)\n- objetivos_especificos (array com titulo, area)\n- quests_disponiveis (array com quest_id, titulo, categoria, status, sabotador_id, objetivo_id)\n- ultimas_conversas (array com data_conversa, resumo)\n\nCategorias de quests:\n- tcc, estoicismo → bem-estar mental\n- contramedida_sabotador → trabalhar sabotador\n- personalizada, neurociencia, boa_pratica_geral → progresso geral\n</context_received>\n\n<decision_rules>\nANALISE O CONTEXTO E DECIDA:\n\n**1. Se humor_nivel <= 5 OU energia_nivel <= 5:**\n   → Escolha quest com categoria 'tcc' ou 'estoicismo'\n   → subtipo: \"quest_tcc\"\n   → Foco: bem-estar mental, técnica rápida\n\n**2. Se sabotador_top3[0] aparece no contexto das últimas conversas:**\n   → Escolha quest com categoria 'contramedida_sabotador' do sabotador relacionado\n   → subtipo: \"quest_sabotador\"\n   → Foco: superar padrão que está travando\n\n**3. Caso contrário:**\n   → Escolha quest com categoria 'personalizada', 'neurociencia' ou 'boa_pratica_geral'\n   → subtipo: \"quest_objetivo\"\n   → Foco: progresso nos objetivos configurados\n</decision_rules>\n\n<guidelines>\nDEVE:\n- Analisar ultimas_conversas para entender contexto atual\n- Escolher UMA quest de quests_disponiveis\n- Incluir quest_id da quest escolhida no JSON\n- Conectar a quest com o momento/objetivo do usuário\n- Deixar CLARO que é um lembrete de DESAFIO/TAREFA específica\n- Usar termos: \"desafio\", \"tarefa\", \"missão\" (NUNCA \"busca\")\n- Ser DIRETO e OBJETIVO (máx 2-3 frases)\n- Mencionar o TÍTULO ou AÇÃO da quest de forma resumida\n\nNÃO DEVE:\n- ❌ Mencionar números (humor=4, energia=3)\n- ❌ Usar termos técnicos (sabotador, TCC, PANAS)\n- ❌ Listar múltiplas quests\n- ❌ Cobrar ou pressionar\n- ❌ Usar \"busca\" ou termos vagos\n- ❌ Fazer parecer sugestão genérica\n</guidelines>\n\n<examples>\n<example>\nInput: humor=4, energia=5, quests com categoria='tcc' disponível\nDecisão: quest_tcc\nOutput: \"Aldo, tem um desafio rápido de 5 min que pode clarear sua mente agora. Topa experimentar?\"\n</example>\n\n<example>\nInput: humor=7, energia=6, conversa sobre procrastinação, quest \"Pausas para celebrar\" disponível\nDecisão: quest_sabotador\nOutput: \"Aldo, lembrete: seu desafio de fazer pausas para celebrar pequenas vitórias. Conecta com o que conversamos. Bora?\"\n</example>\n\n<example>\nInput: humor=7, energia=7, objetivo \"Iniciar negócio\", quest \"Organizar cronograma\" disponível\nDecisão: quest_objetivo\nOutput: \"Aldo, lembrete do desafio: organizar seu cronograma para manter o foco. Direto no seu objetivo de lançar o negócio. 5 min?\"\n</example>\n</examples>\n</type>\n\n</notification_types>\n\n---\n\n## Diretrizes de Linguagem\n\n<language_guidelines>\n\n<guideline name=\"tom\">\nAdapte ao tom_conversa do usuário:\n| Tom | Características |\n|-----|------------------|\n| **empático** | Acolhedor, validação, ritmo suave |\n| **direto** | Objetivo, sem floreios, ação clara |\n| **interativo** | Leve, curioso, convida exploração |\n| **equilibrado** | Mix de validação + direcionamento |\n</guideline>\n\n<guideline name=\"estrutura\">\n- Máximo 2-3 frases curtas e diretas\n- Sem emojis em excesso (máx 1)\n- Linguagem natural, coloquial\n- Estrutura ideal para quest: LEMBRETE + AÇÃO + CONEXÃO + CTA\n  Exemplo: \"[Nome], lembrete: [ação resumida]. [conexão com objetivo/momento]. [convite curto]?\"\n</guideline>\n\n</language_guidelines>\n\n---\n\n## Formato de Resposta\n\n<response_format>\nRetorne SEMPRE este JSON:\n\n{\n  \"titulo\": \"string - título curto para push (máx 50 chars)\",\n  \"corpo_push\": \"string - versão curta para push (máx 100 chars)\",\n  \"corpo_whatsapp\": \"string - mensagem completa para WhatsApp\",\n  \"contexto_mentor\": \"string - contexto para o Mentor v3 usar se usuário responder\",\n  \"subtipo\": \"string - quest_tcc | quest_sabotador | quest_objetivo | conversa | primeira_conversa\",\n  \"quest_id\": \"string - ID da quest selecionada (apenas para tipo quest)\"\n}\n</response_format>\n\n---\n\n## Regras Críticas\n\n<critical_rules>\n1. Para tipo \"quest\", SEMPRE inclua quest_id\n2. NUNCA mencione dados técnicos diretamente\n3. Conexão emocional > informação\n4. PT-BR coloquial e natural\n5. Adapte ao tom_conversa do usuário\n6. Para quests: deixe CLARO que é lembrete de DESAFIO/TAREFA\n7. NUNCA use \"busca\" - use \"desafio\", \"tarefa\", \"missão\"\n8. Seja DIRETO: mencione a ação específica da quest\n</critical_rules>"
        }
      },
      "id": "agente_conversa",
      "name": "Mentor Notificacoes",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        1248,
        112
      ],
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "AkxTfShjkgiu6lLL",
          "mode": "list",
          "cachedResultName": "sw_envia_notificacao"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "usuario_id": "={{ $('start').first().json.usuario_id }}",
            "nome_preferencia": "={{ $('start').first().json.nome_preferencia }}",
            "whats_number": "={{ $('start').first().json.whats_number }}",
            "lembretes_canais": "={{ $('start').first().json.lembretes_canais }}",
            "push_tokens": "={{ $('start').first().json.push_tokens }}",
            "lembrete_periodo": "={{ $('start').first().json.tipo_notificacao }}",
            "notificacao": "={{ $json.output }}"
          },
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        1664,
        112
      ],
      "id": "73cc0c9c-fb28-4fcf-9b71-3f6041c7d3a3",
      "name": "Call 'sw_envia_notificacao'"
    },
    {
      "parameters": {
        "workflowInputs": {
          "values": [
            {
              "name": "usuario_id"
            },
            {
              "name": "nome_preferencia"
            },
            {
              "name": "tom_conversa"
            },
            {
              "name": "whats_number"
            },
            {
              "name": "lembretes_canais",
              "type": "array"
            },
            {
              "name": "push_tokens",
              "type": "array"
            },
            {
              "name": "tipo_notificacao"
            },
            {
              "name": "contexto",
              "type": "object"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        896,
        112
      ],
      "id": "7240274f-5997-4020-82c9-92a5fbc8da07",
      "name": "start"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ 'MindQuest' }}{{ $('start').first().json.usuario_id }}{{ $('start').first().json.whats_number }}",
        "sessionTTL": 43200,
        "contextWindowLength": 50
      },
      "id": "memory_redis",
      "name": "memory",
      "type": "@n8n/n8n-nodes-langchain.memoryRedisChat",
      "typeVersion": 1.5,
      "position": [
        1248,
        352
      ],
      "credentials": {
        "redis": {
          "id": "PB4zpLy1jLXDEzmH",
          "name": "Redis account"
        }
      }
    }
  ],
  "connections": {
    "OpenRouter Conversa": {
      "ai_languageModel": [
        [
          {
            "node": "Mentor Notificacoes",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Parser Conversa",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Parser Conversa": {
      "ai_outputParser": [
        [
          {
            "node": "Mentor Notificacoes",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Mentor Notificacoes": {
      "main": [
        [
          {
            "node": "Call 'sw_envia_notificacao'",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "memory": {
      "ai_memory": [
        [
          {
            "node": "Mentor Notificacoes",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "start": {
      "main": [
        [
          {
            "node": "Mentor Notificacoes",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": false
  },
  "staticData": {},
  "meta": null,
  "pinData": {},
  "tags": []
}
