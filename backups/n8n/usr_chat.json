{
  "createdAt": "2025-09-23T18:04:11.192Z",
  "id": "6R8bagGlYkBwyyMC",
  "name": "usr_chat",
  "description": null,
  "active": true,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "UlInW9nmQs7vnPIP",
          "mode": "list",
          "cachedResultUrl": "/workflow/UlInW9nmQs7vnPIP",
          "cachedResultName": "chat_onboarding_simplificado"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "remoteJid": "={{ $('start').item.json.body.data.key.remoteJid }}",
            "pushName": "={{ $('start').first().json.body.data.pushName }}",
            "id": "={{ $('start').first().json.body.data.key.id }}",
            "evolution_instancia": "={{ $('start').first().json.body.instance }}",
            "menssagem": "={{ $('start').first().json.body.data.message.conversation }}",
            "whatsapp_number": "={{ $('start').first().json.body.data.key.remoteJid.split('@')[0]}}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "remoteJid",
              "displayName": "remoteJid",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "pushName",
              "displayName": "pushName",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "whatsapp_number",
              "displayName": "whatsapp_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "evolution_instancia",
              "displayName": "evolution_instancia",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "menssagem",
              "displayName": "menssagem",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        -192,
        -1472
      ],
      "id": "71f9c335-e04f-4c11-8760-75cc631fcf1f",
      "name": "new_user"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "3bf7a3c4-d2a9-4e86-af60-1af16d0b2dc7",
              "leftValue": "={{ $json.id }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -448,
        -1584
      ],
      "id": "3acabf8a-2b84-4f70-9ba8-498d8eeb6544",
      "name": "usr_exist?"
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "usuarios",
          "mode": "list",
          "cachedResultName": "usuarios"
        },
        "returnAll": true,
        "where": {
          "values": [
            {
              "column": "whatsapp_numero",
              "value": "={{ $('start').item.json.body.data.key.remoteJid.replace(\"@s.whatsapp.net\", \"\") }}"
            },
            {
              "column": "ativo",
              "value": "={{ true }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -688,
        -1584
      ],
      "id": "463baabd-2496-48ee-a938-20077d9e80c4",
      "name": "usr_validate",
      "alwaysOutputData": true,
      "credentials": {
        "postgres": {
          "id": "8ySWxtSO7gYK5uue",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "content": "## usr_chat\n**interface de entrada das msg do usr** ",
        "height": 80,
        "width": 288
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1424,
        -1840
      ],
      "id": "1fd157c9-00d6-40c4-bc46-b060eecc2d54",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "bdb7cd24-5cc8-4efd-899e-06716680dcdb",
              "leftValue": "={{ $json.ativo }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -192,
        -1664
      ],
      "id": "bb9df853-2609-477b-840b-22a7993486da",
      "name": "Usr Ativo?"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "MindQuest",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -1184,
        -1504
      ],
      "id": "ce8efc7f-b6cc-473a-ba0a-f7c95b5c962a",
      "name": "start",
      "webhookId": "9f15db7a-9363-4715-8605-f86bdb16c4fc"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        -688,
        -1376
      ],
      "id": "831fa89d-fc01-4a38-8656-b82cbbb5da2a",
      "name": "No Operation, do nothing"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "83a54f6a-a7e0-4a37-aa35-523c03b74b9c",
              "leftValue": "={{ $json.body.event }}",
              "rightValue": "messages.upsert",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "or"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -960,
        -1504
      ],
      "id": "dbba9915-6d1d-4fd4-a6b2-d9a1090d940d",
      "name": "messages.upsert ?"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "DJB5qWudX1Hqap1O",
          "mode": "list",
          "cachedResultUrl": "/workflow/DJB5qWudX1Hqap1O",
          "cachedResultName": "sw_evolution_send_message_v2"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "instanceName": "={{ $('start').first().json.body.instance }}",
            "remoteJidOrNumber": "={{ $('start').item.json.body.data.key.remoteJid }}",
            "messageText": "Ah que pena! Sua conta está inativa. Procure o suporte MindQuest"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "instanceName",
              "displayName": "instanceName",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "remoteJidOrNumber",
              "displayName": "remoteJidOrNumber",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "messageText",
              "displayName": "messageText",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "linkPreview",
              "displayName": "linkPreview",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "minDelayMs",
              "displayName": "minDelayMs",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        80,
        -1520
      ],
      "id": "259a5852-efec-40ed-bfdf-4273f1b5f770",
      "name": "msg - Inativo"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "GGJQTfLsJSoRW3I0",
          "mode": "list",
          "cachedResultUrl": "/workflow/GGJQTfLsJSoRW3I0",
          "cachedResultName": "mentor_mindquest_v3"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "body.data.key.fromMe": "={{ $('start').first().json.body.data.key.fromMe }}",
            "usr_id": "={{ $('usr_validate').first().json.id }}",
            "body.instance": "={{ $('start').first().json.body.instance }}",
            "body.data.key.remoteJid": "={{ $('start').first().json.body.data.key.remoteJid }}",
            "body.data.key.id": "={{ $('start').first().json.body.data.key.id }}",
            "body.data.pushName": "={{ $('start').first().json.body.data.pushName }}",
            "body.data.messageType": "={{ $('start').first().json.body.data.messageType }}",
            "body.data.message.conversation": "={{ $('start').first().json.body.data.message.conversation }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "usr_id",
              "displayName": "usr_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "body.instance",
              "displayName": "body.instance",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "body.data.key.remoteJid",
              "displayName": "body.data.key.remoteJid",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "body.data.key.id",
              "displayName": "body.data.key.id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "body.data.key.fromMe",
              "displayName": "body.data.key.fromMe",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "boolean"
            },
            {
              "id": "body.data.pushName",
              "displayName": "body.data.pushName",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "body.data.message.conversation",
              "displayName": "body.data.message.conversation",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "body.data.messageType",
              "displayName": "body.data.messageType",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        400,
        -1696
      ],
      "id": "9a6e2716-4a09-47d8-94f8-2572ea01d013",
      "name": "Mentor v3"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 3
          },
          "conditions": [
            {
              "id": "bd3754db-935f-4d81-b910-aeace977683c",
              "leftValue": "={{ $('usr_validate').item.json.id }}",
              "rightValue": "d949d81c-9235-41ce-8b3b-6b5d593c5e24",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        80,
        -1776
      ],
      "id": "1e11b036-eb0c-4ea3-975b-457487e4c057",
      "name": "Aldo?"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "xEsvaIT1BQSk3joK",
          "mode": "list",
          "cachedResultUrl": "/workflow/xEsvaIT1BQSk3joK",
          "cachedResultName": "mentor_mindquest_plus"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "body.data.key.fromMe": "={{ $('start').first().json.body.data.key.fromMe }}",
            "usr_id": "={{ $('usr_validate').first().json.id }}",
            "body.data.key.remoteJid": "={{ $('start').first().json.body.data.key.remoteJid }}",
            "body.instance": "={{ $('start').first().json.body.instance }}",
            "body.data.key.id": "={{ $('start').first().json.body.data.key.id }}",
            "body.data.pushName": "={{ $('start').first().json.body.data.pushName }}",
            "body.data.message.conversation": "={{ $('start').first().json.body.data.message.conversation }}",
            "body.data.messageType": "={{ $('start').first().json.body.data.messageType }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "usr_id",
              "displayName": "usr_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "body.instance",
              "displayName": "body.instance",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "body.data.key.remoteJid",
              "displayName": "body.data.key.remoteJid",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "body.data.key.id",
              "displayName": "body.data.key.id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "body.data.key.fromMe",
              "displayName": "body.data.key.fromMe",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "boolean"
            },
            {
              "id": "body.data.pushName",
              "displayName": "body.data.pushName",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "body.data.message.conversation",
              "displayName": "body.data.message.conversation",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "body.data.messageType",
              "displayName": "body.data.messageType",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        400,
        -1936
      ],
      "id": "a9cfd680-b722-48e1-a7af-5fe209356864",
      "name": "Mentor plu"
    }
  ],
  "connections": {
    "usr_exist?": {
      "main": [
        [
          {
            "node": "Usr Ativo?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "new_user",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "usr_validate": {
      "main": [
        [
          {
            "node": "usr_exist?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Usr Ativo?": {
      "main": [
        [
          {
            "node": "Aldo?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "msg - Inativo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "start": {
      "main": [
        [
          {
            "node": "messages.upsert ?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "messages.upsert ?": {
      "main": [
        [
          {
            "node": "usr_validate",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aldo?": {
      "main": [
        [
          {
            "node": "Mentor plu",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Mentor v3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {
    "Mentor v3": [
      {
        "json": {
          "success": true,
          "status": "PENDING",
          "httpStatus": null,
          "messageId": "3EB0DBDEA34B4EFDB3715C",
          "errorMessage": null,
          "response": {
            "success": true,
            "data": {
              "key": {
                "remoteJid": "351932786582@s.whatsapp.net",
                "fromMe": true,
                "id": "3EB0DBDEA34B4EFDB3715C"
              },
              "pushName": "Você",
              "status": "PENDING",
              "message": {
                "conversation": "Pontos fundamentais, Aldo. Vamos por partes para manter a clareza:\n\n• **Recorrências**: Na interface, mostramos apenas a \"instância do dia\". O usuário vê o que precisa fazer *hoje*. No banco, eu (Mentor) gero a série, mas o usuário só interage com uma por vez para não gerar ansiedade.\n\n• **Limites e Priorização**: Mantemos o limite de **3 ativas**. Se houver mais, eu priorizo por *Mind First*—se o seu humor está baixo ou um padrão sabotador está ativo, a quest de regulação emocional ou clareza fura a fila das tarefas técnicas.\n\n• **Energy Low**: Se o usuário pedir quest com energia baixa, eu não entrego tarefa pesada. Entrego uma \"Micro-Quest\" de recuperação (ex: 5 min de respiração ou organizar uma única gaveta). O sistema tem que ser o porto seguro, não mais uma cobrança.\n\nFaz sentido essa lógica de \"filtragem\" por mim antes de chegar na interface?"
              },
              "contextInfo": {
                "mentionedJid": [],
                "groupMentions": [],
                "ephemeralSettingTimestamp": {
                  "low": 1766592457,
                  "high": 0,
                  "unsigned": false
                },
                "disappearingMode": {
                  "initiator": 0
                }
              },
              "messageType": "conversation",
              "messageTimestamp": 1766765257,
              "instanceId": "df976ecf-000a-4a31-aeee-eaf025a8d9ff",
              "source": "web"
            }
          }
        },
        "pairedItem": {
          "item": 0
        }
      }
    ],
    "start": [
      {
        "json": {
          "headers": {
            "host": "mindquest-n8n.cloudfy.live",
            "user-agent": "axios/1.13.2",
            "content-length": "1432",
            "accept": "application/json, text/plain, */*",
            "accept-encoding": "gzip, br",
            "cdn-loop": "cloudflare; loops=1",
            "cf-connecting-ip": "5.78.124.8",
            "cf-ipcountry": "US",
            "cf-ray": "9b4294d6cc2cff03-PDX",
            "cf-visitor": "{\"scheme\":\"https\"}",
            "content-type": "application/json",
            "x-forwarded-for": "172.68.174.110",
            "x-forwarded-host": "mindquest-n8n.cloudfy.live",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "d49265bfcab0",
            "x-real-ip": "172.68.174.110"
          },
          "params": {},
          "query": {},
          "body": {
            "event": "messages.upsert",
            "instance": "MindQuest",
            "data": {
              "key": {
                "remoteJid": "351932786582@s.whatsapp.net",
                "remoteJidAlt": "111167292891314@lid",
                "fromMe": false,
                "id": "3BC1E870DE0AC3754517",
                "participant": "",
                "addressingMode": "pn"
              },
              "pushName": "Aldo Santos",
              "status": "DELIVERY_ACK",
              "message": {
                "conversation": "oi Arisa",
                "messageContextInfo": {
                  "threadId": [],
                  "deviceListMetadata": {
                    "senderKeyIndexes": [],
                    "recipientKeyIndexes": [],
                    "senderKeyHash": {
                      "0": 103,
                      "1": 187,
                      "2": 70,
                      "3": 56,
                      "4": 218,
                      "5": 135,
                      "6": 4,
                      "7": 49,
                      "8": 130,
                      "9": 223
                    },
                    "senderTimestamp": {
                      "low": 1761303556,
                      "high": 0,
                      "unsigned": true
                    },
                    "recipientKeyHash": {
                      "0": 28,
                      "1": 217,
                      "2": 49,
                      "3": 22,
                      "4": 37,
                      "5": 137,
                      "6": 190,
                      "7": 152,
                      "8": 138,
                      "9": 234
                    },
                    "recipientTimestamp": {
                      "low": 1765373799,
                      "high": 0,
                      "unsigned": true
                    }
                  },
                  "deviceListMetadataVersion": 2,
                  "messageSecret": {
                    "0": 115,
                    "1": 135,
                    "2": 225,
                    "3": 253,
                    "4": 6,
                    "5": 0,
                    "6": 44,
                    "7": 41,
                    "8": 117,
                    "9": 238,
                    "10": 52,
                    "11": 82,
                    "12": 1,
                    "13": 105,
                    "14": 254,
                    "15": 240,
                    "16": 216,
                    "17": 224,
                    "18": 199,
                    "19": 69,
                    "20": 214,
                    "21": 148,
                    "22": 166,
                    "23": 189,
                    "24": 235,
                    "25": 244,
                    "26": 161,
                    "27": 113,
                    "28": 211,
                    "29": 11,
                    "30": 78,
                    "31": 250
                  }
                }
              },
              "messageType": "conversation",
              "messageTimestamp": 1766773112,
              "instanceId": "df976ecf-000a-4a31-aeee-eaf025a8d9ff",
              "source": "unknown"
            },
            "destination": "https://mindquest-n8n.cloudfy.live/webhook/MindQuest",
            "date_time": "2025-12-26T15:18:33.326Z",
            "sender": "351928413957@s.whatsapp.net",
            "server_url": "https://mindquest-evolution.cloudfy.live",
            "apikey": "881FB17719A5-45F5-A1CD-2373E685DE43"
          },
          "webhookUrl": "https://mindquest-n8n.cloudfy.live/webhook/MindQuest",
          "executionMode": "production"
        },
        "pairedItem": {
          "item": 0
        }
      }
    ]
  },
  "activeVersionId": "24788be3-921a-4b61-81fd-ca94510f0d3a",
  "shared": [
    {
      "createdAt": "2025-09-23T18:04:11.192Z",
      "role": "workflow:owner",
      "workflowId": "6R8bagGlYkBwyyMC",
      "projectId": "u1M57XAwIiLpPwjp",
      "project": {
        "createdAt": "2025-09-16T16:13:20.606Z",
        "id": "u1M57XAwIiLpPwjp",
        "name": "Aldo Santos <lindualdo@hotmail.com>",
        "type": "personal",
        "icon": null,
        "description": null,
        "projectRelations": [
          {
            "createdAt": "2025-09-16T16:13:20.606Z",
            "userId": "fa864d51-475e-4765-b3b4-12788525a3e6",
            "projectId": "u1M57XAwIiLpPwjp",
            "user": {
              "createdAt": "2025-09-16T16:13:20.056Z",
              "id": "fa864d51-475e-4765-b3b4-12788525a3e6",
              "email": "lindualdo@hotmail.com",
              "firstName": "Aldo",
              "lastName": "Santos",
              "personalizationAnswers": {
                "version": "v4",
                "personalization_survey_submitted_at": "2025-09-16T16:22:10.583Z",
                "personalization_survey_n8n_version": "1.108.1"
              },
              "settings": {
                "userActivated": true,
                "firstSuccessfulWorkflowId": "jUAvu7DUAzyqZhJd",
                "userActivatedAt": 1758041156747,
                "easyAIWorkflowOnboarded": true,
                "dismissedCallouts": {
                  "preBuiltAgentsModalCallout": true
                },
                "npsSurvey": {
                  "responded": true,
                  "lastShownAt": 1759918723295
                }
              },
              "disabled": false,
              "mfaEnabled": false,
              "isPending": false
            }
          }
        ]
      }
    }
  ],
  "tags": [],
  "activeVersion": {
    "createdAt": "2025-12-26T18:25:55.340Z",
    "workflowId": "6R8bagGlYkBwyyMC",
    "nodes": [
      {
        "parameters": {
          "workflowId": {
            "__rl": true,
            "value": "UlInW9nmQs7vnPIP",
            "mode": "list",
            "cachedResultUrl": "/workflow/UlInW9nmQs7vnPIP",
            "cachedResultName": "chat_onboarding_simplificado"
          },
          "workflowInputs": {
            "mappingMode": "defineBelow",
            "value": {
              "remoteJid": "={{ $('start').item.json.body.data.key.remoteJid }}",
              "pushName": "={{ $('start').first().json.body.data.pushName }}",
              "id": "={{ $('start').first().json.body.data.key.id }}",
              "evolution_instancia": "={{ $('start').first().json.body.instance }}",
              "menssagem": "={{ $('start').first().json.body.data.message.conversation }}",
              "whatsapp_number": "={{ $('start').first().json.body.data.key.remoteJid.split('@')[0]}}"
            },
            "matchingColumns": [],
            "schema": [
              {
                "id": "remoteJid",
                "displayName": "remoteJid",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              },
              {
                "id": "pushName",
                "displayName": "pushName",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              },
              {
                "id": "id",
                "displayName": "id",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              },
              {
                "id": "whatsapp_number",
                "displayName": "whatsapp_number",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              },
              {
                "id": "evolution_instancia",
                "displayName": "evolution_instancia",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              },
              {
                "id": "menssagem",
                "displayName": "menssagem",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": true
          },
          "options": {}
        },
        "type": "n8n-nodes-base.executeWorkflow",
        "typeVersion": 1.3,
        "position": [
          -192,
          -1472
        ],
        "id": "71f9c335-e04f-4c11-8760-75cc631fcf1f",
        "name": "new_user"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "3bf7a3c4-d2a9-4e86-af60-1af16d0b2dc7",
                "leftValue": "={{ $json.id }}",
                "rightValue": "",
                "operator": {
                  "type": "string",
                  "operation": "notEmpty",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          -448,
          -1584
        ],
        "id": "3acabf8a-2b84-4f70-9ba8-498d8eeb6544",
        "name": "usr_exist?"
      },
      {
        "parameters": {
          "operation": "select",
          "schema": {
            "__rl": true,
            "mode": "list",
            "value": "public"
          },
          "table": {
            "__rl": true,
            "value": "usuarios",
            "mode": "list",
            "cachedResultName": "usuarios"
          },
          "returnAll": true,
          "where": {
            "values": [
              {
                "column": "whatsapp_numero",
                "value": "={{ $('start').item.json.body.data.key.remoteJid.replace(\"@s.whatsapp.net\", \"\") }}"
              },
              {
                "column": "ativo",
                "value": "={{ true }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.6,
        "position": [
          -688,
          -1584
        ],
        "id": "463baabd-2496-48ee-a938-20077d9e80c4",
        "name": "usr_validate",
        "alwaysOutputData": true,
        "credentials": {
          "postgres": {
            "id": "8ySWxtSO7gYK5uue",
            "name": "Postgres account"
          }
        }
      },
      {
        "parameters": {
          "content": "## usr_chat\n**interface de entrada das msg do usr** ",
          "height": 80,
          "width": 288
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          -1424,
          -1840
        ],
        "id": "1fd157c9-00d6-40c4-bc46-b060eecc2d54",
        "name": "Sticky Note"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 2
            },
            "conditions": [
              {
                "id": "bdb7cd24-5cc8-4efd-899e-06716680dcdb",
                "leftValue": "={{ $json.ativo }}",
                "rightValue": "",
                "operator": {
                  "type": "boolean",
                  "operation": "true",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          -192,
          -1664
        ],
        "id": "bb9df853-2609-477b-840b-22a7993486da",
        "name": "Usr Ativo?"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "MindQuest",
          "options": {}
        },
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2.1,
        "position": [
          -1184,
          -1504
        ],
        "id": "ce8efc7f-b6cc-473a-ba0a-f7c95b5c962a",
        "name": "start",
        "webhookId": "9f15db7a-9363-4715-8605-f86bdb16c4fc"
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.noOp",
        "typeVersion": 1,
        "position": [
          -688,
          -1376
        ],
        "id": "831fa89d-fc01-4a38-8656-b82cbbb5da2a",
        "name": "No Operation, do nothing"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "loose",
              "version": 2
            },
            "conditions": [
              {
                "id": "83a54f6a-a7e0-4a37-aa35-523c03b74b9c",
                "leftValue": "={{ $json.body.event }}",
                "rightValue": "messages.upsert",
                "operator": {
                  "type": "string",
                  "operation": "equals",
                  "name": "filter.operator.equals"
                }
              }
            ],
            "combinator": "or"
          },
          "looseTypeValidation": true,
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          -960,
          -1504
        ],
        "id": "dbba9915-6d1d-4fd4-a6b2-d9a1090d940d",
        "name": "messages.upsert ?"
      },
      {
        "parameters": {
          "workflowId": {
            "__rl": true,
            "value": "DJB5qWudX1Hqap1O",
            "mode": "list",
            "cachedResultUrl": "/workflow/DJB5qWudX1Hqap1O",
            "cachedResultName": "sw_evolution_send_message_v2"
          },
          "workflowInputs": {
            "mappingMode": "defineBelow",
            "value": {
              "instanceName": "={{ $('start').first().json.body.instance }}",
              "remoteJidOrNumber": "={{ $('start').item.json.body.data.key.remoteJid }}",
              "messageText": "Ah que pena! Sua conta está inativa. Procure o suporte MindQuest"
            },
            "matchingColumns": [],
            "schema": [
              {
                "id": "instanceName",
                "displayName": "instanceName",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              },
              {
                "id": "remoteJidOrNumber",
                "displayName": "remoteJidOrNumber",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              },
              {
                "id": "messageText",
                "displayName": "messageText",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              },
              {
                "id": "linkPreview",
                "displayName": "linkPreview",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              },
              {
                "id": "minDelayMs",
                "displayName": "minDelayMs",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": true
          },
          "options": {}
        },
        "type": "n8n-nodes-base.executeWorkflow",
        "typeVersion": 1.3,
        "position": [
          80,
          -1520
        ],
        "id": "259a5852-efec-40ed-bfdf-4273f1b5f770",
        "name": "msg - Inativo"
      },
      {
        "parameters": {
          "workflowId": {
            "__rl": true,
            "value": "GGJQTfLsJSoRW3I0",
            "mode": "list",
            "cachedResultUrl": "/workflow/GGJQTfLsJSoRW3I0",
            "cachedResultName": "mentor_mindquest_v3"
          },
          "workflowInputs": {
            "mappingMode": "defineBelow",
            "value": {
              "body.data.key.fromMe": "={{ $('start').first().json.body.data.key.fromMe }}",
              "usr_id": "={{ $('usr_validate').first().json.id }}",
              "body.instance": "={{ $('start').first().json.body.instance }}",
              "body.data.key.remoteJid": "={{ $('start').first().json.body.data.key.remoteJid }}",
              "body.data.key.id": "={{ $('start').first().json.body.data.key.id }}",
              "body.data.pushName": "={{ $('start').first().json.body.data.pushName }}",
              "body.data.messageType": "={{ $('start').first().json.body.data.messageType }}",
              "body.data.message.conversation": "={{ $('start').first().json.body.data.message.conversation }}"
            },
            "matchingColumns": [],
            "schema": [
              {
                "id": "usr_id",
                "displayName": "usr_id",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              },
              {
                "id": "body.instance",
                "displayName": "body.instance",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              },
              {
                "id": "body.data.key.remoteJid",
                "displayName": "body.data.key.remoteJid",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              },
              {
                "id": "body.data.key.id",
                "displayName": "body.data.key.id",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              },
              {
                "id": "body.data.key.fromMe",
                "displayName": "body.data.key.fromMe",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "boolean"
              },
              {
                "id": "body.data.pushName",
                "displayName": "body.data.pushName",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              },
              {
                "id": "body.data.message.conversation",
                "displayName": "body.data.message.conversation",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              },
              {
                "id": "body.data.messageType",
                "displayName": "body.data.messageType",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": true
          },
          "options": {}
        },
        "type": "n8n-nodes-base.executeWorkflow",
        "typeVersion": 1.3,
        "position": [
          400,
          -1696
        ],
        "id": "9a6e2716-4a09-47d8-94f8-2572ea01d013",
        "name": "Mentor v3"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "loose",
              "version": 3
            },
            "conditions": [
              {
                "id": "bd3754db-935f-4d81-b910-aeace977683c",
                "leftValue": "={{ $('usr_validate').item.json.id }}",
                "rightValue": "d949d81c-9235-41ce-8b3b-6b5d593c5e24",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          },
          "looseTypeValidation": true,
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.3,
        "position": [
          80,
          -1776
        ],
        "id": "1e11b036-eb0c-4ea3-975b-457487e4c057",
        "name": "Aldo?"
      },
      {
        "parameters": {
          "workflowId": {
            "__rl": true,
            "value": "xEsvaIT1BQSk3joK",
            "mode": "list",
            "cachedResultUrl": "/workflow/xEsvaIT1BQSk3joK",
            "cachedResultName": "mentor_mindquest_plus"
          },
          "workflowInputs": {
            "mappingMode": "defineBelow",
            "value": {
              "body.data.key.fromMe": "={{ $('start').first().json.body.data.key.fromMe }}",
              "usr_id": "={{ $('usr_validate').first().json.id }}",
              "body.data.key.remoteJid": "={{ $('start').first().json.body.data.key.remoteJid }}",
              "body.instance": "={{ $('start').first().json.body.instance }}",
              "body.data.key.id": "={{ $('start').first().json.body.data.key.id }}",
              "body.data.pushName": "={{ $('start').first().json.body.data.pushName }}",
              "body.data.message.conversation": "={{ $('start').first().json.body.data.message.conversation }}",
              "body.data.messageType": "={{ $('start').first().json.body.data.messageType }}"
            },
            "matchingColumns": [],
            "schema": [
              {
                "id": "usr_id",
                "displayName": "usr_id",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              },
              {
                "id": "body.instance",
                "displayName": "body.instance",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              },
              {
                "id": "body.data.key.remoteJid",
                "displayName": "body.data.key.remoteJid",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              },
              {
                "id": "body.data.key.id",
                "displayName": "body.data.key.id",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              },
              {
                "id": "body.data.key.fromMe",
                "displayName": "body.data.key.fromMe",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "boolean"
              },
              {
                "id": "body.data.pushName",
                "displayName": "body.data.pushName",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              },
              {
                "id": "body.data.message.conversation",
                "displayName": "body.data.message.conversation",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              },
              {
                "id": "body.data.messageType",
                "displayName": "body.data.messageType",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "canBeUsedToMatch": true,
                "type": "string"
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": true
          },
          "options": {}
        },
        "type": "n8n-nodes-base.executeWorkflow",
        "typeVersion": 1.3,
        "position": [
          400,
          -1936
        ],
        "id": "a9cfd680-b722-48e1-a7af-5fe209356864",
        "name": "Mentor plu"
      }
    ],
    "connections": {
      "usr_exist?": {
        "main": [
          [
            {
              "node": "Usr Ativo?",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "new_user",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "usr_validate": {
        "main": [
          [
            {
              "node": "usr_exist?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Usr Ativo?": {
        "main": [
          [
            {
              "node": "Aldo?",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "msg - Inativo",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "start": {
        "main": [
          [
            {
              "node": "messages.upsert ?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "messages.upsert ?": {
        "main": [
          [
            {
              "node": "usr_validate",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "No Operation, do nothing",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Aldo?": {
        "main": [
          [
            {
              "node": "Mentor plu",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Mentor v3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "authors": "Aldo Santos",
    "name": null,
    "description": null
  }
}
