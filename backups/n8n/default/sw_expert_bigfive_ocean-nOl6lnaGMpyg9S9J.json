{
  "createdAt": "2025-10-19T20:04:57.978Z",
  "updatedAt": "2025-10-19T23:14:46.508Z",
  "id": "nOl6lnaGMpyg9S9J",
  "name": "sw_expert_bigfive_ocean",
  "active": false,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "workflowInputs": {
          "values": [
            {
              "name": "usuario_id"
            },
            {
              "name": "mensagens"
            },
            {
              "name": "data_conversa"
            },
            {
              "name": "chat_id"
            },
            {
              "name": "usr_name"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        -256,
        32
      ],
      "id": "9aec82c0-1805-427c-a807-b2ddd78e86ce",
      "name": "start"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Analise a conversa COMPLETA e estime o perfil Big Five (OCEAN).\n\n**CONVERSA (JSON):**\n```json\n{{ $json.mensagens }}\n```\n**Nome do usuário:** {{ $json.usr_name }}\n\n**SEU OBJETIVO**\n1) Identificar sinais claros e textuais para cada traço: Openness, Conscientiousness, Extraversion, Agreeableness, Neuroticism.\n2) Atribuir **score 0-100** por traço (escala contínua; 50 = neutro/mediano).\n3) Extrair **EVIDÊNCIAS** em 2-4 **trechos curtos** (máx. 15 palavras cada) para cada traço (somente do texto do usuário).\n4) Estimar **confiabilidade (0-100)** por traço, baseada na quantidade/clareza das evidências.\n5) Determinar **perfil_primario** = traço com maior score (se diferença <5 pontos entre o 1º e 2º, retorne \"misto\").\n6) Produzir um **resumo_perfil** (máx. 400 caracteres) em linguagem acessível e não-clínica, coerente com o MindQuest.\n7) Se as evidências forem insuficientes para qualquer traço, retorne score=50 e confiabilidade ≤ 40 para aquele traço.\n\n**REGRAS CRÍTICAS**\n- Leia APENAS mensagens com `autor = \"usuario\"`.\n- **Proíba suposições**: não invente fatos não ditos; use somente trechos literais como evidência.\n- **Escala obrigatória 0-100** para scores e confiabilidade.\n- Mantenha saídas em **português**.\n- **NÃO** faça diagnósticos clínicos. Foco descritivo, orientado a autoconhecimento.\n- Retorne **APENAS JSON válido**, no formato definido em \"FORMATO DE SAÍDA\".\n\n**CRITÉRIOS DE INTERPRETAÇÃO (guia resumido)**\n- **Openness (Abertura):** curiosidade, ideias novas, explorar possibilidades; baixo: preferência por rotina.\n- **Conscientiousness (Conscienciosidade):** organização, disciplina, plano/execução; baixo: impulsividade, procrastinação.\n- **Extraversion (Extroversão):** energia social, busca de estímulos/contato; baixo: reserva, foco interno.\n- **Agreeableness (Amabilidade):** empatia, cooperação; baixo: assertividade dura, conflito, ceticismo.\n- **Neuroticism (Neuroticismo):** sensibilidade a estresse, ansiedade/ruminação; baixo: estabilidade emocional.\n\n**FORMATO DE SAÍDA (JSON):**\n{\n  \"big_five\": {\n    \"openness\": {\n      \"score\": 0,\n      \"confiabilidade\": 0,\n      \"evidencias\": [\"...\", \"...\"]\n    },\n    \"conscientiousness\": {\n      \"score\": 0,\n      \"confiabilidade\": 0,\n      \"evidencias\": [\"...\", \"...\"]\n    },\n    \"extraversion\": {\n      \"score\": 0,\n      \"confiabilidade\": 0,\n      \"evidencias\": [\"...\", \"...\"]\n    },\n    \"agreeableness\": {\n      \"score\": 0,\n      \"confiabilidade\": 0,\n      \"evidencias\": [\"...\", \"...\"]\n    },\n    \"neuroticism\": {\n      \"score\": 0,\n      \"confiabilidade\": 0,\n      \"evidencias\": [\"...\", \"...\"]\n    }\n  },\n  \"perfil_primario\": \"openness|conscientiousness|extraversion|agreeableness|neuroticism|misto\",\n  \"resumo_perfil\": \"texto curto e não clínico\",\n  \"insuficiente\": false\n}\n\n**NOTAS DE QUALIDADE**\n- Se a conversa for pobre em pistas, defina `insuficiente = true` e mantenha scores próximos de 50 com baixa confiabilidade.\n- \"Evidências\" DEVEM ser trechos literais e curtos do usuário (não reescreva).",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "Você é um assistente especialista em Big Five (OCEAN) e ética em IA. Sua função é inferir tendências de personalidade com base EXCLUSIVAMENTE em trechos literais do usuário. Siga estes princípios:\n1) Precisão e parcimônia: sem extrapolações. Use apenas o que está escrito.\n2) Transparência: inclua evidências curtas (2-4) por traço.\n3) Escalas contínuas 0-100 para score e confiabilidade (50 = neutro; 0-20 muito baixo; 80-100 muito alto).\n4) Comunicação responsável: linguagem acessível, não clínica, acolhedora.\n5) Se faltarem sinais para um traço, use score=50, confiabilidade ≤ 40 e marque `insuficiente=true` se a conversa inteira não sustentar inferência.\nRetorne SEMPRE JSON válido no formato solicitado.",
          "maxIterations": 3
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        -16,
        32
      ],
      "id": "56bcd51c-4721-4bf5-a859-0fa1636b467c",
      "name": "Analisador Big Five"
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"big_five\": {\n    \"openness\": {\"score\": 62, \"confiabilidade\": 78, \"evidencias\": [\"gosto de explorar ideias novas\", \"procuro alternativas criativas\"]},\n    \"conscientiousness\": {\"score\": 54, \"confiabilidade\": 65, \"evidencias\": [\"monitorei meu plano\", \"organizei meus passos\"]},\n    \"extraversion\": {\"score\": 41, \"confiabilidade\": 60, \"evidencias\": [\"prefiro ficar na minha\", \"evitei encontros\"]},\n    \"agreeableness\": {\"score\": 70, \"confiabilidade\": 72, \"evidencias\": [\"procurei conciliar\", \"quero evitar conflito\"]},\n    \"neuroticism\": {\"score\": 58, \"confiabilidade\": 68, \"evidencias\": [\"fiquei ansioso com perdas\", \"preocupação constante\"]}\n  },\n  \"perfil_primario\": \"agreeableness\",\n  \"resumo_perfil\": \"Pessoa colaborativa, aberta a diálogos e soluções conjuntas, mantendo equilíbrio em disciplina e energia social.\",\n  \"insuficiente\": false\n}",
        "autoFix": true
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        112,
        256
      ],
      "id": "fd55a9e6-1fb1-4407-b98f-770f1b6a319c",
      "name": "Parser JSON Big Five"
    },
    {
      "parameters": {
        "options": {
          "maxTokens": 2000,
          "temperature": 0.2
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        -192,
        288
      ],
      "id": "b0de55cd-8550-48d2-b1e6-18d29e307c66",
      "name": "OpenRouter Claude",
      "credentials": {
        "openRouterApi": {
          "id": "rSnkOnnAHyfayLJt",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "INSERT INTO perfis_big_five (\n  usuario_id,\n  chat_id,\n  openness,\n  conscientiousness,\n  extraversion,\n  agreeableness,\n  neuroticism,\n  confiabilidade,\n  perfil_primario,\n  perfil_secundario,\n  metodo_deteccao,\n  sabotadores_json,\n  criado_em,\n  atualizado_em\n)\nVALUES (\n  $1::uuid,\n  $2::uuid,\n  $3::jsonb ->> 'openness_score'::int,\n  $3::jsonb ->> 'conscientiousness_score'::int,\n  $3::jsonb ->> 'extraversion_score'::int,\n  $3::jsonb ->> 'agreeableness_score'::int,\n  $3::jsonb ->> 'neuroticism_score'::int,\n  $3::jsonb ->> 'confiabilidade_media_calc'::int,\n  $3::jsonb ->> 'perfil_primario_final',\n  $3::jsonb ->> 'perfil_secundario_final',\n  'ia_bigfive_v1',\n  $3::jsonb,\n  NOW(),\n  NOW()\n);\n",
        "options": {
          "queryReplacement": "=[   {{ $('start').first().json.usuario_id }},   {{ $('start').first().json.chat_id }},   {{ JSON.stringify({         openness_score: $json.output.big_five.openness.score,         conscientiousness_score: $json.output.big_five.conscientiousness.score,         extraversion_score: $json.output.big_five.extraversion.score,         agreeableness_score: $json.output.big_five.agreeableness.score,         neuroticism_score: $json.output.big_five.neuroticism.score,         confiabilidade_media_calc: /* algum cálculo ou valor */,         perfil_primario_final: $json.output.perfil_primario,         perfil_secundario_final: /* algum valor */     }) }} ]"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        336,
        32
      ],
      "id": "edf815e8-09aa-476d-b021-544f5301d971",
      "name": "Gravar Big Five (ADAPTAR SCHEMA)",
      "credentials": {
        "postgres": {
          "id": "8ySWxtSO7gYK5uue",
          "name": "Postgres account"
        }
      }
    }
  ],
  "connections": {
    "start": {
      "main": [
        []
      ]
    },
    "Analisador Big Five": {
      "main": [
        [
          {
            "node": "Gravar Big Five (ADAPTAR SCHEMA)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parser JSON Big Five": {
      "ai_outputParser": [
        [
          {
            "node": "Analisador Big Five",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Claude": {
      "ai_languageModel": [
        [
          {
            "node": "Analisador Big Five",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Parser JSON Big Five",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {
    "start": [
      {
        "json": {
          "usuario_id": "4bb8706a-7886-4ccb-8263-ff51aaafaafa",
          "mensagens": "[{\"interaction\":1,\"autor\":\"usuario\",\"texto\":\"Oi\",\"timestamp\":\"2025-10-19T20:08:05.788Z\"},{\"interaction\":1,\"autor\":\"agente\",\"texto\":\"Oi Davi, que bom falar com você novamente. Vejo que hoje começamos de forma simples, só com um oi — tudo bem por aí? Como você tem se sentido nesses últimos dias? Vi que a gente vinha conversando sobre foco e energia, e queria entender se isso mudou para você ou se ainda tem algo que tem ocupado sua mente. Me conta um pouco?\",\"timestamp\":\"2025-10-19T20:08:05.788Z\"},{\"interaction\":2,\"autor\":\"usuario\",\"texto\":\"Estou um pouco desanimado ultimamente,mas não sei o porquê\",\"timestamp\":\"2025-10-19T20:08:05.788Z\"},{\"interaction\":2,\"autor\":\"agente\",\"texto\":\"Entendo, Davi... esse desânimo sem uma causa clara pode ser mesmo confuso e até um pouco pesado, né? Tenho uma pergunta para você: como esse sentimento tem afetado o seu dia a dia, suas atividades ou até a forma como você se vê? Sinto que entender esses impactos pode ajudar a clarear o que está por trás disso. Me conta, se quiser.\",\"timestamp\":\"2025-10-19T20:08:05.788Z\"},{\"interaction\":3,\"autor\":\"usuario\",\"texto\":\"Sim, afeta meu dia\",\"timestamp\":\"2025-10-19T20:08:05.788Z\"},{\"interaction\":3,\"autor\":\"agente\",\"texto\":\"Faz sentido, Davi. Quando esse desânimo começa a pesar no dia a dia, parece que tudo fica mais difícil de lidar, né? Às vezes, a mente pede um momento para respirar, mesmo que a gente não saiba bem o motivo. Me diz uma coisa: você já tentou alguma forma de lidar com isso, mesmo que pequena, como um hábito, uma pausa ou algo que costuma te ajudar a recarregar?\",\"timestamp\":\"2025-10-19T20:08:05.788Z\"},{\"interaction\":4,\"autor\":\"usuario\",\"texto\":\"Eu tento ficar com um tempo livre,e acabo deixando as obrigações de lado\",\"timestamp\":\"2025-10-19T20:08:05.788Z\"},{\"interaction\":4,\"autor\":\"agente\",\"texto\":\"Entendi, Davi. Você tem buscado momentos de tempo livre para cuidar de si, o que é muito importante, mas sente que isso acaba fazendo você deixar as obrigações de lado, e isso pode gerar um conflito interno ou até uma sensação de culpa. Esse desânimo, que está sem uma causa muito clara, tem afetado seu dia a dia e talvez esteja relacionado a esse equilíbrio delicado entre descansar e cumprir suas tarefas. \\n\\nConsegui entender bem sua situação? Quer ajustar ou acrescentar algo?\",\"timestamp\":\"2025-10-19T20:08:05.788Z\"},{\"interaction\":5,\"autor\":\"usuario\",\"texto\":\"Não, apenas quero uma solução\",\"timestamp\":\"2025-10-19T20:08:05.788Z\"},{\"interaction\":5,\"autor\":\"agente\",\"texto\":\"Entendo que você quer mesmo uma solução concreta, Davi. Isso mostra sua vontade de avançar e transformar esse desânimo em algo mais leve e produtivo. Embora aqui a gente tenha focado em entender o que está por trás, já perceber isso é o primeiro passo valioso.\\n\\nNossa conversa de hoje está finalizada. Seu painel MindQuest já foi atualizado com tudo que você compartilhou. Quando quiser, dá uma olhada lá para ver seu progresso e insights.\\n\\nAté a próxima, e lembre-se que esse movimento seu em busca de clareza já é um passo importante para mudanças reais.\\n\\nhttps://www.mindquest.pt/auth?token=96512b43-c248-463e-8fce-0635583048daAC61A74406EB7404B6731E07C5ADBC231760891682\",\"timestamp\":\"2025-10-19T20:08:05.788Z\"}]",
          "data_conversa": "2025-10-19T00:00:00.000Z",
          "chat_id": "c2545f55-6fed-4b6d-ac01-ec051d52bca2",
          "usr_name": "Davi"
        }
      }
    ]
  },
  "versionId": "35a8eeff-b897-4ca8-a827-b9f1e43e88ce",
  "triggerCount": 0,
  "shared": [
    {
      "createdAt": "2025-10-19T20:04:57.978Z",
      "updatedAt": "2025-10-19T20:04:57.978Z",
      "role": "workflow:owner",
      "workflowId": "nOl6lnaGMpyg9S9J",
      "projectId": "u1M57XAwIiLpPwjp",
      "project": {
        "createdAt": "2025-09-16T16:13:20.606Z",
        "updatedAt": "2025-09-25T16:38:18.729Z",
        "id": "u1M57XAwIiLpPwjp",
        "name": "Aldo Santos <lindualdo@hotmail.com>",
        "type": "personal",
        "icon": null,
        "description": null,
        "projectRelations": [
          {
            "createdAt": "2025-09-16T16:13:20.606Z",
            "updatedAt": "2025-09-16T16:13:20.606Z",
            "userId": "fa864d51-475e-4765-b3b4-12788525a3e6",
            "projectId": "u1M57XAwIiLpPwjp",
            "user": {
              "createdAt": "2025-09-16T16:13:20.056Z",
              "updatedAt": "2025-10-25T10:36:27.185Z",
              "id": "fa864d51-475e-4765-b3b4-12788525a3e6",
              "email": "lindualdo@hotmail.com",
              "firstName": "Aldo",
              "lastName": "Santos",
              "personalizationAnswers": {
                "version": "v4",
                "personalization_survey_submitted_at": "2025-09-16T16:22:10.583Z",
                "personalization_survey_n8n_version": "1.108.1"
              },
              "settings": {
                "userActivated": true,
                "firstSuccessfulWorkflowId": "jUAvu7DUAzyqZhJd",
                "userActivatedAt": 1758041156747,
                "easyAIWorkflowOnboarded": true,
                "dismissedCallouts": {
                  "preBuiltAgentsModalCallout": true
                },
                "npsSurvey": {
                  "responded": true,
                  "lastShownAt": 1759918723295
                }
              },
              "disabled": false,
              "mfaEnabled": false,
              "lastActiveAt": "2025-10-25",
              "isPending": false
            }
          }
        ]
      }
    }
  ],
  "tags": []
}