{
  "createdAt": "2025-11-03T09:13:55.708Z",
  "id": "04S47KA7EIbiJZBA",
  "name": "My workflow 4",
  "active": false,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -208,
        -48
      ],
      "id": "d8049be7-7253-4013-bc97-b3c53ba40dbe",
      "name": "When clicking ‘Execute workflow’"
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "quest_catalogo",
          "mode": "list",
          "cachedResultName": "quest_catalogo"
        },
        "returnAll": true,
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        16,
        -48
      ],
      "id": "04b12cf0-77d0-4fc6-ba50-4e5b82781a86",
      "name": "Quest catalogo",
      "credentials": {
        "postgres": {
          "id": "8ySWxtSO7gYK5uue",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "usuarios_quest",
          "mode": "list",
          "cachedResultName": "usuarios_quest"
        },
        "returnAll": true,
        "where": {
          "values": [
            {
              "column": "usuario_id",
              "value": "015e4e4c-ac43-4071-b580-4b0b75713d76"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        240,
        -48
      ],
      "id": "d9ae6607-e1c0-43f5-a0a2-95e7e88b4275",
      "name": "Usuarios quest",
      "credentials": {
        "postgres": {
          "id": "8ySWxtSO7gYK5uue",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "gamificacao",
          "mode": "list",
          "cachedResultName": "gamificacao"
        },
        "returnAll": true,
        "where": {
          "values": [
            {
              "column": "usuario_id",
              "value": "015e4e4c-ac43-4071-b580-4b0b75713d76"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        480,
        -48
      ],
      "id": "fa3ad44c-c5e8-4a3f-9453-7551353645c2",
      "name": "Gamificacao",
      "credentials": {
        "postgres": {
          "id": "8ySWxtSO7gYK5uue",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "gamificacao",
          "mode": "list",
          "cachedResultName": "gamificacao"
        },
        "returnAll": true,
        "where": {
          "values": [
            {
              "column": "usuario_id",
              "value": "015e4e4c-ac43-4071-b580-4b0b75713d76"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        704,
        -48
      ],
      "id": "3dcd1720-3918-427f-aa8d-cc708d0ed1f2",
      "name": "Gamificacao Niveis",
      "credentials": {
        "postgres": {
          "id": "8ySWxtSO7gYK5uue",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "WITH dados_estado AS (\n  SELECT\n    eu.usuario_id,\n    eu.nivel_atual,\n    eu.xp_total,\n    eu.total_quests_personalizadas,\n    eu.total_quests_concluidas,\n    eu.total_xp_hoje,\n    eu.sequencia_atual,\n    eu.sequencia_recorde,\n    eu.meta_sequencia_codigo,\n    eu.proxima_meta_codigo,\n    eu.sequencia_status\n  FROM public.quest_estado_usuario eu\n  WHERE eu.usuario_id = 'd949d81c-9235-41ce-8b3b-6b5d593c5e24'\n),\ninstancias AS (\n  SELECT\n    qi.usuario_id,\n    qi.id AS instancia_id,\n    qi.meta_codigo,\n    qi.status AS instancia_status,\n    qi.progresso_atual,\n    qi.progresso_meta,\n    qi.xp_concedido,\n    qi.janela_inicio,\n    qi.janela_fim,\n    qi.contexto_origem,\n    qi.ativado_em,\n    qi.concluido_em,\n    qi.cancelado_em,\n    qi.reiniciada_em,\n    qm.id AS modelo_id,\n    qm.codigo AS modelo_codigo,\n    qm.titulo,\n    qm.descricao,\n    qm.tipo,\n    qm.gatilho_codigo,\n    qm.gatilho_valor,\n    qm.xp_recompensa,\n    qm.repeticao,\n    qm.ativo,\n    qm.config,\n    qm.criado_em AS modelo_criado_em\n  FROM public.quest_instancias qi\n  JOIN public.quest_modelos qm ON qm.id = qi.modelo_id\n  WHERE qi.usuario_id = 'd949d81c-9235-41ce-8b3b-6b5d593c5e24'\n)\nSELECT\n  COALESCE(de.usuario_id, instancias.usuario_id) AS usuario_id,\n  de.nivel_atual,\n  de.xp_total,\n  de.total_quests_personalizadas,\n  de.total_quests_concluidas,\n  de.total_xp_hoje,\n  de.sequencia_atual,\n  de.sequencia_recorde,\n  de.meta_sequencia_codigo,\n  de.proxima_meta_codigo,\n  de.sequencia_status,\n  instancias.instancia_id,\n  instancias.meta_codigo,\n  instancias.instancia_status,\n  instancias.progresso_atual,\n  instancias.progresso_meta,\n  instancias.xp_concedido,\n  instancias.janela_inicio,\n  instancias.janela_fim,\n  instancias.contexto_origem,\n  instancias.ativado_em,\n  instancias.concluido_em,\n  instancias.cancelado_em,\n  instancias.reiniciada_em,\n  instancias.modelo_id,\n  instancias.modelo_codigo,\n  instancias.titulo,\n  instancias.descricao,\n  instancias.tipo,\n  instancias.gatilho_codigo,\n  instancias.gatilho_valor,\n  instancias.xp_recompensa,\n  instancias.repeticao,\n  instancias.ativo,\n  instancias.config AS modelo_config,\n  instancias.modelo_criado_em\nFROM dados_estado de\nFULL JOIN instancias ON instancias.usuario_id = de.usuario_id\nORDER BY instancias.ativado_em NULLS LAST, instancias.modelo_codigo;\n",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        32,
        176
      ],
      "id": "41f55285-9127-4bc0-9224-2aef6bed70fa",
      "name": "Execute a SQL query",
      "credentials": {
        "postgres": {
          "id": "8ySWxtSO7gYK5uue",
          "name": "Postgres account"
        }
      }
    }
  ],
  "connections": {
    "When clicking ‘Execute workflow’": {
      "main": [
        []
      ]
    },
    "Quest catalogo": {
      "main": [
        []
      ]
    },
    "Usuarios quest": {
      "main": [
        []
      ]
    },
    "Gamificacao": {
      "main": [
        []
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {},
  "versionId": "b0550fec-ada4-47d6-a74a-3b7a0a75a776",
  "triggerCount": 0,
  "shared": [
    {
      "createdAt": "2025-11-03T09:13:55.708Z",
      "role": "workflow:owner",
      "workflowId": "04S47KA7EIbiJZBA",
      "projectId": "u1M57XAwIiLpPwjp",
      "project": {
        "createdAt": "2025-09-16T16:13:20.606Z",
        "id": "u1M57XAwIiLpPwjp",
        "name": "Aldo Santos <lindualdo@hotmail.com>",
        "type": "personal",
        "icon": null,
        "description": null,
        "projectRelations": [
          {
            "createdAt": "2025-09-16T16:13:20.606Z",
            "userId": "fa864d51-475e-4765-b3b4-12788525a3e6",
            "projectId": "u1M57XAwIiLpPwjp",
            "user": {
              "createdAt": "2025-09-16T16:13:20.056Z",
              "id": "fa864d51-475e-4765-b3b4-12788525a3e6",
              "email": "lindualdo@hotmail.com",
              "firstName": "Aldo",
              "lastName": "Santos",
              "personalizationAnswers": {
                "version": "v4",
                "personalization_survey_submitted_at": "2025-09-16T16:22:10.583Z",
                "personalization_survey_n8n_version": "1.108.1"
              },
              "settings": {
                "userActivated": true,
                "firstSuccessfulWorkflowId": "jUAvu7DUAzyqZhJd",
                "userActivatedAt": 1758041156747,
                "easyAIWorkflowOnboarded": true,
                "dismissedCallouts": {
                  "preBuiltAgentsModalCallout": true
                },
                "npsSurvey": {
                  "responded": true,
                  "lastShownAt": 1759918723295
                }
              },
              "disabled": false,
              "mfaEnabled": false,
              "isPending": false
            }
          }
        ]
      }
    }
  ],
  "tags": []
}
