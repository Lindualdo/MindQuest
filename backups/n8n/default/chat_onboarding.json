{
  "createdAt": "2025-11-02T13:31:36.212Z",
  "id": "UlInW9nmQs7vnPIP",
  "name": "chat_onboarding",
  "active": false,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "workflowInputs": {
          "values": [
            {
              "name": "remoteJid"
            },
            {
              "name": "pushName"
            },
            {
              "name": "id"
            },
            {
              "name": "whatsapp_number"
            },
            {
              "name": "evolution_instancia"
            },
            {
              "name": "menssagem"
            }
          ]
        }
      },
      "id": "569fb1ed-c56a-471f-9b87-2720273bbe6c",
      "name": "start",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        -1984,
        352
      ]
    },
    {
      "parameters": {
        "operation": "get",
        "propertyName": "sessionData",
        "key": "=onboard:memory{{ $('start').first().json.evolution_instancia }}{{ $('start').first().json.whatsapp_number }}",
        "options": {}
      },
      "id": "4b257151-017c-4bb7-9f88-490f93423fcd",
      "name": "Redis Get",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -1632,
        192
      ],
      "credentials": {
        "redis": {
          "id": "PB4zpLy1jLXDEzmH",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const raw = $input.item.json.sessionData;\nlet session = {};\ntry {\n  if (raw) session = JSON.parse(raw);\n} catch (error) {\n  session = {};\n}\n\nconst hasNome = typeof session.nome_preferido === 'string' && session.nome_preferido.trim().length >= 2;\n\nconst normalizeEstado = (value) => {\n  if (value === 'completo') return 'completo';\n  if (hasNome) return 'completo';\n  if (value === 'esperando_nome') return 'esperando_nome';\n  return 'inicio';\n};\n\nconst estado = normalizeEstado(session.estado);\nconst nome_preferido = hasNome ? session.nome_preferido.trim() : null;\n\nconst interactionCountMap = {\n  inicio: 1,\n  esperando_nome: 2,\n  completo: 3,\n};\n\nconst interaction_count = interactionCountMap[estado] ?? 2;\n\nlet next_focus = '';\nif (estado === 'completo') {\n  next_focus = 'ONBOARDING#FINAL: Agrade√ßa e confirme que o acesso ser√° liberado em seguida. N√£o fa√ßa novas perguntas.';\n} else {\n  next_focus = 'ONBOARDING#NOME: Cumprimente brevemente e pergunte apenas COMO A PESSOA PREFERE SER CHAMADA.';\n}\n\nconst is_last_interaction = estado === 'completo';\n\nreturn {\n  json: {\n    estado,\n    nome_preferido,\n    interaction_count,\n    next_focus,\n    is_last_interaction,\n  },\n};\n"
      },
      "id": "ff5862d0-aa91-4c5d-86bf-073801f94dd1",
      "name": "Code - Controller (interations-style)",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1408,
        192
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=# USER PROMPT - ONBOARDING MINDQUEST (interations-style)\n\n<contexto>\nMensagem do Usu√°rio: {{ $('start').item.json.menssagem }}\nEstado Atual: {{ $('Code - Controller (interations-style)').item.json.estado }}\nNome Preferido: {{ $('Code - Controller (interations-style)').item.json.nome_preferido }}\n</contexto>\n\n<controle>\nInteraction: {{ $('Code - Controller (interations-style)').item.json.interaction_count }}\nnext_focus: {{ $('Code - Controller (interations-style)').item.json.next_focus }}\n√â √∫ltima intera√ß√£o: {{ $('Code - Controller (interations-style)').item.json.is_last_interaction }}\nREGRAS: Siga EXACTAMENTE o next_focus. N√£o pe√ßa e-mail, idade ou qualquer outro dado al√©m do nome.\n</controle>\n\n<templates>\nNOME: \"Oi! üëã Que bom ter voc√™ aqui no MindQuest!\n\nPra personalizar tudo do seu jeito, me conta: como voc√™ prefere ser chamado(a)?\"\nFINAL: \"Perfeito! Vou finalizar seu acesso agora. Qualquer coisa √© s√≥ me chamar. üôå\"\n</templates>",
        "options": {
          "systemMessage": "=# SYSTEM\n- Fale PT-BR.\n- Obede√ßa ao next_focus sem inventar novas perguntas.\n- N√£o pe√ßa dados al√©m do nome.\n- Direto, cordial e breve."
        }
      },
      "id": "e48925f6-2259-4561-a048-1da805e8229c",
      "name": "Agent AI (interations-style)",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        -1168,
        192
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "537e59fa-f4e4-49aa-9371-343d48c2eb8c",
      "name": "OpenRouter Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        -1168,
        384
      ],
      "credentials": {
        "openRouterApi": {
          "id": "rSnkOnnAHyfayLJt",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const raw = $input.first().json.output || '';\nconst controller = $('Code - Controller (interations-style)').first().json || {};\nconst startPayload = $('start').first().json || {};\nconst incomingMessage = String(startPayload.menssagem || '').trim();\nconst pushName = String(startPayload.pushName || '').trim();\n\nlet out_text = String(raw || '').trim();\nconst estadoAtual = controller.estado || 'inicio';\nconst nomeAnterior = controller.nome_preferido || null;\n\nconst limparNome = (valor) => {\n  if (typeof valor !== 'string') return null;\n  const limpo = valor\n    .replace(/^[\\\"'\\s]+/g, '')\n    .replace(/[\\\"'\\s]+$/g, '')\n    .replace(/\\s+/g, ' ')\n    .trim();\n  return limpo.length > 0 ? limpo : null;\n};\n\nconst mensagemSolicitarNome = 'Pra seguir, preciso saber como voc√™ prefere ser chamado(a). Pode me contar?';\nconst fallbackNome = () => limparNome(pushName) || limparNome(nomeAnterior) || 'voc√™';\n\nlet proximo_estado = estadoAtual;\nlet tipo = 'mensagem';\nlet nome_usuario = limparNome(nomeAnterior) || limparNome(pushName);\nconst nomeInformado = limparNome(incomingMessage);\n\nif (estadoAtual === 'inicio') {\n  proximo_estado = 'esperando_nome';\n  if (!out_text) {\n    out_text = mensagemSolicitarNome;\n  }\n} else if (estadoAtual === 'esperando_nome') {\n  nome_usuario = nomeInformado || fallbackNome();\n  proximo_estado = 'completo';\n  tipo = 'finalizado';\n  if (!out_text) {\n    out_text = `Perfeito, ${nome_usuario}! Vou liberar seu acesso agora. üôå`;\n  }\n} else {\n  nome_usuario = nomeInformado || nome_usuario || fallbackNome();\n  proximo_estado = 'completo';\n  tipo = 'finalizado';\n  if (!out_text) {\n    out_text = nome_usuario\n      ? `Perfeito, ${nome_usuario}! Vou liberar seu acesso agora. üôå`\n      : 'Perfeito! Vou liberar seu acesso agora. üôå';\n  }\n}\n\nreturn {\n  json: {\n    tipo,\n    texto: out_text,\n    proximo_estado,\n    nome_usuario,\n    email_usuario: null,\n    faixa_etaria: null,\n    faixa_etaria_codigo: null,\n    nome_assistente: 'assistente',\n  },\n};\n"
      },
      "id": "d38d9c38-bb09-4f70-9a7d-e76d2b295f33",
      "name": "Code - Parse Determin√≠stico",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -800,
        192
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "leftValue": "={{ $json.tipo }}",
              "rightValue": "finalizado",
              "operator": {
                "type": "string",
                "operation": "equals"
              },
              "id": "0531552e-c58e-4386-a7c8-0fe2f618b330"
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "8dac5065-e211-4cf1-8397-b7053859a5cc",
      "name": "IF Finalizado",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -608,
        192
      ]
    },
    {
      "parameters": {
        "operation": "set",
        "key": "=onboard:memory{{ $('start').first().json.evolution_instancia }}{{ $('start').first().json.whatsapp_number }}",
        "value": "={{ (() => {\n  let prev = {};\n  try {\n    prev = JSON.parse($('Redis Get').first().json.sessionData || '{}');\n  } catch (error) {\n    prev = {};\n  }\n  const ai = $('Code - Parse Determin√≠stico').first().json || {};\n  const estado = (typeof ai.proximo_estado === 'string' && ai.proximo_estado)\n    || (typeof prev.estado === 'string' && prev.estado)\n    || 'inicio';\n  const nome = (() => {\n    if (typeof ai.nome_usuario === 'string' && ai.nome_usuario.trim()) {\n      return ai.nome_usuario.trim();\n    }\n    if (typeof prev.nome_preferido === 'string' && prev.nome_preferido.trim()) {\n      return prev.nome_preferido.trim();\n    }\n    return null;\n  })();\n  return JSON.stringify({\n    estado,\n    nome_preferido: nome,\n    nome_assistente: 'assistente'\n  });\n})() }}",
        "expire": true,
        "ttl": 86400
      },
      "id": "118c954d-7628-4e79-944a-a2416e265061",
      "name": "Redis Update",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -144,
        288
      ],
      "credentials": {
        "redis": {
          "id": "PB4zpLy1jLXDEzmH",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "INSERT INTO usuarios (\n  whatsapp_numero,\n  nome,\n  nome_preferencia,\n  email,\n  nome_assistente,\n  token_acesso,\n  token_expira_em,\n  status_onboarding,\n  faixa_etaria\n)\nVALUES (\n  $1,\n  $2,\n  $3,\n  DEFAULT,\n  'assistente',\n  gen_random_uuid() || $4 || EXTRACT(EPOCH FROM CURRENT_TIMESTAMP)::bigint,\n  CURRENT_TIMESTAMP + INTERVAL '15 days',\n  'completo',\n  DEFAULT\n)\nRETURNING id, token_acesso, whatsapp_numero, nome_preferencia, nome_assistente, email;",
        "options": {
          "queryReplacement": "={{ [\n  $('start').first().json.whatsapp_number,\n  $('start').item.json.pushName,\n  $('Code - Parse Determin√≠stico').item.json.nome_usuario,\n  $('start').item.json.id\n] }}"
        }
      },
      "id": "b9a59930-45da-4249-97ef-be9770274299",
      "name": "Insert User",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -368,
        32
      ],
      "credentials": {
        "postgres": {
          "id": "8ySWxtSO7gYK5uue",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "INSERT INTO public.gamificacao (\n  id,\n  usuario_id,\n  xp_total,\n  xp_proximo_nivel,\n  nivel_atual,\n  titulo_nivel,\n  streak_conversas_dias,\n  melhor_streak,\n  streak_meta_atual,\n  streak_meta_proximo,\n  streak_meta_status,\n  streak_protecao_usada,\n  streak_protecao_resetada_em,\n  total_conversas,\n  total_reflexoes,\n  total_xp_ganho_hoje,\n  quest_diaria_status,\n  quest_diaria_progresso,\n  quest_diaria_descricao,\n  quest_diaria_data,\n  quest_streak_dias,\n  habitos_ativos,\n  conquistas_desbloqueadas,\n  ultima_conquista_id,\n  ultima_conquista_data,\n  ultima_conversa_data,\n  ultima_atualizacao,\n  criado_em,\n  atualizado_em\n)\nVALUES (\n  gen_random_uuid(),\n  $1::uuid,\n  0,\n  200,\n  1,\n  'Explorador',\n  0,\n  0,\n  'streak_003',\n  'streak_005',\n  jsonb_build_object(\n    'alvoDias', 3,\n    'estado', 'ativo',\n    'reinicios', 0,\n    'completado_em', NULL\n  ),\n  FALSE,\n  NULL,\n  0,\n  0,\n  0,\n  NULL,\n  0,\n  NULL,\n  NULL,\n  3,\n  '[]'::jsonb,\n  '[]'::jsonb,\n  NULL,\n  NULL,\n  NULL,\n  NOW(),\n  NOW(),\n  NOW()\n)\nON CONFLICT (usuario_id) DO NOTHING;\n",
        "options": {
          "queryReplacement": "={{ [$json.id] }}"
        }
      },
      "id": "5443cd22-640f-44f7-8ca1-8402e4a99220",
      "name": "Insert Gamif",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -160,
        32
      ],
      "credentials": {
        "postgres": {
          "id": "8ySWxtSO7gYK5uue",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const dados = $('Code - Parse Determin√≠stico').first().json || {};\nconst historico = (() => {\n  try {\n    return JSON.parse($('Redis Get').first().json.sessionData || '{}');\n  } catch (error) {\n    return {};\n  }\n})();\n\nconst preferido = (dados.nome_usuario && dados.nome_usuario.trim())\n  || (historico.nome_preferido && historico.nome_preferido.trim())\n  || ($('start').item.json.pushName || '').trim()\n  || 'voc√™';\nconst nomeUsuario = preferido;\nconst token = $('Insert User').first().json.token_acesso;\nconst url = `https://mindquest.pt/app/auth?token=${token}`;\n\nconst mensagem = `Perfeito, ${nomeUsuario}! üòä\n\nSeu acesso est√° liberado: ${url};\n\nüîí Esse link j√° vem com seu token pessoal, sem precisar criar senha.`;\nreturn { json: { mensagem } };"
      },
      "id": "d0abdb6a-29d7-44c9-a8f0-3b414e21083a",
      "name": "monta link para usuario",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        32,
        32
      ]
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "=onboard:chat{{ $('start').first().json.evolution_instancia }}{{ $('start').first().json.whatsapp_number }}",
        "sessionTTL": 86400,
        "contextWindowLength": 20
      },
      "id": "8db906af-811b-4904-a018-04910128c1b9",
      "name": "Redis Chat Memory1",
      "type": "@n8n/n8n-nodes-langchain.memoryRedisChat",
      "typeVersion": 1.5,
      "position": [
        -432,
        1056
      ],
      "credentials": {
        "redis": {
          "id": "PB4zpLy1jLXDEzmH",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "U44ZfEwFU77EUthb",
          "mode": "list",
          "cachedResultUrl": "/workflow/U44ZfEwFU77EUthb",
          "cachedResultName": "sw_send_message_with_retry"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "messageText": "={{ $json.mensagem }}",
            "remoteJid": "={{ $('start').item.json.remoteJid }}",
            "instanceName": "={{ $('start').item.json.evolution_instancia }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "instanceName",
              "displayName": "instanceName",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "remoteJid",
              "displayName": "remoteJid",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "messageText",
              "displayName": "messageText",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {
          "waitForSubWorkflow": true
        }
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        272,
        32
      ],
      "id": "48950db3-388a-41dd-8481-26af0bec3c54",
      "name": "Call 'sw_send_message_with_retry'"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "U44ZfEwFU77EUthb",
          "mode": "list",
          "cachedResultUrl": "/workflow/U44ZfEwFU77EUthb",
          "cachedResultName": "sw_send_message_with_retry"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "messageText": "={{ $('Code - Parse Determin√≠stico').item.json.texto }}",
            "remoteJid": "={{ $('start').item.json.remoteJid }}",
            "instanceName": "={{ $('start').item.json.evolution_instancia }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "instanceName",
              "displayName": "instanceName",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "remoteJid",
              "displayName": "remoteJid",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "messageText",
              "displayName": "messageText",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {
          "waitForSubWorkflow": true
        }
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        -368,
        288
      ],
      "id": "33cf461e-06b4-47a8-ba5a-f7e204244dc5",
      "name": "Call 'sw_send_message_with_retry'1"
    },
    {
      "parameters": {
        "operation": "delete",
        "key": "=onboard:memory{{ $('start').first().json.evolution_instancia }}{{ $('start').first().json.whatsapp_number }}"
      },
      "id": "4e68daf9-b7f0-4543-b2df-ebd1ad964bf3",
      "name": "Redis Delete",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        896,
        32
      ],
      "credentials": {
        "redis": {
          "id": "PB4zpLy1jLXDEzmH",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "operation": "delete",
        "key": "=onboard:memory{{ $('start').first().json.evolution_instancia }}{{ $('start').first().json.whatsapp_number }}"
      },
      "id": "aee7bb8e-b3f9-42f4-aa6b-3225898b9369",
      "name": "Redis Delete1",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -1632,
        384
      ],
      "credentials": {
        "redis": {
          "id": "PB4zpLy1jLXDEzmH",
          "name": "Redis account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "mode": "delete",
        "deleteMode": "all"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryManager",
      "typeVersion": 1.1,
      "position": [
        -1680,
        592
      ],
      "id": "7c55f4f0-2b9b-4474-baba-d0138072b30a",
      "name": "Chat Memory Manager",
      "disabled": true
    },
    {
      "parameters": {
        "mode": "delete",
        "deleteMode": "all"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryManager",
      "typeVersion": 1.1,
      "position": [
        1488,
        304
      ],
      "id": "a654bb4d-240d-493a-9c68-8c723bd78df7",
      "name": "Chat Memory Manager1"
    },
    {
      "parameters": {
        "amount": "={{ 5 }}"
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        496,
        32
      ],
      "id": "5cddef0c-1982-4990-a27e-4b0507c6bca5",
      "name": "Wait",
      "webhookId": "c929985f-0e38-41dd-8f39-81282d3765bb"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "U44ZfEwFU77EUthb",
          "mode": "list",
          "cachedResultUrl": "/workflow/U44ZfEwFU77EUthb",
          "cachedResultName": "sw_send_message_with_retry"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "messageText": "=Antes de come√ßarmos, aqui vai algumas dicas...\n\n- Use este canal para conversar comigo; as intera√ß√µes aqui alimentam o seu App com resumo das conversas, humor, emo√ß√µes, padr√µes mentais, perfil comportamental, dicas √∫teis e conquistas para te dar clareza mental e te ajudar em suas realiza√ß√µes .\n\n- Lembrando que o MindQuest n√£o √© terapia nem App de produtividade, o prop√≥sito aqui √© te dar clareza mental para voc√™ se conhecer melhor e usar suas emo√ß√µes a seu favor.\n\n- Na primeira conversa fale sobre o que sentir vontade; emo√ß√µes, padr√µes de pensamento, h√°bitos, rela√ß√µes ou decis√µes ‚Äî qualquer tema relevante vira dado √∫til para voc√™.\n\n- Se n√£o souber por onde come√ßar, √© s√≥ me dizer que vou te orientando combinado?\n\nQuer come√ßar agora?",
            "remoteJid": "={{ $('start').item.json.remoteJid }}",
            "instanceName": "={{ $('start').item.json.evolution_instancia }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "instanceName",
              "displayName": "instanceName",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "remoteJid",
              "displayName": "remoteJid",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "messageText",
              "displayName": "messageText",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {
          "waitForSubWorkflow": true
        }
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        688,
        32
      ],
      "id": "4a59d348-bc0e-47ad-ae3b-ecfdf600ba83",
      "name": "Orienta√ß√µes iniciais"
    }
  ],
  "connections": {
    "start": {
      "main": [
        [
          {
            "node": "Redis Get",
            "type": "main",
            "index": 0
          },
          {
            "node": "Redis Delete1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Chat Memory Manager",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Redis Get": {
      "main": [
        [
          {
            "node": "Code - Controller (interations-style)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code - Controller (interations-style)": {
      "main": [
        [
          {
            "node": "Agent AI (interations-style)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agent AI (interations-style)": {
      "main": [
        [
          {
            "node": "Code - Parse Determin√≠stico",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Agent AI (interations-style)",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Code - Parse Determin√≠stico": {
      "main": [
        [
          {
            "node": "IF Finalizado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF Finalizado": {
      "main": [
        [
          {
            "node": "Insert User",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Call 'sw_send_message_with_retry'1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Insert User": {
      "main": [
        [
          {
            "node": "Insert Gamif",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Insert Gamif": {
      "main": [
        [
          {
            "node": "monta link para usuario",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "monta link para usuario": {
      "main": [
        [
          {
            "node": "Call 'sw_send_message_with_retry'",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Redis Chat Memory1": {
      "ai_memory": [
        [
          {
            "node": "Agent AI (interations-style)",
            "type": "ai_memory",
            "index": 0
          },
          {
            "node": "Chat Memory Manager",
            "type": "ai_memory",
            "index": 0
          },
          {
            "node": "Chat Memory Manager1",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Call 'sw_send_message_with_retry'": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Call 'sw_send_message_with_retry'1": {
      "main": [
        [
          {
            "node": "Redis Update",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Redis Delete": {
      "main": [
        [
          {
            "node": "Chat Memory Manager1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Orienta√ß√µes iniciais",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Orienta√ß√µes iniciais": {
      "main": [
        [
          {
            "node": "Redis Delete",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": null,
  "pinData": {
    "start": [
      {
        "json": {
          "remoteJid": "5512982389360@s.whatsapp.net",
          "pushName": "Aldo",
          "id": "3AB86843CF3B227F3612",
          "whatsapp_number": "5512982389360",
          "evolution_instancia": "MindQuest",
          "menssagem": "Aldo"
        }
      }
    ]
  },
  "versionId": "de9b2ca8-26ef-4311-9028-eb55e64b6d16",
  "triggerCount": 0,
  "shared": [
    {
      "createdAt": "2025-11-02T13:31:36.212Z",
      "role": "workflow:owner",
      "workflowId": "UlInW9nmQs7vnPIP",
      "projectId": "u1M57XAwIiLpPwjp",
      "project": {
        "createdAt": "2025-09-16T16:13:20.606Z",
        "id": "u1M57XAwIiLpPwjp",
        "name": "Aldo Santos <lindualdo@hotmail.com>",
        "type": "personal",
        "icon": null,
        "description": null,
        "projectRelations": [
          {
            "createdAt": "2025-09-16T16:13:20.606Z",
            "userId": "fa864d51-475e-4765-b3b4-12788525a3e6",
            "projectId": "u1M57XAwIiLpPwjp",
            "user": {
              "createdAt": "2025-09-16T16:13:20.056Z",
              "id": "fa864d51-475e-4765-b3b4-12788525a3e6",
              "email": "lindualdo@hotmail.com",
              "firstName": "Aldo",
              "lastName": "Santos",
              "personalizationAnswers": {
                "version": "v4",
                "personalization_survey_submitted_at": "2025-09-16T16:22:10.583Z",
                "personalization_survey_n8n_version": "1.108.1"
              },
              "settings": {
                "userActivated": true,
                "firstSuccessfulWorkflowId": "jUAvu7DUAzyqZhJd",
                "userActivatedAt": 1758041156747,
                "easyAIWorkflowOnboarded": true,
                "dismissedCallouts": {
                  "preBuiltAgentsModalCallout": true
                },
                "npsSurvey": {
                  "responded": true,
                  "lastShownAt": 1759918723295
                }
              },
              "disabled": false,
              "mfaEnabled": false,
              "isPending": false
            }
          }
        ]
      }
    }
  ],
  "tags": []
}
