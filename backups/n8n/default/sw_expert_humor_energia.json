{
  "createdAt": "2025-10-03T08:19:24.595Z",
  "updatedAt": "2025-10-10T09:12:19.136Z",
  "id": "GykxpS5vsg8NeoOh",
  "name": "sw_expert_humor_energia",
  "active": false,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "workflowInputs": {
          "values": [
            {
              "name": "usuario_id"
            },
            {
              "name": "mensagens"
            },
            {
              "name": "data_conversa"
            },
            {
              "name": "chat_id"
            },
            {
              "name": "usr_name"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        112,
        144
      ],
      "id": "f81a010a-e7b8-4eef-ab5a-fe632d471c6f",
      "name": "start"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Analise a conversa completa abaixo e detecte o HUMOR e ENERGIA do usuário com base APENAS no que foi dito.\n\n**CONVERSA COMPLETA:**\n```json\n{{ $json.mensagens }}\n```\n\nUser name: {{ $json.usr_name }}\n\n**SUA TAREFA:**\n1. Leia TODA a conversa (autor: \"usuario\" apenas)\n2. Detecte o HUMOR GERAL do dia (1-10):\n   - 1-3: muito negativo (tristeza profunda, desesperança)\n   - 4-5: negativo (desânimo, frustração)\n   - 6-7: neutro/misto (altos e baixos)\n   - 8-9: positivo (animado, esperançoso)\n   - 10: muito positivo (eufórico, excelente)\n\n3. Detecte o NÍVEL DE ENERGIA (1-10):\n   - 1-3: exausto, sem forças\n   - 4-5: cansado, baixa energia\n   - 6-7: energia moderada\n   - 8-9: disposto, energizado\n   - 10: muito energizado, hiperativo\n\n4. Identifique VARIAÇÃO durante a conversa:\n   - estavel: humor/energia constante\n   - ascendente: melhora ao longo da conversa\n   - descendente: piora ao longo da conversa\n   - oscilatoria: alterna muito\n\n5. Detecte PERÍODO DO DIA (se mencionado):\n   - manha, tarde, noite, madrugada\n   - Se não mencionado: \"nao_identificado\"\n\n**REGRAS:**\n- Base a análise APENAS nas palavras do usuário\n- Considere: tom emocional, vocabulário, descrições de atividades\n- Seja preciso e realista\n- Justifique brevemente cada score\n- Ao gerar a justificativa e resumo das conversas relacionados com o humor, use sempre o nome do usuário: {{ $json.usr_name }}\n- Caso o nome do usuário não seja informado, use o termo Usuário\n**RETORNE APENAS O JSON ESTRUTURADO**",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "Você é um especialista em análise de humor e energia em conversas.\n\nSeu trabalho é:\n1. Detectar o humor geral do dia (escala 1-10)\n2. Avaliar o nível de energia (escala 1-10)\n3. confianca_analise de 0 a 100\n4. Identificar variações durante a conversa\n5. Capturar período do dia se mencionado\n\nSeja objetivo, baseie-se apenas no texto real, e justifique suas avaliações de forma breve.\n\nRetorne SEMPRE um JSON válido com a estrutura exata solicitada.",
          "maxIterations": 3
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        352,
        144
      ],
      "id": "e04ad84a-70be-4a4b-b8c6-a92a118b4219",
      "name": "Analisador Humor & Energia"
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"humor_dia\": 4,\n  \"energia_nivel\": 6,\n  \"variacao_humor\": \"descendente\",\n  \"variacao_energia\": \"estavel\",\n  \"periodo_dia\": \"tarde\",\n  \"justificativa_humor\": \"Usuário começou o dia produtivo e animado, mas ao final relata tristeza profunda, angústia e desmotivação após ver fotos da ex-mulher\",\n  \"justificativa_energia\": \"Menciona que caminhou bastante, fez almoço, trabalhou no app - energia moderada/boa, mas manteve disposição física apesar da queda emocional\",\n  \"evidencias_textuais\": [\n    \"dia estava muito bom hoje, muito produtivo\",\n    \"estava disposto, animado\",\n    \"bateu uma coisa muito ruim\",\n    \"angústia, uma tristeza muito grande\",\n    \"muito desmotivado e desanimado\"\n  ],\n  \"confianca_analise\": 95\n}",
        "autoFix": true
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        464,
        368
      ],
      "id": "452b0b86-3402-422e-b71c-f55a9862f550",
      "name": "Parser JSON Humor"
    },
    {
      "parameters": {
        "options": {
          "maxTokens": 1000,
          "temperature": 0.2
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        320,
        496
      ],
      "id": "92b2b15b-7e90-4cfa-b048-d70c2c6d7c9e",
      "name": "OpenRouter Claude",
      "credentials": {
        "openRouterApi": {
          "id": "rSnkOnnAHyfayLJt",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "INSERT INTO usuarios_humor_energia (\n  usuario_id,\n  chat_id,\n  data_registro,\n  hora_registro,\n  periodo_dia,\n  humor_dia,\n  energia_nivel,\n  variacao_humor,\n  variacao_energia,\n  justificativa_humor,\n  justificativa_energia,\n  evidencias_textuais,\n  confianca_analise\n)\nVALUES (\n  $1::uuid,\n  $2::uuid,\n  $3::date,\n  CURRENT_TIME,\n  $4::varchar(20),\n  $5::integer,\n  $6::integer,\n  $7::varchar(20),\n  $8::varchar(20),\n  $9::text,\n  $10::text,\n  $11::jsonb,\n  $12::integer\n)\nRETURNING \n  id,\n  usuario_id,\n  chat_id,\n  data_registro,\n  hora_registro,\n  humor_dia,\n  energia_nivel,\n  variacao_humor,\n  variacao_energia,\n  periodo_dia;",
        "options": {
          "queryReplacement": "=[\n  {{ $('start').item.json.usuario_id }},                       // 1\n  {{ $('start').item.json.chat_id }},                          // 2\n  {{ ((v) => v ? new Date(v).toISOString().slice(0,10) : null)($('start').item.json.data_conversa) }}, // 3\n\n  {{ $json.output.periodo_dia }},                              // 4\n  {{ $json.output.humor_dia }},                                // 5\n  {{ $json.output.energia_nivel }},                            // 6\n  {{ $json.output.variacao_humor }},                           // 7\n  {{ $json.output.variacao_energia }},                         // 8\n  {{ JSON.stringify($json.output.justificativa_humor) }},      // 9\n  {{ JSON.stringify($json.output.justificativa_energia) }},    // 10\n  {{ JSON.stringify($json.output.evidencias_textuais) }},      // 11\n  {{ $json.output.confianca_analise }}                         // 12\n]\n"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        672,
        144
      ],
      "id": "314f2218-cb5a-4dd0-89e3-6a151cebe730",
      "name": "Gravar Humor & Energia",
      "credentials": {
        "postgres": {
          "id": "8ySWxtSO7gYK5uue",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        880,
        144
      ],
      "id": "9bb9c8bf-8c93-4cf3-a699-f65c2d7c3567",
      "name": "Edit Fields"
    }
  ],
  "connections": {
    "start": {
      "main": [
        [
          {
            "node": "Analisador Humor & Energia",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Analisador Humor & Energia": {
      "main": [
        [
          {
            "node": "Gravar Humor & Energia",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parser JSON Humor": {
      "ai_outputParser": [
        [
          {
            "node": "Analisador Humor & Energia",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Claude": {
      "ai_languageModel": [
        [
          {
            "node": "Analisador Humor & Energia",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Parser JSON Humor",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Gravar Humor & Energia": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": null,
  "pinData": {
    "start": [
      {
        "json": {
          "usuario_id": "8bc57788-8534-45a9-98be-39dc81ef4e6a",
          "mensagens": "[{\"interaction\":1,\"autor\":\"usuario\",\"texto\":\"Eu estou muito orgulhoso de mim hoje porque amanhã não foi das melhores, como eu já relatei antes. O mercado financeiro estava muito ruim. Eu acordei essa manhã com alguns ativos meus caindo muito, mas mantive a calma, consegui tomar as decisões, agir, agir rápido, com tranquilidade, mas com rapidez, que o mercado de risco, principalmente criptomoedas, exige essa rapidez. E o mercado caiu muito mais do que eu tinha olhado de manhã, mas como eu tinha agido e realizado prejuízo, o prejuízo teria sido muito maior se eu não tivesse tomado decisão. e a estratégia seguiu exatamente na direção do que eu tinha imaginado então isso me deu uma certa tranquilidade eu estou em paz, estou tranquilo, estou feliz, estou conseguindo trabalhar estou produzindo bastante no meu app e também conversei com algumas pessoas hoje não fiquei focado só nessa parte aí do mercado consegui me organizar para seguir minha vida\",\"timestamp\":\"2025-10-09T17:09:34.854Z\"},{\"interaction\":1,\"autor\":\"agente\",\"texto\":\"Aldo, percebo uma satisfação merecida pela forma como você conseguiu agir com serenidade e rapidez diante de uma situação desafiadora no mercado financeiro. Manter a calma e ainda conseguir organizar seu dia, equilibrando trabalho no app e interação social, é um sinal claro de controle e resiliência. Como você acha que essa experiência influenciou sua confiança para enfrentar situações similares no futuro?\",\"timestamp\":\"2025-10-09T17:09:34.854Z\"},{\"interaction\":2,\"autor\":\"usuario\",\"texto\":\"Então, a questão emocional é sempre um crescimento constante, né? Conforme a gente vai aprendendo e vai amadurecendo, vai ficando mais forte aí para resistir situações semelhantes no futuro. E é um conjunto de coisas, né? Também, como eu estou evoluindo um pouco na questão dos relacionamentos, não estou mais me sentindo tão sozinho, tem a questão do EPIC que também está avançando, a questão da minha saúde que eu estou conseguindo cuidar fazer caminhada mesmo em casa me movimentando então tem um conjunto de coisas que sendo feitas em paralelo vai fortalecendo um pouco mais a questão emocional me dando mais segurança\",\"timestamp\":\"2025-10-09T17:09:34.854Z\"},{\"interaction\":2,\"autor\":\"agente\",\"texto\":\"Aldo, é interessante ver como você está integrando diferentes áreas da sua vida para fortalecer seu equilíbrio emocional, desde os relacionamentos até o cuidado com a saúde. Essa abordagem holística parece estar ajudando a aumentar sua segurança interna. Quais desafios você tem encontrado para manter essa rotina equilibrada, especialmente quando o mercado financeiro exige tanta atenção?\",\"timestamp\":\"2025-10-09T17:09:34.854Z\"},{\"interaction\":3,\"autor\":\"usuario\",\"texto\":\"o desafio é manter esse equilíbrio é sempre desafiador porque qualquer uma área da vida da gente quando está muito ruim acaba abalando e minando a força nas outras então quando tudo acontece ao mesmo tempo na sua mente isso desmorona mas no momento as coisas estão não está 10 em nenhuma área da vida mas também não está 0 está um equilíbrio aí nas áreas da vida, então isso dá uma uma certa tranquilidade para ir agindo e evoluindo aos poucos em cada uma delas\",\"timestamp\":\"2025-10-09T17:09:34.854Z\"},{\"interaction\":3,\"autor\":\"agente\",\"texto\":\"Aldo, compreendo que esse equilíbrio entre áreas da vida pode ser delicado porque um impacto mais forte em alguma delas pode abalar todo o seu sistema emocional. O fato de você perceber esse “meio termo” atual como uma base para continuar agindo aos poucos é um sinal importante de maturidade. Que estratégias ou hábitos específicos você tem utilizado para manter essa estabilidade mesmo quando alguma área começa a mostrar dificuldades?\",\"timestamp\":\"2025-10-09T17:09:34.854Z\"},{\"interaction\":4,\"autor\":\"usuario\",\"texto\":\"falando em hábitos, atividade física, cuidar da alimentação, dormir bem, descansar bem, manter minha mente ocupada em coisas produtivas, seguindo minhas ideias e meus projetos. Esses são os hábitos. E a estratégia é dar clareza, continuar conversando aqui com o EPP, ter clareza dos gatilhos que disparam alguns eventos no meu emocional, acompanhar isso de perto, sentir as minhas emoções, me conhecer mais, autoconhecimento, tudo isso ajuda.\",\"timestamp\":\"2025-10-09T17:09:34.854Z\"},{\"interaction\":4,\"autor\":\"agente\",\"texto\":\"Aldo, pelo que você compartilhou, entendo que seus hábitos de autocuidado são bem estruturados, incluindo atividade física, alimentação adequada, sono de qualidade e manter a mente focada em projetos produtivos. Além disso, você valoriza a clareza sobre seus gatilhos emocionais, o autoconhecimento e o acompanhamento próximo das suas emoções, usando esses recursos para se fortalecer emocionalmente. Esses elementos juntos formam uma estratégia consistente para manter seu equilíbrio e crescimento pessoal.\\n\\nPontos principais:\\n- Prática regular de hábitos saudáveis (atividade física, alimentação, sono)\\n- Foco em manter a mente ocupada com projetos\\n- Atenção constante aos gatilhos emocionais\\n- Valorização do autoconhecimento e do monitoramento das emoções\\n- Uso do diálogo (como com o EPP) para clareza emocional\\n\\nConsegui entender bem sua situação?\",\"timestamp\":\"2025-10-09T17:09:34.854Z\"},{\"interaction\":5,\"autor\":\"usuario\",\"texto\":\"Sim isso mesmo\",\"timestamp\":\"2025-10-09T17:09:34.854Z\"},{\"interaction\":5,\"autor\":\"agente\",\"texto\":\"Aldo, fico feliz em saber que consegui captar bem sua situação. Você demonstra um autocontrole admirável e uma estratégia sólida que integra hábitos saudáveis e autoconhecimento para fortalecer sua estabilidade emocional. Continuar nesse caminho consistente certamente vai facilitar seu progresso e resiliência.\\n\\nNossa conversa de hoje está finalizada, te espero amanhã para saber as novidades.\\n\\n{\\n  \\\"interaction_completa\\\": true,\\n  \\\"total_interactions\\\": 5,\\n  \\\"status\\\": \\\"completa\\\",\\n  \\\"contexto_final\\\": {\\n    \\\"situacao_emocional\\\": \\\"equilíbrio emocional com autoconhecimento e controle em situação desafiadora\\\",\\n    \\\"contextos_mencionados\\\": [\\\"mercado financeiro\\\", \\\"relacionamentos\\\", \\\"autocuidado\\\", \\\"monitoramento emocional\\\"],\\n    \\\"sentimentos_expressos\\\": [\\\"calma\\\", \\\"tranquilidade\\\", \\\"confiança\\\"],\\n    \\\"eventos_importantes\\\": [\\\"queda no mercado financeiro\\\", \\\"ações rápidas para minimizar prejuízo\\\", \\\"avanço em projetos pessoais\\\"],\\n    \\\"intensidade_geral\\\": \\\"média\\\",\\n    \\\"validado_pelo_usuario\\\": true,\\n    \\\"observacoes_agente\\\": \\\"perfil disciplinado, uso eficaz de estratégias estruturadas para manter o equilíbrio e crescimento emocional\\\"\\n  },\\n  \\\"emocoes_detectadas\\\": {\\n    \\\"emocao_primaria\\\": \\\"trust\\\",\\n    \\\"intensidade_emocao\\\": 7,\\n    \\\"energia_detectada\\\": 6,\\n    \\\"humor_autoavaliado\\\": 7\\n  },\\n  \\\"qualidade_interacao\\\": 8,\\n  \\\"emoji_dia\\\": \\\"😊\\\",\\n  \\\"pronta_para_especialista\\\": true\\n}\",\"timestamp\":\"2025-10-09T17:09:34.854Z\"}]",
          "data_conversa": "Thu Oct 09 2025 00:00:00 GMT+0000 (Coordinated Universal Time)",
          "chat_id": "879a3dd2-9131-42e3-aba0-b7b84a4e4c8f",
          "usr_name": "Aldo Santos"
        }
      }
    ]
  },
  "versionId": "74b0931e-5d59-458d-95c1-8ff9ec412ab2",
  "triggerCount": 0,
  "shared": [
    {
      "createdAt": "2025-10-03T08:19:24.595Z",
      "updatedAt": "2025-10-03T08:19:24.595Z",
      "role": "workflow:owner",
      "workflowId": "GykxpS5vsg8NeoOh",
      "projectId": "u1M57XAwIiLpPwjp",
      "project": {
        "createdAt": "2025-09-16T16:13:20.606Z",
        "updatedAt": "2025-09-25T16:38:18.729Z",
        "id": "u1M57XAwIiLpPwjp",
        "name": "Aldo Santos <lindualdo@hotmail.com>",
        "type": "personal",
        "icon": null,
        "description": null,
        "projectRelations": [
          {
            "createdAt": "2025-09-16T16:13:20.606Z",
            "updatedAt": "2025-09-16T16:13:20.606Z",
            "userId": "fa864d51-475e-4765-b3b4-12788525a3e6",
            "projectId": "u1M57XAwIiLpPwjp",
            "user": {
              "createdAt": "2025-09-16T16:13:20.056Z",
              "updatedAt": "2025-10-27T08:00:06.115Z",
              "id": "fa864d51-475e-4765-b3b4-12788525a3e6",
              "email": "lindualdo@hotmail.com",
              "firstName": "Aldo",
              "lastName": "Santos",
              "personalizationAnswers": {
                "version": "v4",
                "personalization_survey_submitted_at": "2025-09-16T16:22:10.583Z",
                "personalization_survey_n8n_version": "1.108.1"
              },
              "settings": {
                "userActivated": true,
                "firstSuccessfulWorkflowId": "jUAvu7DUAzyqZhJd",
                "userActivatedAt": 1758041156747,
                "easyAIWorkflowOnboarded": true,
                "dismissedCallouts": {
                  "preBuiltAgentsModalCallout": true
                },
                "npsSurvey": {
                  "responded": true,
                  "lastShownAt": 1759918723295
                }
              },
              "disabled": false,
              "mfaEnabled": false,
              "lastActiveAt": "2025-10-27",
              "isPending": false
            }
          }
        ]
      }
    }
  ],
  "tags": []
}