{
  "createdAt": "2025-10-03T08:19:24.595Z",
  "updatedAt": "2025-10-10T09:12:19.136Z",
  "id": "GykxpS5vsg8NeoOh",
  "name": "sw_expert_humor_energia",
  "active": false,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "workflowInputs": {
          "values": [
            {
              "name": "usuario_id"
            },
            {
              "name": "mensagens"
            },
            {
              "name": "data_conversa"
            },
            {
              "name": "chat_id"
            },
            {
              "name": "usr_name"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        112,
        144
      ],
      "id": "f81a010a-e7b8-4eef-ab5a-fe632d471c6f",
      "name": "start"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Analise a conversa completa abaixo e detecte o HUMOR e ENERGIA do usu√°rio com base APENAS no que foi dito.\n\n**CONVERSA COMPLETA:**\n```json\n{{ $json.mensagens }}\n```\n\nUser name: {{ $json.usr_name }}\n\n**SUA TAREFA:**\n1. Leia TODA a conversa (autor: \"usuario\" apenas)\n2. Detecte o HUMOR GERAL do dia (1-10):\n   - 1-3: muito negativo (tristeza profunda, desesperan√ßa)\n   - 4-5: negativo (des√¢nimo, frustra√ß√£o)\n   - 6-7: neutro/misto (altos e baixos)\n   - 8-9: positivo (animado, esperan√ßoso)\n   - 10: muito positivo (euf√≥rico, excelente)\n\n3. Detecte o N√çVEL DE ENERGIA (1-10):\n   - 1-3: exausto, sem for√ßas\n   - 4-5: cansado, baixa energia\n   - 6-7: energia moderada\n   - 8-9: disposto, energizado\n   - 10: muito energizado, hiperativo\n\n4. Identifique VARIA√á√ÉO durante a conversa:\n   - estavel: humor/energia constante\n   - ascendente: melhora ao longo da conversa\n   - descendente: piora ao longo da conversa\n   - oscilatoria: alterna muito\n\n5. Detecte PER√çODO DO DIA (se mencionado):\n   - manha, tarde, noite, madrugada\n   - Se n√£o mencionado: \"nao_identificado\"\n\n**REGRAS:**\n- Base a an√°lise APENAS nas palavras do usu√°rio\n- Considere: tom emocional, vocabul√°rio, descri√ß√µes de atividades\n- Seja preciso e realista\n- Justifique brevemente cada score\n- Ao gerar a justificativa e resumo das conversas relacionados com o humor, use sempre o nome do usu√°rio: {{ $json.usr_name }}\n- Caso o nome do usu√°rio n√£o seja informado, use o termo Usu√°rio\n**RETORNE APENAS O JSON ESTRUTURADO**",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "Voc√™ √© um especialista em an√°lise de humor e energia em conversas.\n\nSeu trabalho √©:\n1. Detectar o humor geral do dia (escala 1-10)\n2. Avaliar o n√≠vel de energia (escala 1-10)\n3. confianca_analise de 0 a 100\n4. Identificar varia√ß√µes durante a conversa\n5. Capturar per√≠odo do dia se mencionado\n\nSeja objetivo, baseie-se apenas no texto real, e justifique suas avalia√ß√µes de forma breve.\n\nRetorne SEMPRE um JSON v√°lido com a estrutura exata solicitada.",
          "maxIterations": 3
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        352,
        144
      ],
      "id": "e04ad84a-70be-4a4b-b8c6-a92a118b4219",
      "name": "Analisador Humor & Energia"
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"humor_dia\": 4,\n  \"energia_nivel\": 6,\n  \"variacao_humor\": \"descendente\",\n  \"variacao_energia\": \"estavel\",\n  \"periodo_dia\": \"tarde\",\n  \"justificativa_humor\": \"Usu√°rio come√ßou o dia produtivo e animado, mas ao final relata tristeza profunda, ang√∫stia e desmotiva√ß√£o ap√≥s ver fotos da ex-mulher\",\n  \"justificativa_energia\": \"Menciona que caminhou bastante, fez almo√ßo, trabalhou no app - energia moderada/boa, mas manteve disposi√ß√£o f√≠sica apesar da queda emocional\",\n  \"evidencias_textuais\": [\n    \"dia estava muito bom hoje, muito produtivo\",\n    \"estava disposto, animado\",\n    \"bateu uma coisa muito ruim\",\n    \"ang√∫stia, uma tristeza muito grande\",\n    \"muito desmotivado e desanimado\"\n  ],\n  \"confianca_analise\": 95\n}",
        "autoFix": true
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        464,
        368
      ],
      "id": "452b0b86-3402-422e-b71c-f55a9862f550",
      "name": "Parser JSON Humor"
    },
    {
      "parameters": {
        "options": {
          "maxTokens": 1000,
          "temperature": 0.2
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        320,
        496
      ],
      "id": "92b2b15b-7e90-4cfa-b048-d70c2c6d7c9e",
      "name": "OpenRouter Claude",
      "credentials": {
        "openRouterApi": {
          "id": "rSnkOnnAHyfayLJt",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "INSERT INTO usuarios_humor_energia (\n  usuario_id,\n  chat_id,\n  data_registro,\n  hora_registro,\n  periodo_dia,\n  humor_dia,\n  energia_nivel,\n  variacao_humor,\n  variacao_energia,\n  justificativa_humor,\n  justificativa_energia,\n  evidencias_textuais,\n  confianca_analise\n)\nVALUES (\n  $1::uuid,\n  $2::uuid,\n  $3::date,\n  CURRENT_TIME,\n  $4::varchar(20),\n  $5::integer,\n  $6::integer,\n  $7::varchar(20),\n  $8::varchar(20),\n  $9::text,\n  $10::text,\n  $11::jsonb,\n  $12::integer\n)\nRETURNING \n  id,\n  usuario_id,\n  chat_id,\n  data_registro,\n  hora_registro,\n  humor_dia,\n  energia_nivel,\n  variacao_humor,\n  variacao_energia,\n  periodo_dia;",
        "options": {
          "queryReplacement": "=[\n  {{ $('start').item.json.usuario_id }},                       // 1\n  {{ $('start').item.json.chat_id }},                          // 2\n  {{ ((v) => v ? new Date(v).toISOString().slice(0,10) : null)($('start').item.json.data_conversa) }}, // 3\n\n  {{ $json.output.periodo_dia }},                              // 4\n  {{ $json.output.humor_dia }},                                // 5\n  {{ $json.output.energia_nivel }},                            // 6\n  {{ $json.output.variacao_humor }},                           // 7\n  {{ $json.output.variacao_energia }},                         // 8\n  {{ JSON.stringify($json.output.justificativa_humor) }},      // 9\n  {{ JSON.stringify($json.output.justificativa_energia) }},    // 10\n  {{ JSON.stringify($json.output.evidencias_textuais) }},      // 11\n  {{ $json.output.confianca_analise }}                         // 12\n]\n"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        672,
        144
      ],
      "id": "314f2218-cb5a-4dd0-89e3-6a151cebe730",
      "name": "Gravar Humor & Energia",
      "credentials": {
        "postgres": {
          "id": "8ySWxtSO7gYK5uue",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        880,
        144
      ],
      "id": "9bb9c8bf-8c93-4cf3-a699-f65c2d7c3567",
      "name": "Edit Fields"
    }
  ],
  "connections": {
    "start": {
      "main": [
        [
          {
            "node": "Analisador Humor & Energia",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Analisador Humor & Energia": {
      "main": [
        [
          {
            "node": "Gravar Humor & Energia",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parser JSON Humor": {
      "ai_outputParser": [
        [
          {
            "node": "Analisador Humor & Energia",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Claude": {
      "ai_languageModel": [
        [
          {
            "node": "Analisador Humor & Energia",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Parser JSON Humor",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Gravar Humor & Energia": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": null,
  "pinData": {
    "start": [
      {
        "json": {
          "usuario_id": "8bc57788-8534-45a9-98be-39dc81ef4e6a",
          "mensagens": "[{\"interaction\":1,\"autor\":\"usuario\",\"texto\":\"Eu estou muito orgulhoso de mim hoje porque amanh√£ n√£o foi das melhores, como eu j√° relatei antes. O mercado financeiro estava muito ruim. Eu acordei essa manh√£ com alguns ativos meus caindo muito, mas mantive a calma, consegui tomar as decis√µes, agir, agir r√°pido, com tranquilidade, mas com rapidez, que o mercado de risco, principalmente criptomoedas, exige essa rapidez. E o mercado caiu muito mais do que eu tinha olhado de manh√£, mas como eu tinha agido e realizado preju√≠zo, o preju√≠zo teria sido muito maior se eu n√£o tivesse tomado decis√£o. e a estrat√©gia seguiu exatamente na dire√ß√£o do que eu tinha imaginado ent√£o isso me deu uma certa tranquilidade eu estou em paz, estou tranquilo, estou feliz, estou conseguindo trabalhar estou produzindo bastante no meu app e tamb√©m conversei com algumas pessoas hoje n√£o fiquei focado s√≥ nessa parte a√≠ do mercado consegui me organizar para seguir minha vida\",\"timestamp\":\"2025-10-09T17:09:34.854Z\"},{\"interaction\":1,\"autor\":\"agente\",\"texto\":\"Aldo, percebo uma satisfa√ß√£o merecida pela forma como voc√™ conseguiu agir com serenidade e rapidez diante de uma situa√ß√£o desafiadora no mercado financeiro. Manter a calma e ainda conseguir organizar seu dia, equilibrando trabalho no app e intera√ß√£o social, √© um sinal claro de controle e resili√™ncia. Como voc√™ acha que essa experi√™ncia influenciou sua confian√ßa para enfrentar situa√ß√µes similares no futuro?\",\"timestamp\":\"2025-10-09T17:09:34.854Z\"},{\"interaction\":2,\"autor\":\"usuario\",\"texto\":\"Ent√£o, a quest√£o emocional √© sempre um crescimento constante, n√©? Conforme a gente vai aprendendo e vai amadurecendo, vai ficando mais forte a√≠ para resistir situa√ß√µes semelhantes no futuro. E √© um conjunto de coisas, n√©? Tamb√©m, como eu estou evoluindo um pouco na quest√£o dos relacionamentos, n√£o estou mais me sentindo t√£o sozinho, tem a quest√£o do EPIC que tamb√©m est√° avan√ßando, a quest√£o da minha sa√∫de que eu estou conseguindo cuidar fazer caminhada mesmo em casa me movimentando ent√£o tem um conjunto de coisas que sendo feitas em paralelo vai fortalecendo um pouco mais a quest√£o emocional me dando mais seguran√ßa\",\"timestamp\":\"2025-10-09T17:09:34.854Z\"},{\"interaction\":2,\"autor\":\"agente\",\"texto\":\"Aldo, √© interessante ver como voc√™ est√° integrando diferentes √°reas da sua vida para fortalecer seu equil√≠brio emocional, desde os relacionamentos at√© o cuidado com a sa√∫de. Essa abordagem hol√≠stica parece estar ajudando a aumentar sua seguran√ßa interna. Quais desafios voc√™ tem encontrado para manter essa rotina equilibrada, especialmente quando o mercado financeiro exige tanta aten√ß√£o?\",\"timestamp\":\"2025-10-09T17:09:34.854Z\"},{\"interaction\":3,\"autor\":\"usuario\",\"texto\":\"o desafio √© manter esse equil√≠brio √© sempre desafiador porque qualquer uma √°rea da vida da gente quando est√° muito ruim acaba abalando e minando a for√ßa nas outras ent√£o quando tudo acontece ao mesmo tempo na sua mente isso desmorona mas no momento as coisas est√£o n√£o est√° 10 em nenhuma √°rea da vida mas tamb√©m n√£o est√° 0 est√° um equil√≠brio a√≠ nas √°reas da vida, ent√£o isso d√° uma uma certa tranquilidade para ir agindo e evoluindo aos poucos em cada uma delas\",\"timestamp\":\"2025-10-09T17:09:34.854Z\"},{\"interaction\":3,\"autor\":\"agente\",\"texto\":\"Aldo, compreendo que esse equil√≠brio entre √°reas da vida pode ser delicado porque um impacto mais forte em alguma delas pode abalar todo o seu sistema emocional. O fato de voc√™ perceber esse ‚Äúmeio termo‚Äù atual como uma base para continuar agindo aos poucos √© um sinal importante de maturidade. Que estrat√©gias ou h√°bitos espec√≠ficos voc√™ tem utilizado para manter essa estabilidade mesmo quando alguma √°rea come√ßa a mostrar dificuldades?\",\"timestamp\":\"2025-10-09T17:09:34.854Z\"},{\"interaction\":4,\"autor\":\"usuario\",\"texto\":\"falando em h√°bitos, atividade f√≠sica, cuidar da alimenta√ß√£o, dormir bem, descansar bem, manter minha mente ocupada em coisas produtivas, seguindo minhas ideias e meus projetos. Esses s√£o os h√°bitos. E a estrat√©gia √© dar clareza, continuar conversando aqui com o EPP, ter clareza dos gatilhos que disparam alguns eventos no meu emocional, acompanhar isso de perto, sentir as minhas emo√ß√µes, me conhecer mais, autoconhecimento, tudo isso ajuda.\",\"timestamp\":\"2025-10-09T17:09:34.854Z\"},{\"interaction\":4,\"autor\":\"agente\",\"texto\":\"Aldo, pelo que voc√™ compartilhou, entendo que seus h√°bitos de autocuidado s√£o bem estruturados, incluindo atividade f√≠sica, alimenta√ß√£o adequada, sono de qualidade e manter a mente focada em projetos produtivos. Al√©m disso, voc√™ valoriza a clareza sobre seus gatilhos emocionais, o autoconhecimento e o acompanhamento pr√≥ximo das suas emo√ß√µes, usando esses recursos para se fortalecer emocionalmente. Esses elementos juntos formam uma estrat√©gia consistente para manter seu equil√≠brio e crescimento pessoal.\\n\\nPontos principais:\\n- Pr√°tica regular de h√°bitos saud√°veis (atividade f√≠sica, alimenta√ß√£o, sono)\\n- Foco em manter a mente ocupada com projetos\\n- Aten√ß√£o constante aos gatilhos emocionais\\n- Valoriza√ß√£o do autoconhecimento e do monitoramento das emo√ß√µes\\n- Uso do di√°logo (como com o EPP) para clareza emocional\\n\\nConsegui entender bem sua situa√ß√£o?\",\"timestamp\":\"2025-10-09T17:09:34.854Z\"},{\"interaction\":5,\"autor\":\"usuario\",\"texto\":\"Sim isso mesmo\",\"timestamp\":\"2025-10-09T17:09:34.854Z\"},{\"interaction\":5,\"autor\":\"agente\",\"texto\":\"Aldo, fico feliz em saber que consegui captar bem sua situa√ß√£o. Voc√™ demonstra um autocontrole admir√°vel e uma estrat√©gia s√≥lida que integra h√°bitos saud√°veis e autoconhecimento para fortalecer sua estabilidade emocional. Continuar nesse caminho consistente certamente vai facilitar seu progresso e resili√™ncia.\\n\\nNossa conversa de hoje est√° finalizada, te espero amanh√£ para saber as novidades.\\n\\n{\\n  \\\"interaction_completa\\\": true,\\n  \\\"total_interactions\\\": 5,\\n  \\\"status\\\": \\\"completa\\\",\\n  \\\"contexto_final\\\": {\\n    \\\"situacao_emocional\\\": \\\"equil√≠brio emocional com autoconhecimento e controle em situa√ß√£o desafiadora\\\",\\n    \\\"contextos_mencionados\\\": [\\\"mercado financeiro\\\", \\\"relacionamentos\\\", \\\"autocuidado\\\", \\\"monitoramento emocional\\\"],\\n    \\\"sentimentos_expressos\\\": [\\\"calma\\\", \\\"tranquilidade\\\", \\\"confian√ßa\\\"],\\n    \\\"eventos_importantes\\\": [\\\"queda no mercado financeiro\\\", \\\"a√ß√µes r√°pidas para minimizar preju√≠zo\\\", \\\"avan√ßo em projetos pessoais\\\"],\\n    \\\"intensidade_geral\\\": \\\"m√©dia\\\",\\n    \\\"validado_pelo_usuario\\\": true,\\n    \\\"observacoes_agente\\\": \\\"perfil disciplinado, uso eficaz de estrat√©gias estruturadas para manter o equil√≠brio e crescimento emocional\\\"\\n  },\\n  \\\"emocoes_detectadas\\\": {\\n    \\\"emocao_primaria\\\": \\\"trust\\\",\\n    \\\"intensidade_emocao\\\": 7,\\n    \\\"energia_detectada\\\": 6,\\n    \\\"humor_autoavaliado\\\": 7\\n  },\\n  \\\"qualidade_interacao\\\": 8,\\n  \\\"emoji_dia\\\": \\\"üòä\\\",\\n  \\\"pronta_para_especialista\\\": true\\n}\",\"timestamp\":\"2025-10-09T17:09:34.854Z\"}]",
          "data_conversa": "Thu Oct 09 2025 00:00:00 GMT+0000 (Coordinated Universal Time)",
          "chat_id": "879a3dd2-9131-42e3-aba0-b7b84a4e4c8f",
          "usr_name": "Aldo Santos"
        }
      }
    ]
  },
  "versionId": "74b0931e-5d59-458d-95c1-8ff9ec412ab2",
  "triggerCount": 0,
  "shared": [
    {
      "createdAt": "2025-10-03T08:19:24.595Z",
      "updatedAt": "2025-10-03T08:19:24.595Z",
      "role": "workflow:owner",
      "workflowId": "GykxpS5vsg8NeoOh",
      "projectId": "u1M57XAwIiLpPwjp",
      "project": {
        "createdAt": "2025-09-16T16:13:20.606Z",
        "updatedAt": "2025-09-25T16:38:18.729Z",
        "id": "u1M57XAwIiLpPwjp",
        "name": "Aldo Santos <lindualdo@hotmail.com>",
        "type": "personal",
        "icon": null,
        "description": null,
        "projectRelations": [
          {
            "createdAt": "2025-09-16T16:13:20.606Z",
            "updatedAt": "2025-09-16T16:13:20.606Z",
            "userId": "fa864d51-475e-4765-b3b4-12788525a3e6",
            "projectId": "u1M57XAwIiLpPwjp",
            "user": {
              "createdAt": "2025-09-16T16:13:20.056Z",
              "updatedAt": "2025-10-27T08:00:06.115Z",
              "id": "fa864d51-475e-4765-b3b4-12788525a3e6",
              "email": "lindualdo@hotmail.com",
              "firstName": "Aldo",
              "lastName": "Santos",
              "personalizationAnswers": {
                "version": "v4",
                "personalization_survey_submitted_at": "2025-09-16T16:22:10.583Z",
                "personalization_survey_n8n_version": "1.108.1"
              },
              "settings": {
                "userActivated": true,
                "firstSuccessfulWorkflowId": "jUAvu7DUAzyqZhJd",
                "userActivatedAt": 1758041156747,
                "easyAIWorkflowOnboarded": true,
                "dismissedCallouts": {
                  "preBuiltAgentsModalCallout": true
                },
                "npsSurvey": {
                  "responded": true,
                  "lastShownAt": 1759918723295
                }
              },
              "disabled": false,
              "mfaEnabled": false,
              "lastActiveAt": "2025-10-27",
              "isPending": false
            }
          }
        ]
      }
    }
  ],
  "tags": []
}