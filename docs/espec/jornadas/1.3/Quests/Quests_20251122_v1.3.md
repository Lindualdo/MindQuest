# Quests v1.3 - Documentação Consolidada

**Data:** 2025-11-22 20:23  
**Versão:** 1.3  
**Status:** Documento consolidado - manter durante limpeza de documentos antigos

---

## 1. Visão Geral

### 1.1. O que são Quests

**Quests** são desafios personalizados (micro-ações) sugeridos pelo assistente de IA para manter o usuário em movimento, respeitando seus limites.

---

### 1.2. Ciclo de Transformação / Processo do Sistema MindQuest

O sistema funciona em 5 etapas conectadas:

1. **Conversa:** Usuário faz uma conversa no WhatsApp com o Assistente de IA
2. **Insights:** Sistema gera insights com base na conversa
3. **Quests:** Sistema gera quests de acordo com os objetivos definidos pelo usuário/assistente
4. **Ação:** Para melhorar o engajamento, usuário terá a opção de escolher as quests prioritárias (banco de quests) - **A implementar**
5. **Assistente de Suporte:** Irá interagir com usuário para lembrar/ajudar na execução

**Status Atual (v1.3):**
- ✅ Conversas, Insights e Geração de Quests: **Implementado**
- ⏳ Escolha de Quests Prioritárias: **A implementar**
- ⏳ Reboot de Recorrências Concluídas: **A implementar**

**Nota:** As recorrências são para ajudar o usuário a criar hábitos. Permitir reboot permitirá reiniciar hábitos após conclusão, mantendo a consistência na formação de rotinas.

---

### 1.3. Por que existem no sistema

**Objetivo:** Conectar reflexão (conversas) com execução (ações), fechando o ciclo:
- **Conversas** → geram clareza e insights
- **Quests** → transformam insights em ações concretas
- **Progresso** → registra conquistas e reforça hábitos

**Problema que resolvem:**
- "Ideias incríveis na cabeça, mas trava na hora de agir"
- "Começa projetos com empolgação, mas depois a motivação evapora"
- "Vive em loops infinitos de pensamentos, mas não chega a nenhum lugar"

---

### 1.4. Importância no sistema

**Papel estratégico:**
1. **Motivação contínua:** Pontos, sequências e conquistas mantêm o ritmo
2. **Progresso visível:** Evolução semanal celebrando conquistas reais
3. **Hábitos consistentes:** Micro-ações diárias que viram rotina natural
4. **Diferenciação:** MindQuest não é só reflexão, é evolução pessoal integrada

**Sistema de Pontuação:**
- Pontuações são para **estimular/motivar** o usuário
- Alimentarão o sistema de evolução na jornada através de **mudança de níveis** nas versões futuras

---

### 1.5. Importância do Sistema de Quests / Missões

**Quests são o coração do sistema MindQuest.**

Sem quests, não há ações. Sem ações, não há transformação para o usuário. O sistema perde o sentido.

**Missão da Equipe:**
Fazer o usuário se "viciar" em usar o sistema:
- Fazer as conversas
- Concluir as quests
- Aumentar as conquistas semanais
- Bater as metas

**Ciclo de Transformação Visual:**

```
┌─────────────────────────────────────────────────────────────────┐
│                    AUTO CONHECIMENTO                          │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐       │
│  │ Perfil/      │  │ Sabotadores   │  │ Humor Energia│       │
│  │ Arquétipos   │  │               │  │ Emoções      │       │
│  └──────┬───────┘  └──────┬────────┘  └──────┬────────┘       │
│         │                 │                   │                │
│         └─────────────────┼───────────────────┘                │
│                           │                                     │
│                    ┌──────▼──────┐                             │
│                    │  Conversas  │◄─── Hub Central              │
│                    │  (WhatsApp) │                             │
│                    └──────┬──────┘                             │
│                           │                                     │
│                           │                                     │
│                    ┌──────▼──────┐                             │
│                    │   Insights  │                             │
│                    └──────┬──────┘                             │
│                           │                                     │
│         ┌─────────────────┼─────────────────┐                  │
│         │                 │                 │                  │
│  ┌──────▼──────┐  ┌──────▼──────┐  ┌──────▼──────┐           │
│  │  Áreas da   │  │   Insights  │  │             │           │
│  │    Vida     │  │             │  │             │           │
│  └──────┬──────┘  └──────┬──────┘  │             │           │
│         │                │         │             │           │
│         └────────────────┼─────────┘             │           │
│                          │                       │           │
│                    ┌─────▼───────────────────────▼──┐        │
│                    │                                │        │
│                    │    ╔═══════════════════╗       │        │
│                    │    ║                   ║       │        │
│                    └───►║     QUESTS        ║◄──────┘        │
│                         ║   (CORAÇÃO DO     ║                 │
│                         ║    SISTEMA)      ║                 │
│                         ║                   ║                 │
│                         ╚═══════════════════╝                 │
│                                │                               │
│                                │                               │
│                         ┌──────▼──────┐                       │
│                         │  AÇÕES      │                       │
│                         │  (Execução) │                       │
│                         └──────┬──────┘                       │
│                                │                               │
│                         ┌──────▼──────┐                       │
│                         │ TRANSFORMAÇÃO│                       │
│                         │   DO USUÁRIO │                       │
│                         └─────────────┘                       │
└─────────────────────────────────────────────────────────────────┘
```

**Fluxo de Valor:**

1. **Conversas** (Hub Central)
   - Usuário interage com Assistente de IA via WhatsApp
   - Gera dados de auto conhecimento (Perfil, Sabotadores, Humor, Áreas da Vida)

2. **Insights**
   - Derivados das conversas
   - Processam e organizam o auto conhecimento

3. **Quests** ⭐ **CORAÇÃO DO SISTEMA**
   - Recebem inputs de **Insights** e **Áreas da Vida**
   - Transformam reflexão em ação concreta
   - **Sem quests = sem transformação = sistema sem sentido**

4. **Ações (Execução)**
   - Usuário executa as quests
   - Registra progresso e conquistas

5. **Transformação do Usuário**
   - Resultado final: mudança real e mensurável
   - Hábitos formados, objetivos alcançados

**Por que Quests são o Coração:**

- **Conversas** geram clareza, mas não mudam comportamento sozinhas
- **Insights** organizam informações, mas não criam movimento
- **Quests** transformam intenção em ação → **AÇÃO = TRANSFORMAÇÃO**

**Engajamento = Conversas + Quests + Metas Batidas**

---

### 1.6. Separação: Planejamento vs Execução

**Princípio:** Separação clara entre o que foi planejado e o que foi realizado.

- **PLANEJAMENTO** (`usuarios_quest.recorrencias`): Datas previstas de conclusão (não muda)
- **EXECUÇÃO** (`conquistas_historico.detalhes`): Data real de conclusão (fonte de verdade para barras)

**Resumo:** Planejado vs Realizado vs Consolidado.

---

## 2. Estrutura de Dados (Objetivos)

### 2.1. `usuarios_quest.recorrencias` → Planejamento

**Objetivo:** Armazenar o planejamento da quest (o que deve ser feito e quando).

**Responsabilidade:**
- Define quais dias existem na quest
- Define o XP previsto para cada dia
- Snapshot do momento da criação (não muda nunca)

**Estrutura:**
```json
{
  "tipo": "diaria" | "semanal" | "unica",
  "janela": {
    "inicio": "2025-11-16",
    "fim": "2025-11-22"
  },
  "dias": [
    {
      "data": "2025-11-16",
      "xp_previsto": 30
    }
  ]
}
```

**Regra fundamental:** `recorrencias` NÃO armazena histórico de conclusões. É apenas planejamento.

**Observação:** `recorrencias` não muda após criação (snapshot do planejamento). Nas versões futuras, o usuário poderá mudar as prioridades das quests, mas isso não alterará o `recorrencias` original.

**Uso:** Fonte para calcular metas (barras de progresso).

---

### 2.2. `conquistas_historico.detalhes` → Execução

**Objetivo:** Armazenar o histórico real de conclusões (o que foi realizado).

**Responsabilidade:**
- Registro incremental por conclusão
- Única fonte de verdade para status de conclusão
- Relacionamento 1:1 via `meta_codigo = usuarios_quest.id`

**Relacionamento:**
- `usuarios_quest.id` = `conquistas_historico.meta_codigo` AND `tipo = 'quest'`
- Permite comparar o **previsto** (`usuarios_quest.recorrencias`) com o **realizado** (`conquistas_historico.detalhes`)

**Estrutura do `detalhes`:**
```json
{
  "recorrencia": "diaria",
  "data_conclusao": "2025-11-20",
  "total_concluidas": 3,
  "ocorrencias": [
    {
      "data_planejada": "2025-11-19",
      "data_concluida": "2025-11-19",
      "data_registrada": "2025-11-20T14:30:00.000Z",
      "xp_base": 30,
      "xp_bonus": 6
    }
  ]
}
```

**Campos de data:**
- `data_planejada`: Data prevista em `recorrencias` (auditoria)
- `data_concluida`: Data real de conclusão (usado para cálculos)
- `data_registrada`: Timestamp de registro (auditoria)

**Uso:** Fonte para calcular concluídas (barras de progresso).

**Como consultar previsto vs realizado:**
- **Previsto:** `usuarios_quest.recorrencias->dias[]` (datas e xp_previsto)
- **Realizado:** `conquistas_historico.detalhes->ocorrencias[]` (datas concluídas e xp_base/xp_bonus)
- **Relacionamento:** `usuarios_quest.id` = `conquistas_historico.meta_codigo`

---

### 2.3. `usuarios_conquistas` → Pontuação Consolidada

**Objetivo:** Consolidar pontuação total do usuário para cálculo de nível da jornada.

**Responsabilidade:**
- Somar `xp_base` e `xp_bonus` separadamente
- Calcular `xp_total` (base + bônus)
- Contar total de quests concluídas

**Campos principais:**
- `xp_base`: Soma de pontos base
- `xp_bonus`: Soma de pontos bônus
- `xp_total`: base + bônus (para cálculo de nível)
- `total_quests_concluidas`: Contador de quests

**Uso:** Alimentar sistema de evolução (mudança de níveis nas versões futuras).

---

### 2.4. Schema das Tabelas

**Documento de referência:** `schema_tabelas_quests.md`

Para detalhes completos do schema das tabelas relacionadas a quests, incluindo:
- Estrutura completa de colunas
- Índices e constraints
- Relacionamentos (Foreign Keys)
- Estruturas JSONB detalhadas
- Tabelas relacionadas (`areas_vida_catalogo`, `sabotadores_catalogo`, `metas_catalogo`)

**Consultar:** `docs/espec/jornadas/1.3/Quests/schema_tabelas_quests.md`

---

## 3. Webhooks e APIs Utilizadas

### 3.1. Mapeamento Completo

**Card / Página** | **Pasta Física** | **Objetivo** | **Webhook Utilizado**
-----------------|------------------|--------------|-------------------
**CardWeeklyProgress** (Home) | `src/components/app/v1.3/CardWeeklyProgress.tsx` | Exibir progresso semanal consolidado (conversas + quests) na home | `webhook_progresso_semanal`<br/>Endpoint: `/progresso-semanal?user_id={id}`<br/>Método: `getWeeklyProgressCard()`
**PainelQuestsPageV13** | `src/pages/App/v1.3/PainelQuestsPageV13.tsx` | Painel completo de quests com lista e progresso semanal | **3 webhooks:**<br/>1. `webhook_quests`<br/>Endpoint: `/quests?usuario_id={id}`<br/>Método: `getQuestSnapshot()`<br/>2. `webhook_progresso_semanal`<br/>Endpoint: `/progresso-semanal?user_id={id}`<br/>Método: `getWeeklyProgressCard()`<br/>3. `webhook_concluir_quest`<br/>Endpoint: `/concluir-quest?usuario_id={id}&quest_id={id}&data_referencia={date}`<br/>Método: `concluirQuest()`
**QuestDetailPageV13** | `src/pages/App/v1.3/QuestDetailPageV13.tsx` | Página de detalhes de uma quest específica | `webhook_quest_detail`<br/>Endpoint: `/quest-detail?user_id={id}&quest_id={id}`<br/>Método: `getQuestDetail()`

### 3.2. Detalhamento dos Webhooks

#### `webhook_progresso_semanal`
- **Objetivo:** Calcular progresso semanal consolidado (conversas + quests)
- **Uso:** Card na home (`CardWeeklyProgress`)
- **Retorna:** Meta vs realizado por dia, total semanal, status das barras
- **Fonte de dados:**
  - Metas: `usuarios_quest.recorrencias->dias[]` (previsto)
  - Concluídas: `conquistas_historico.detalhes->ocorrencias[]` (realizado)

#### `webhook_quests`
- **Objetivo:** Retornar snapshot completo de quests do usuário
- **Uso:** Painel de quests (`PainelQuestsPageV13`)
- **Retorna:** Lista de quests personalizadas com status, progresso, datas
- **Fonte de dados:** `usuarios_quest` + `conquistas_historico`

#### `webhook_progresso_semanal` (usado no Painel)
- **Objetivo:** Calcular progresso semanal consolidado (conversas + quests)
- **Uso:** Painel de quests (`PainelQuestsPageV13`) - mesmo webhook da home, mas exibido de forma diferente
- **Retorna:** Progresso semanal com detalhamento por dia
- **Fonte de dados:** Mesmas do `webhook_progresso_semanal` da home

#### `webhook_concluir_quest`
- **Objetivo:** Registrar conclusão de uma quest
- **Uso:** Botão "Concluir" em `PainelQuestsPageV13` e `QuestDetailPageV13`
- **Parâmetros:** `usuario_id`, `quest_id`, `data_referencia` (opcional)
- **Ações:**
  1. Atualiza `usuarios_quest.status`
  2. Chama `sw_xp_quest` para processar XP
  3. Atualiza `conquistas_historico`
  4. Atualiza `usuarios_conquistas`

#### `webhook_quest_detail`
- **Objetivo:** Retornar detalhes completos de uma quest específica
- **Uso:** Página de detalhes (`QuestDetailPageV13`)
- **Retorna:** Informações completas da quest (título, descrição, instruções, área da vida, sabotador, etc.)
- **Fonte de dados:** `usuarios_quest` + JOINs com `areas_vida_catalogo` e `sabotadores_catalogo`

### 3.3. Sub-workflows (sw_*)

#### `sw_criar_quest`
- **Objetivo:** Gerar quests através de agente de IA
- **Chamado por:** Sistema (não diretamente pelo frontend)
- **Resultado:** Quests criadas e persistidas via `sw_xp_quest`

#### `sw_xp_quest`
- **Objetivo:** Persistir quest e calcular XP
- **Chamado por:** `sw_criar_quest` (criação) e `webhook_concluir_quest` (conclusão)
- **Ações:**
  - Cria/atualiza registro em `usuarios_quest`
  - Popula `recorrencias` com planejamento
  - Calcula e registra XP em `conquistas_historico`
  - Atualiza `usuarios_conquistas`

---

## 4. Workflows (Objetivos)

### 3.1. `sw_criar_quest` → Inteligência de Criação

**Objetivo:** Gerar quest através de agente de IA com base nos objetivos do usuário.

**Responsabilidade:**
- Processar solicitação do usuário/assistente
- Usar agente de IA para criar quest personalizada
- Definir objetivos, complexidade e recorrência
- Preparar dados para persistência

**Quando é chamado:**
- Quando o assistente de IA precisa gerar uma nova quest
- Durante criação de quest via chat ou interface

**Resultado:**
- Quest criada com inteligência de IA
- Dados preparados para persistência

---

### 3.2. `sw_xp_quest` → Persistência e Cálculo

**Objetivo:** Persistir quest na base e popular `recorrencias` com o planejamento.

**Responsabilidade:**
- Criar registro em `usuarios_quest`
- Gerar agenda de dias entre `prazo_inicio` e `prazo_fim`
- Popular `recorrencias` com estrutura JSONB (tipo, janela, dias)
- Calcular XPs e atualizar status na base
- Suporta qualquer tipo de recorrência (diária, semanal, única)

**Quando é chamado:**
- Após `sw_criar_quest` gerar a quest
- Para processar conclusões e calcular XP

**Resultado:**
- Quest persistida com `recorrencias` preenchido (planejamento completo)
- XPs calculados e status atualizados

---

### 3.3. `webhook_concluir_quest` → Registrar Conclusão

**Objetivo:** Registrar quando uma quest é concluída pelo usuário.

**Responsabilidade:**
- Receber `quest_id`, `usuario_id` e `data_referencia`
- Atualizar `usuarios_quest.recorrencias` (marcar dia como concluído)
- Chamar `sw_xp_quest` para processar XP e atualizar `conquistas_historico`
- Passar `data_referencia` para registro correto da data de conclusão

**Quando é chamado:**
- Quando usuário marca quest como concluída no app
- Via frontend ao clicar em "Concluir" na barra de progresso

**Resultado:**
- Quest marcada como concluída em `recorrencias`
- Registro criado/atualizado em `conquistas_historico`
- Pontos atualizados em `usuarios_conquistas`

---

### 3.4. `webhook_progresso_semanal` → Calcular Progresso

**Objetivo:** Calcular progresso semanal para exibir no card "Meu Progresso Semanal".

**Responsabilidade:**
- Calcular **metas** usando `usuarios_quest.recorrencias->dias[]` (previsto)
- Calcular **concluídas** usando `conquistas_historico.detalhes->ocorrencias[]` (realizado)
- Agregar por dia da semana
- Retornar dados para barras de progresso (diárias e semanal)

**Quando é chamado:**
- Quando usuário acessa o card de progresso semanal no app
- Atualização automática após conclusão de quests

**Resultado:**
- Dados de meta vs realizado por dia
- Total semanal de pontos
- Status das barras (completo/parcial/pendente)

---

## 4. Regras de Negócio

### 4.1. Metas (Fonte: `recorrencias`)

**Objetivo:** Calcular o que foi planejado para cada dia.

**Fonte de dados:**
- `usuarios_quest.recorrencias->dias[]`
- Campo `xp_previsto` de cada dia

**Regra:**
- Soma `xp_previsto` de todos os dias previstos na semana
- Usa `recorrencias->dias[].data` para identificar os dias
- Meta diária = Conversa + Soma das metas das quests ativas

**Pontuações:**
- **SEMPRE consultar `metas_catalogo`** para valores atualizados
- **NUNCA usar valores hardcoded**
- Valores variam por tipo de ação e complexidade

---

### 4.2. Concluídas (Fonte: `conquistas_historico`)

**Objetivo:** Calcular o que foi realizado em cada dia.

**Fonte de dados:**
- `conquistas_historico.detalhes->ocorrencias[]`
- Campo `data_concluida` para identificar o dia
- Campo `xp_base` para somar pontos (sem bônus)

**Regra:**
- Soma `xp_base` (sem bônus) usando `data_concluida`
- Agrupa por data de conclusão real
- Usa apenas `xp_base` (bônus não conta para progresso)

---

### 4.3. Bônus (Não Conta para Meta)

**Objetivo:** Motivar sem alterar metas.

**Regra fundamental:**
- Bônus **NÃO conta** para:
  - Meta de quests
  - Cálculo de concluídas
  - Barras de progresso
- Bônus **conta APENAS** para:
  - Mudança de níveis na jornada (`xp_total` para calcular `nivel_atual`)

**Tipos de bônus:**
- **SEMPRE consultar `metas_catalogo`** para valores atualizados
- **NUNCA usar valores hardcoded**
- Valores variam por tipo de bônus (streak, primeira conversa, recorrência, etc.)

**Resumo:** Bônus não conta para meta/progresso, apenas para nível da jornada.

---

## 5. Casos Especiais

### 5.1. Quest Única

**Objetivo:** Quest que deve ser concluída apenas uma vez.

**Estrutura:**
- `recorrencias.tipo = "unica"`
- `recorrencias.janela.inicio = recorrencias.janela.fim` (mesmo dia)
- `recorrencias.dias[]` contém apenas 1 dia

**Exemplo:**
```json
{
  "tipo": "unica",
  "janela": {
    "inicio": "2025-11-20",
    "fim": "2025-11-20"
  },
  "dias": [
    {
      "data": "2025-11-20",
      "xp_previsto": 30
    }
  ]
}
```

**Regra:**
- Após conclusão, status muda para `'concluida'` e não reseta
- Pontuação: **SEMPRE consultar `metas_catalogo`** para valores atualizados

---

### 5.2. Conversas Diárias

**Objetivo:** Registrar conversas diárias como meta automática do sistema.

**Características:**
- **Um único registro por usuário** em `conquistas_historico`
- `meta_codigo = 'conversa_diaria'` (fixo)
- `meta_titulo = 'Conversa diária'` (fixo)
- `tipo = 'conversa'`

**Estrutura do `detalhes`:**
```json
{
  "recorrencia": "diaria",
  "total_concluidas": 5,
  "ocorrencias": [
    {
      "data_planejada": "2025-11-16",
      "data_concluida": "2025-11-16",
      "data_registrada": "2025-11-16T14:30:00.000Z",
      "xp_base": 15,
      "xp_bonus": 0
    }
  ]
}
```

**Regras:**
- Pontuação base: **SEMPRE consultar `metas_catalogo`** onde `codigo = 'conversa_diaria'`
- Apenas a primeira conversa do dia conta (15 pts base)
- Streaks geram bônus, mas **NÃO contam na meta/progresso semanal**
- Bônus de streaks contam apenas para `xp_total` (mudança de nível)

**Fonte de dados:**
- Histórico: `usr_chat` (todas as conversas)
- Registro consolidado: `conquistas_historico` (1 registro por usuário)
- Pontuação: `metas_catalogo` (valores oficiais)

**Cálculo de meta diária:**
- Meta = 1 conversa (15 pts) + quests ativas do dia (30 pts cada)
- **NUNCA usar valores hardcoded** - sempre consultar `metas_catalogo`

---

## 6. Validações e Boas Práticas

### 6.1. Consulta de Pontuações

**Regra fundamental:**
- **SEMPRE consultar `metas_catalogo`** para valores de pontuação
- **NUNCA usar valores hardcoded** em código ou workflows
- Valores podem mudar e devem ser atualizados apenas em `metas_catalogo`

**Exemplos de consulta:**
- Conversa diária: `SELECT pontos FROM metas_catalogo WHERE codigo = 'conversa_diaria'`
- Quest base: `SELECT pontos FROM metas_catalogo WHERE codigo = 'xp_base_quest'`
- Bônus recorrência: `SELECT pontos FROM metas_catalogo WHERE codigo = 'xp_bonus_recorrencia'`

### 6.2. Separação de Responsabilidades

**Planejamento (`recorrencias`):**
- Snapshot do momento da criação
- Não muda após criação
- Fonte para calcular metas

**Execução (`conquistas_historico`):**
- Registro incremental de conclusões
- Única fonte de verdade para status
- Fonte para calcular concluídas

**Consolidação (`usuarios_conquistas`):**
- Saldo total para cálculo de nível
- Atualização incremental
- Separação clara: `xp_base` vs `xp_bonus` vs `xp_total`

### 6.3. Bônus vs Progresso

**Regra clara:**
- Bônus **NÃO conta** para meta/progresso semanal
- Bônus **conta APENAS** para `xp_total` (mudança de nível)
- Sempre usar `xp_base` para cálculos de progresso
- Sempre usar `xp_total` para cálculos de nível

---

## 7. Próximos Passos

### 7.1. Painel de Detalhes das Quests

**Objetivo:** Criar um painel completo de detalhes para cada quest, exibindo informações contextuais que ajudem o usuário a entender e executar a quest.

**Informações a exibir:**
- **Objetivo:** Descrição clara do que a quest busca alcançar
- **Valor gerado:** Pontuação (XP) que a quest gera ao ser concluída
- **Como aplicar:** Instruções práticas de execução
- **Área da vida relacionada:** Qual área da vida está sendo trabalhada (ex: Carreira, Relacionamentos, Saúde)
- **Sabotador relacionado:** Qual padrão mental/sabotador está sendo trabalhado

**Estrutura técnica:**
- Campo `instrucoes` (JSONB) em `usuarios_quest` contendo:
  - `feedback_importancia`: Por que é importante fazer essa quest
  - `feedback_orientacao`: Atenções ou orientações importantes
  - `feedback_motivacional`: Mensagem motivacional para executar
  - `recursos_sugeridos`: Array de recursos práticos (técnicas, práticas, reflexões, conceitos, leituras)

**Dados complementares:**
- Área da vida: Via `area_vida_id` → JOIN com `areas_vida_catalogo`
- Sabotador: Via `sabotador_id` → JOIN com `sabotadores_catalogo`
- Pontuação: Via `xp_recompensa` (consultar `metas_catalogo` para valores atualizados)

**Plano de implementação:**
- **Documento de referência:** `docs/plano_instrucoes_quest.md`
- **Fases:**
  1. Criar campo `instrucoes` (JSONB) na tabela `usuarios_quest`
  2. Ajustar `sw_criar_quest` para gerar instruções completas via IA
  3. Ajustar `sw_xp_quest` para persistir campo `instrucoes`
  4. Atualizar `webhook_quest_detail` para retornar dados completos
  5. Frontend: Criar página de detalhes exibindo todas as informações

**Status:** ⏳ Planejado - Ver `docs/plano_instrucoes_quest.md` para detalhes completos

---

### 7.2. Sistema de Estágios e Gestão de Quests

**Objetivo:** Implementar sistema de estágios para quests com controle de ativação pelo usuário e gestão de slots.

**Estágios das Quests:**
1. **Planejada:** Quest criada pelo sistema, aguardando ativação pelo usuário
2. **Ativa/Pendente:** Quest ativada pelo usuário, disponível para execução
3. **Concluída:** Quest finalizada (mantém comportamento atual)

**Estado Atual:**
- Sistema atual possui apenas: `pendente` e `concluida`
- Todas as quests são criadas já como `pendente` (visíveis e contam nas metas)

**Novo Fluxo:**
- **Criação:** Todas as quests nascem como `planejada`
- **Ativação:** Usuário ativa manualmente (até ativar, quest não aparece nas metas)
- **Execução:** Após ativação, quest vira `ativa/pendente` e segue fluxo atual
- **Conclusão:** Mantém comportamento atual

**Tipos de Quests e Regras:**

1. **Quest Recorrente de Sistema (Sabotador):**
   - **Sempre presente:** Uma quest recorrente relacionada ao sabotador mais ativo
   - **Geração:** Sistema gera múltiplas opções, usuário escolhe qual ativar
   - **Recorrência:** Usuário escolhe prazo: 3, 5, 7, 10 ou 15 dias

2. **Quest Recorrente Escolhida pelo Usuário:**
   - Usuário pode escolher quests recorrentes personalizadas
   - **Recorrência:** Usuário escolhe prazo: 3, 5, 7, 10 ou 15 dias

3. **Quest Única:**
   - Quest de execução única
   - Não possui recorrência

**Regras de Slots:**
- **Limite:** Cada usuário pode ter até **5 quests ativas** simultaneamente
- **Liberação de slot:** Slot só é liberado após usuário concluir **todas as sequências** da quest recorrente
- **Bloqueio:** Enquanto houver quest recorrente não concluída completamente, não libera slot para novas quests

**Exemplo de Fluxo:**
```
1. Sistema gera 3 quests relacionadas ao sabotador ativo → Status: "planejada"
2. Usuário escolhe 1 quest de sabotador → Ativa → Status: "ativa" (prazo: 7 dias)
3. Sistema gera 2 quests recorrentes personalizadas → Status: "planejada"
4. Usuário escolhe 1 quest recorrente → Ativa → Status: "ativa" (prazo: 5 dias)
5. Usuário tem 2 quests ativas (1 sabotador + 1 recorrente)
6. Usuário conclui todas as sequências da quest recorrente → Slot liberado
7. Sistema pode gerar nova quest → Status: "planejada"
8. Usuário ativa nova quest → Status: "ativa"
```

**Impacto nas Metas:**
- **Quests `planejada`:** **NÃO contam** nas metas diárias/semanais
- **Quests `ativa/pendente`:** **Contam** nas metas (comportamento atual)
- **Quests `concluida`:** **Não contam** nas metas (comportamento atual)

**Status:** ⏳ Planejado - Requer alterações em workflows e frontend

---

### 7.3. Melhorias na Interface e Experiência do Usuário

**Objetivo:** Reorganizar interface de quests e melhorar engajamento através de informações claras sobre pontuação e jornada.

**Mudanças na Interface:**

1. **Migração do Painel de Conversas:**
   - **Remover:** Painel de conversas do painel de quests
   - **Migrar para:** Home (card dedicado ou seção específica)
   - **Benefício:** Separar responsabilidades - quests focadas em ações, conversas em reflexão

2. **Sistema de Abas e Carrossel:**
   - **Implementar:** Planejamentos na mesma interface atual usando sistema de abas
   - **Funcionalidade:** Carrossel para navegar entre quests planejadas, ativas e concluídas
   - **Organização:** Separar visualmente os estágios (planejada → ativa → concluída)

3. **Resumo de Níveis da Jornada:**
   - **Localização:** Final do painel de quests
   - **Conteúdo:** Resumo objetivo sobre os níveis da jornada
   - **Objetivo:** Mostrar progresso do usuário na evolução pessoal
   - **Informações:** Nível atual, progresso para próximo nível, benefícios de cada nível

4. **Sistema de Pontuação - Explicação e Engajamento:**
   - **Explicação objetiva:** Como funciona o sistema de pontuação
   - **Transparência:** Mostrar de onde vêm os pontos (conversas, quests, bônus)
   - **Engajamento:** Mensagens motivacionais sobre conquistas e progresso
   - **Visualização:** Gráficos ou indicadores visuais do progresso semanal/mensal
   - **Metas claras:** Mostrar meta diária vs realizado de forma intuitiva

**Estrutura Proposta:**

```
Painel de Quests:
├── Abas:
│   ├── Planejadas (carrossel)
│   ├── Ativas (carrossel)
│   └── Concluídas (carrossel)
├── Resumo de Níveis:
│   ├── Nível atual
│   ├── Progresso para próximo nível
│   └── Benefícios do próximo nível
└── Sistema de Pontuação:
    ├── Explicação objetiva
    ├── Pontos da semana
    ├── Meta vs Realizado
    └── Mensagens de engajamento
```

**Benefícios:**
- Interface mais organizada e focada
- Maior clareza sobre progresso e pontuação
- Aumento de engajamento através de feedback visual
- Separação clara entre reflexão (conversas) e ação (quests)

**Status:** ⏳ Planejado - Requer alterações no frontend e design de interface

---

### 7.4. Refatoração: Simplificação da Tabela `usuarios_quest`

**Objetivo:** Remover campos não utilizados ou legados da tabela `usuarios_quest` para simplificar e melhorar performance.

**Análise completa:** `docs/espec/jornadas/1.3/Quests/analise_campos_usuarios_quest.md`

**Campos identificados para remoção:**
- **Fase 1 (Segura):** `tentativas`, `cancelado_em`, `referencia_data`
- **Fase 2 (Após validação):** `progresso_atual`, `progresso_meta`, `progresso_percentual`, `xp_concedido`, `reiniciada_em`
- **Fase 3 (Avaliar):** `contexto_origem`, `concluido_em`, `insight_id`

**Justificativa:**
- Sistema v1.3 usa `recorrencias` (planejamento) e `conquistas_historico` (execução)
- Campos de progresso são legados do sistema antigo
- XP é armazenado em `conquistas_historico` (fonte de verdade)

**Status:** ⏳ Planejado - Ver `analise_campos_usuarios_quest.md` para detalhes e migrations SQL

---

*Documento consolidado - versão 1.3*

