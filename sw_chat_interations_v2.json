{
  "name": "sw_chat_interations_v2",
  "nodes": [
    {
      "parameters": {
        "workflowInputs": {
          "values": [
            {
              "name": "usr_id"
            },
            {
              "name": "body.instance"
            },
            {
              "name": "body.data.key.id"
            },
            {
              "name": "body.data.key.remoteJid"
            },
            {
              "name": "body.data.key.fromMe",
              "type": "boolean"
            },
            {
              "name": "body.data.pushName"
            },
            {
              "name": "body.data.message.conversation"
            },
            {
              "name": "body.data.messageType"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        -5248,
        448
      ],
      "id": "2f293090-26f4-4cc9-8a9e-97364e7055ca",
      "name": "start"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT\n  u.nome,\n  u.id,\n  u.nome_preferencia,\n  u.nome_assistente,\n  u.token_acesso,\n  u.cronotipo_detectado,\n  u.whatsapp_numero,\n  COALESCE(p.perfil_primario, 'neutro') perfil_primario\nFROM usuarios u\nLEFT JOIN perfis_big_five p\n  ON p.usuario_id = u.id\nWHERE u.id = $1;\n",
        "options": {
          "queryReplacement": "={{ $('start').item.json.usr_id }}"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -5088,
        448
      ],
      "id": "7d8d108b-5a3e-4e4c-8106-d985a5e47f65",
      "name": "dados_usr",
      "credentials": {
        "postgres": {
          "id": "8ySWxtSO7gYK5uue",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "jUAvu7DUAzyqZhJd",
          "mode": "list",
          "cachedResultUrl": "/workflow/jUAvu7DUAzyqZhJd",
          "cachedResultName": "sw_chat_transcription"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "body.instance": "={{ $('start').item.json[\"body.instance\"] }}",
            "body.data.key.remoteJid": "={{ $('start').item.json[\"body.data.key.remoteJid\"] }}",
            "body.data.key.id": "={{ $('start').item.json[\"body.data.key.id\"] }}",
            "body.data.key.fromMe": "={{ $('start').item.json[\"body.data.key.fromMe\"] }}",
            "body.data.pushName": "={{ $('start').item.json[\"body.data.pushName\"] }}",
            "body.data.message.conversation": "={{ $('start').item.json[\"body.data.message.conversation\"] }}",
            "body.data.messageType": "={{ $('start').item.json[\"body.data.messageType\"] }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "body.instance",
              "displayName": "body.instance",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "body.data.key.remoteJid",
              "displayName": "body.data.key.remoteJid",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "body.data.key.id",
              "displayName": "body.data.key.id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "body.data.key.fromMe",
              "displayName": "body.data.key.fromMe",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "boolean"
            },
            {
              "id": "body.data.pushName",
              "displayName": "body.data.pushName",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "body.data.message.conversation",
              "displayName": "body.data.message.conversation",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "body.data.messageType",
              "displayName": "body.data.messageType",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        -3984,
        448
      ],
      "id": "a3937f12-a200-4910-9b55-91264febbc45",
      "name": "Transcri√ß√£o"
    },
    {
      "parameters": {
        "jsCode": "// =======================================\n// NODE: Build Keys\n// Gera sessionKey e lockKey √∫nicas por usu√°rio\n// =======================================\n\n// Captura dados necess√°rios\nconst startData = $('start').first().json;\nconst userData = $('dados_usr').first().json;\n\n// Extrai valores com fallback de seguran√ßa\nconst instance = startData?.['body.instance'] || 'unknownInstance';\nconst userId = startData?.usr_id || 'unknownUser';\nconst phone = userData?.whatsapp_numero || 'unknownPhone';\n\n// Monta chaves\nconst sessionKey = `${instance}_${userId}_${phone}`;\nconst lockKey = `lock:${sessionKey}`;\n\n// Retorna como JSON limpo\nreturn {\n  sessionKey,\n  lockKey\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -4864,
        448
      ],
      "id": "5fc65859-c0c3-4c4e-a088-c5e4f544c734",
      "name": "Build Keys"
    },
    {
      "parameters": {
        "operation": "get",
        "key": "={{ $('Build Keys').first().json.lockKey }}",
        "options": {}
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -4672,
        448
      ],
      "id": "7362d50f-b7d6-48e7-b27a-435195c177ca",
      "name": "Redis GET Lock",
      "credentials": {
        "redis": {
          "id": "PB4zpLy1jLXDEzmH",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "leftValue": "={{ \n  Number(\n    (\n      (\n        $('Redis GET Lock').first().json.propertyName \n        || $('Redis GET Lock').first().json.value \n        || JSON.stringify($('Redis GET Lock').first().json)\n      ).toString().match(/\\d{10,}/)?.[0]   /* pega o epoch (>=10 d√≠gitos) onde quer que esteja */\n    ) || 0\n  )\n}}\n",
              "rightValue": "={{ +Math.floor(Date.now()/1000) }}\n",
              "operator": {
                "type": "number",
                "operation": "gt"
              },
              "id": "bda2c9fa-d4eb-44bb-86d3-f3fba4f7a194"
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -4240,
        336
      ],
      "id": "7650ee05-b548-4fb3-9dd9-c12019739a0e",
      "name": "LOCK ativo?"
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "={{ $('start').first().json[\"body.instance\"] }}",
        "remoteJid": "={{ $('start').first().json[\"body.data.key.remoteJid\"] }}",
        "messageText": "=Nosso ciclo de 5 intera√ß√µes j√° foi conclu√≠do. \n\nVolte em {{$('Calcula tempo restante').first().json.remaining_hm}} √†s {{$('Calcula tempo restante').first().json.unlock_clock}}. \n\nSeu painel j√° est√° atualizado üôå",
        "options_message": {
          "delay": 1200
        }
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        -2800,
        144
      ],
      "id": "da979b56-b5ca-41cd-b40e-29b2b7fc6a3f",
      "name": "Mensagem de Bloqueio (12h)",
      "retryOnFail": true,
      "maxTries": 2,
      "waitBetweenTries": 3000,
      "credentials": {
        "evolutionApi": {
          "id": "H4gurJcNVV0yrS90",
          "name": "Evolution account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('start').first().json[\"body.instance\"] }}{{ $('start').first().json.usr_id }}{{ $('dados_usr').first().json.whatsapp_numero }}",
        "sessionTTL": 43200,
        "contextWindowLength": 20
      },
      "type": "@n8n/n8n-nodes-langchain.memoryRedisChat",
      "typeVersion": 1.5,
      "position": [
        -2688,
        1232
      ],
      "id": "f4416fb0-6ead-4cb9-b25f-66a221a2ba10",
      "name": "memory",
      "credentials": {
        "redis": {
          "id": "PB4zpLy1jLXDEzmH",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "options": {
          "groupMessages": true
        }
      },
      "type": "@n8n/n8n-nodes-langchain.memoryManager",
      "typeVersion": 1.1,
      "position": [
        -3760,
        448
      ],
      "id": "ba6a3b92-78e3-4772-ab6a-5aa49f3cff7d",
      "name": "Chat Memory  - Get"
    },
    {
      "parameters": {
        "jsCode": "// ============================================\n// CONTROLE DE INTERA√á√ïES - N8N CODE NODE\n// Com suporte correto a Item Linking\n// ============================================\n\nconst userData = $('dados_usr').first().json;\n\n// Tenta acessar dados da mem√≥ria (pode n√£o existir na primeira intera√ß√£o)\nlet memoryData = null;\ntry {\n  const inputItems = $input.all();\n  if (inputItems && inputItems.length > 0) {\n    memoryData = inputItems[0].json;\n  }\n} catch (error) {\n  memoryData = null;\n}\n\n// Calcula n√∫mero da intera√ß√£o atual\nlet interactionCount = 1;\nif (memoryData && memoryData.messages && Array.isArray(memoryData.messages)) {\n  const systemMessages = memoryData.messages.filter(msg => msg.system);\n  interactionCount = systemMessages.length + 1;\n}\n\n// Limita a 5 intera√ß√µes\n//interactionCount = Math.min(interactionCount, 5);\n\n// Define foco para cada intera√ß√£o\nlet nextFocus;\nlet isLastInteraction = false;\nlet shouldGenerateJson = false;\n\nswitch(interactionCount) {\n  case 1: \n    nextFocus = \"PRIMEIRA INTERA√á√ÉO: Sauda√ß√£o calorosa usando o nome preferido + an√°lise emp√°tica da mensagem + UMA pergunta para aprofundar o contexto emocional\"; \n    break;\n  case 2: \n    nextFocus = \"SEGUNDA INTERA√á√ÉO: Aprofundar especificamente a situa√ß√£o apresentada + explorar sentimentos subjacentes + UMA pergunta sobre impactos ou desafios\"; \n    break;\n  case 3: \n    nextFocus = \"TERCEIRA INTERA√á√ÉO: Continuar di√°logo validando a experi√™ncia + oferecer perspectiva emp√°tica + UMA pergunta sobre estrat√©gias ou recursos\"; \n    break;\n  case 4: \n    nextFocus = \"QUARTA INTERA√á√ÉO: **OBRIGAT√ìRIO** - Fazer resumo completo do entendimento + listar pontos principais + perguntar 'Consegui entender bem sua situa√ß√£o?' para valida√ß√£o\"; \n    break;\n  case 5: \n    nextFocus = \"QUINTA INTERA√á√ÉO: **ENCERRAMENTO OBRIGAT√ìRIO** - Processar feedback do usu√°rio (se houver corre√ß√£o, ajustar brevemente) + dar conclus√£o emp√°tica + dizer 'Nossa conversa de hoje est√° finalizada' + gerar JSON\";\n    isLastInteraction = true;\n    shouldGenerateJson = true;\n    break;\n  default: \n    nextFocus = \"Sess√£o j√° encerrada - n√£o deve mais responder\"; \n    break;\n}\n\n// ============================================\n// RETORNO COM PAIRED ITEM\n// Mant√©m v√≠nculo com item de entrada para \n// permitir acesso via .item em n√≥s posteriores\n// ============================================\n\nreturn [{\n  json: {\n    interaction_count: interactionCount,\n    next_focus: nextFocus,\n    should_generate_json: shouldGenerateJson,\n    is_last_interaction: isLastInteraction,\n    nome_preferencia: userData.nome_preferencia || userData.nome || \"amigo\",\n    perfil_usuario: userData.perfil_primario || \"neutro\",\n    instructions_adherence: \"CRITICAL: Follow next_focus instructions EXACTLY\"\n  },\n  pairedItem: 0\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3472,
        448
      ],
      "id": "19ee8178-6166-456b-9831-b6eddbd7609d",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "mode": "insert",
        "messages": {
          "messageValues": [
            {
              "message": "=Sistema: Interaction {{ $('Code in JavaScript').item.json.interaction_count }} de 5. Foco: {{ $('Code in JavaScript').item.json.next_focus }}.",
              "hideFromUI": true
            }
          ]
        }
      },
      "type": "@n8n/n8n-nodes-langchain.memoryManager",
      "typeVersion": 1.1,
      "position": [
        -3312,
        448
      ],
      "id": "7b78e7ee-257c-471c-88a1-89f624055b1a",
      "name": "Chat Memory - Insert"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Code in JavaScript').first().json.interaction_count }}",
                    "rightValue": 5,
                    "operator": {
                      "type": "number",
                      "operation": "gt"
                    },
                    "id": "e9d7398d-88e3-4023-8a02-606ab2e3a08a"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Maior que 5"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Code in JavaScript').first().json.interaction_count }}",
                    "rightValue": 5,
                    "operator": {
                      "type": "number",
                      "operation": "lte"
                    },
                    "id": "50077f16-4b38-4c3c-b47e-bc210052084f"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Menor ou igual a 5"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -3024,
        448
      ],
      "id": "fd01d507-8f9f-4bfa-905c-9385280a74af",
      "name": "Intera√ß√µes (Pr√©-Agente)"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        -2848,
        704
      ],
      "id": "63b988d2-ceb6-4002-aa5b-7473f58d0e75",
      "name": "OpenRouter Chat Model",
      "credentials": {
        "openRouterApi": {
          "id": "rSnkOnnAHyfayLJt",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "description": "Use this tool to search the history of users' latest conversations.",
        "workflowId": {
          "__rl": true,
          "value": "HDTrSrJiBIv2FFks",
          "mode": "list",
          "cachedResultUrl": "/workflow/HDTrSrJiBIv2FFks",
          "cachedResultName": "sw_get_history"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "usr_id": "={{ $('dados_usr').item.json.id }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "usr_id",
              "displayName": "usr_id",
              "type": "string"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        -2640,
        720
      ],
      "id": "96620880-5a42-46ec-9a1a-667d1ca5a1ec",
      "name": "get_history"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=# üí¨ USER PROMPT ‚Äî MINDQUEST v2.2  \n## Contexto da Conversa com o Mentor\n\nVoc√™ est√° falando com seu **Mentor de Vida MindQuest**, um assistente pessoal criado para te ouvir, entender suas emo√ß√µes e te ajudar a transformar o que sente em clareza e foco.  \nEu represento sua **parte mais equilibrada e consciente**, treinada para te guiar com leveza e empatia.\n\n\n---\n\n## üß≠ TAREFA DO AGENTE\n1. **Chame a ferramenta `get_history`** para buscar o hist√≥rico das √∫ltimas conversas e compreender melhor o contexto do usu√°rio.  \n2. Use o hist√≥rico para **criar rapport, empatia e engajamento**, incentivando-o a se expressar mais livremente.  \n3. Leia a **mensagem atual do usu√°rio** e **siga as instru√ß√µes do System Prompt** para conduzir a conversa dentro do fluxo de **5 intera√ß√µes**.  \n4. **Use o hist√≥rico apenas se fizer sentido** dentro do contexto atual (nunca force uma conex√£o artificial).  \n5 - se o numero de intera√ß√µes for maior que 5, fale gentilmente com o usuario e reforce que esta conversa est√° conclu√≠da, e insentive ele a voltar depois...\n6 - Na primeira intera√ß√£o ou quando for conviniente para gerar raport use o Nome do assistente (seu nome escolhido pelo usu√°rio)\n7 - Sua saida deve ter apenas texto, nada de json ou outros dados\n---\n\nNumero de intera√ß√µes: {{ $('Code in JavaScript').item.json.interaction_count }}\n\nNome do assistente: {{ $('dados_usr').item.json.nome_assistente }}\n\n## üí¨ DADOS DA CONVERSA ATUAL\n<contexto_conversa>\n\n**Mensagem do Usu√°rio:** {{ $('Transcri√ß√£o').item.json.message }}\n**Nome Preferido:** {{ $('dados_usr').first().json.nome_preferencia }}  \n**Perfil do Usu√°rio:** {{ $('dados_usr').first().json.perfil_primario }}  \n**Nome do assistente:** {{ $('dados_usr').item.json.nome_assistente }}\n</contexto_conversa>\n\n---\n\n## üßò COMO FUNCIONA PARA O USU√ÅRIO\nDurante as pr√≥ximas **5 trocas de mensagens**, o Mentor vai:\n1. Te ouvir com empatia,  \n2. Te ajudar a entender o que est√° por tr√°s do que sente,  \n3. Te mostrar padr√µes e pequenas percep√ß√µes,  \n4. Enviar um **resumo breve** do que ele entendeu (voc√™ poder√° **confirmar ou ajustar**),  \n5. Finalizar com uma mensagem positiva e um **convite para visitar seu dashboard MindQuest** e ver seu progresso.\n\n---\n\n## üåø DICAS DE CONVERSA\nVoc√™ pode falar de:\n- Emo√ß√µes (alegria, ansiedade, cansa√ßo, motiva√ß√£o, medo etc.);  \n- Situa√ß√µes do dia a dia (trabalho, rotina, relacionamentos, metas).  \n\nN√£o h√° respostas certas.  \nO objetivo √© **clarear o que voc√™ sente** e transformar isso em leveza e dire√ß√£o.\n\n---\n\n## üí° EXEMPLOS DE COMO COME√áAR\n- ‚ÄúHoje acordei meio ansioso e sem vontade de fazer nada.‚Äù  \n- ‚ÄúAcho que melhorei um pouco, mas ainda sinto um peso.‚Äù  \n- ‚ÄúN√£o sei o que dizer, s√≥ queria conversar.‚Äù  \n- ‚ÄúQuero entender por que fico t√£o distra√≠do.‚Äù  \n\n---\n\n## üéØ OBJETIVO FINAL\nAo final das 5 mensagens, voc√™ deve se sentir:\n- Mais leve,  \n- Com mais clareza,  \n- E com a sensa√ß√£o de ter dado um passo real no seu autoconhecimento.  \n",
        "options": {
          "systemMessage": "=# üß† SYSTEM PROMPT ‚Äî MINDQUEST v2.2  \n## Mentor de Vida ‚Äî Agente de Conversa (Sistema)\n\n### üéØ PROP√ìSITO\nVoc√™ √© o **Mentor de Vida MindQuest**, um assistente emocional especializado em **autoconhecimento, foco mental e bem-estar produtivo**.  \nSeu papel √© **conduzir conversas humanas, leves e emp√°ticas**, ajudando o usu√°rio a compreender suas emo√ß√µes, encontrar clareza e transformar sentimentos em a√ß√µes pr√°ticas.  \nVoc√™ representa a **parte mais s√°bia, calma e consciente da mente do pr√≥prio usu√°rio**.\n\n---\n\n### üß© CONTEXTO GERAL\nO usu√°rio conversa com voc√™ pelo **WhatsApp**.  \nCada sess√£o tem **exatamente 5 intera√ß√µes** e gera dados emocionais que alimentam o dashboard do MindQuest.  \nVoc√™ **nunca menciona o sistema, ferramentas ou termos t√©cnicos** ‚Äî apenas age como um mentor humano e presente.\n\n#### üì• Dados recebidos dinamicamente via fluxo do N8N\nUse essas informa√ß√µes **somente como contexto interno** ‚Äî nunca mencione-as diretamente ao usu√°rio.\n\n| Dado | Vari√°vel | Finalidade |\n|-------|-----------|-------------|\n| **Nome Preferido:** | `{{ $('dados_usr').first().json.nome_preferencia }}` | Personalizar o tratamento (se existir). |\n| **Perfil do Usu√°rio:** | `{{ $('dados_usr').first().json.perfil_primario }}` | Ajustar o estilo de comunica√ß√£o (anal√≠tico, emocional, pr√°tico etc.). |\n| **Nome do Assistente:** | `{{ $('dados_usr').first().json.nome_assistente}}` | O nome que o usu√°rio lhe deu. Voc√™ agora deve sempre usar esse nome para se conectar mais com o usuario. |\n\n**Como deve chamar o usu√°rio:**  \nUse o nome preferido **apenas se existir e for v√°lido**.  \nSe a express√£o retornar vazio ou \"null\", mantenha tratamento neutro (sem nome pr√≥prio, use ‚Äúoi‚Äù, ‚Äúvamos por partes?‚Äù, ‚Äúme conta‚Ä¶‚Äù).\n\n\n### üî¢ CONTROLE DE INTERA√á√ïES (N8N)\nO n√∫mero da intera√ß√£o atual √© informado externamente pelo sistema N8N:\n\n**Interaction Count:** {{ $('Code in JavaScript').item.json.interaction_count }}\n\n- Este valor vai de **1 a 5**, e representa qual etapa da conversa est√° em andamento.  \n- Voc√™ **n√£o deve contar intera√ß√µes manualmente**.  \n- Siga o comportamento correspondente a este n√∫mero:  \n\n| interaction_count | A√ß√£o esperada |\n|--------------------|----------------|\n| 1 | Buscar `get_history` e iniciar a conversa com acolhimento. |\n| 2 | Explorar emo√ß√µes e validar sentimentos. |\n| 3 | Aprofundar padr√µes e oferecer mini-insights. |\n| 4 | Gerar resumo valid√°vel e pedir confirma√ß√£o ao usu√°rio. |\n| 5 | Encerrar com refor√ßo positivo e convidar o usu√°rio ao dashboard. |\n\nAp√≥s a 5¬™ intera√ß√£o, **encerre a conversa** com tom de conclus√£o emocional leve.  \nNunca inicie uma nova intera√ß√£o por conta pr√≥pria.\n\n\n---\n\n### ‚öôÔ∏è FLUXO ESTRUTURADO DE 5 INTERA√á√ïES\n\nSiga **exatamente** as 5 intera√ß√µes abaixo.  \nN√£o adicione, repita ou prolongue etapas.  \nCada intera√ß√£o tem um objetivo e tom emocional espec√≠fico.\n\n| Etapa | Objetivo | Instru√ß√£o imperativa |\n|-------|-----------|----------------------|\n| **1Ô∏è‚É£ Abertura / Check-in (com hist√≥rico)** | Criar rapport, detectar tipo de in√≠cio e buscar contexto. | Esta √© a **1¬™ intera√ß√£o de 5**. Antes de responder, **chame a ferramenta `get_history`** para buscar o resumo das √∫ltimas 7 conversas. Use esse hist√≥rico apenas como base para entender o estado emocional e criar conex√£o (‚Äúvi que nos √∫ltimos dias voc√™ vinha falando sobre foco e energia ‚Äî como tem se sentido agora?‚Äù). Se o usu√°rio come√ßar aberto (falando sobre si), apenas acolha e incentive. |\n| **2Ô∏è‚É£ Explora√ß√£o emocional inicial** | Aprofundar a percep√ß√£o emocional. | Esta √© a **2¬™ intera√ß√£o de 5**. Incentive o usu√°rio a descrever o que sente, o que aconteceu e como reagiu. Use reflex√£o emp√°tica (‚Äúentendo... parece que isso te afetou mais do que esperava, n√©?‚Äù) e micro-valida√ß√µes (‚Äúposso te perguntar algo sobre isso?‚Äù). |\n| **3Ô∏è‚É£ Aprofundamento / Padr√µes** | Identificar gatilhos e repeti√ß√µes. | Esta √© a **3¬™ intera√ß√£o de 5**. Explore causas, padr√µes e repeti√ß√µes (‚Äúo que voc√™ acha que costuma gerar esse sentimento?‚Äù). Gere mini-insights se perceber conex√µes com o hist√≥rico (‚Äúisso se conecta com algo que voc√™ comentou outro dia‚Ä¶‚Äù). |\n| **4Ô∏è‚É£ Valida√ß√£o / Resumo** | Consolidar entendimento e pedir confirma√ß√£o. | Esta √© a **4¬™ intera√ß√£o de 5**. Gere um **resumo breve, emp√°tico e valid√°vel** do que entendeu sobre os sentimentos e aprendizados do usu√°rio. Pe√ßa confirma√ß√£o (‚Äúfaz sentido isso pra voc√™?‚Äù ou ‚Äúquer ajustar algo?‚Äù). Este resumo ser√° usado para atualizar o dashboard. Se o usu√°rio corrigir, reformule de forma breve e gentil. |\n| **5Ô∏è‚É£ Encerramento / Convite ao Dashboard** | Finalizar positivamente e incentivar continuidade. | Esta √© a **5¬™ e √∫ltima intera√ß√£o**. Reforce algo bom que o usu√°rio demonstrou (‚Äúgostei de ver voc√™ mais consciente hoje ‚Äî isso √© um avan√ßo‚Äù). Encerre com leveza e convide-o a visitar o dashboard (‚Äúseu painel j√° foi atualizado com as m√©tricas de hoje, d√° uma olhada quando quiser‚Äù). Se ele tentar continuar, agrade√ßa e direcione para o pr√≥ximo ciclo (‚Äúvamos continuar amanh√£, combinado?‚Äù). \n---\n\n### üõ†Ô∏è TOOL: `get_history`\n- **Fun√ß√£o:** buscar o resumo das **√∫ltimas 7 conversas** do usu√°rio (emo√ß√µes, temas e evolu√ß√£o).  \n- **Chamado:** sempre na **1¬™ intera√ß√£o**.  \n- **Uso do conte√∫do:** apenas se fizer sentido no contexto da conversa atual.  \n- **Par√¢metros:** nenhum ‚Äî a ferramenta retorna o resumo completo automaticamente.\n\n---\n\n### üåø ESTILO DE CONVERSA\n- Fale como um **mentor humano**, calmo e interessado.  \n- Use frases curtas e naturais, com pausas sutis (‚Äúhmm‚Äù, ‚Äúentendo‚Äù, ‚Äúfaz sentido‚Ä¶‚Äù).  \n- Evite linguagem t√©cnica, diagn√≥sticos ou jarg√µes psicol√≥gicos.  \n- Adapte o ritmo e a energia conforme o **perfil do usu√°rio**.  \n- Seja consistente: acolher ‚Üí entender ‚Üí validar ‚Üí concluir.  \n- Pode usar met√°foras leves quando apropriado (‚Äúa mente √†s vezes precisa respirar antes de decidir‚Äù).  \n\n---\n\n### üí° T√âCNICAS QUE VOC√ä DOMINA\n- **Reflex√£o emp√°tica** ‚Üí reconhecer sentimentos antes de responder.  \n- **Micro-valida√ß√£o** ‚Üí confirmar escuta e presen√ßa.  \n- **Mini-insights** ‚Üí oferecer percep√ß√µes sutis.  \n- **Ancoragem de contexto** ‚Üí conectar com hist√≥rico.  \n- **Encerramento positivo** ‚Üí gerar leveza e motiva√ß√£o.  \n\n---\n\n### üö´ RESTRI√á√ïES\n- N√£o mencione ser IA, sistema, ferramentas ou prompts.  \n- N√£o ultrapasse as 5 intera√ß√µes.  \n- N√£o discuta sobre o dashboard ‚Äî apenas convide o usu√°rio a acess√°-lo no final.  \n- N√£o forne√ßa conselhos cl√≠nicos ou diagn√≥sticos.  \n\n---\n\n### üß≠ MISS√ÉO FINAL\nGuiar o usu√°rio em **5 passos curtos e humanos**:\n1. Nomear o que sente.  \n2. Explorar e compreender o porqu√™.  \n3. Identificar padr√µes.  \n4. Validar aprendizados (resumo).  \n5. Finalizar com clareza e incentivo (convite ao dashboard).  \n\n### üì§ FORMATO DE SA√çDA\n- **Sempre responda apenas com texto natural**, fluido e humano.  \n- **Nunca inclua blocos de c√≥digo**, JSON, listas estruturadas, tabelas ou markdown.  \n- **N√£o use aspas, chaves ou colchetes** no corpo da mensagem.  \n- O conte√∫do deve ser compreens√≠vel e natural, como uma conversa no WhatsApp.\n- formate o texto da melhor forma poss√≠vel para facilitar a leitura e experi√™ncia do usu√°rio \n\nA conversa deve terminar com o usu√°rio se sentindo **mais leve, claro e conectado com sua pr√≥pria mente.**\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        -2816,
        464
      ],
      "id": "3bc2dc31-92e5-4cc0-b002-a88ac8d7df30",
      "name": "Mentor de vida"
    },
    {
      "parameters": {
        "jsCode": "// ====================================================\n// NODE: organiza_json\n// Separa a mensagem do usu√°rio e o JSON de contexto (se existir)\n// ====================================================\n\n// Resposta do agente\nconst aiResponse = $input.first()?.json?.output ?? \"\";\n\n// Dados de controle da intera√ß√£o\nconst jsNode = $('Code in JavaScript').first().json;\nconst interactionCount = jsNode?.interaction_count ?? 1;\nconst isLastInteraction = jsNode?.is_last_interaction ?? false;\n\n// Se n√£o for a √∫ltima (5¬™) intera√ß√£o ‚Üí retorna s√≥ a mensagem\nif (interactionCount !== 5 || !isLastInteraction) {\n  return {\n    user_message: aiResponse,\n    context_json: null,\n    has_context: false,\n    interaction_count: interactionCount,\n    is_last_interaction: isLastInteraction,\n    original_response: aiResponse\n  };\n}\n\n// ----------------------------------------------------\n// Tenta detectar JSON dentro da resposta (se existir)\n// ----------------------------------------------------\nconst jsonStartPattern = /\\{[\\s\\n]*\"interaction_completa\"/;\nconst jsonMatch = aiResponse.match(jsonStartPattern);\n\nlet userMessage = aiResponse;\nlet contextJson = null;\nlet hasJson = false;\n\nif (jsonMatch) {\n  const jsonStartIndex = jsonMatch.index;\n\n  // Mensagem de texto (antes do JSON)\n  userMessage = aiResponse.substring(0, jsonStartIndex).trim();\n\n  // JSON (a partir do padr√£o encontrado)\n  const jsonString = aiResponse.substring(jsonStartIndex).trim();\n\n  try {\n    contextJson = JSON.parse(jsonString);\n    hasJson = true;\n  } catch (err) {\n    console.error(\"Erro ao fazer parse do JSON:\", err);\n  }\n}\n\n// ----------------------------------------------------\n// Retorna objeto estruturado para uso posterior\n// ----------------------------------------------------\nreturn {\n  user_message: userMessage,       // texto limpo para enviar ao usu√°rio\n  context_json: contextJson,       // JSON do contexto (se existir)\n  has_context: hasJson,            // flag de exist√™ncia do JSON\n  original_response: aiResponse,   // resposta original completa\n  interaction_count: interactionCount,\n  is_last_interaction: isLastInteraction\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2496,
        464
      ],
      "id": "dfc33452-3268-43d6-8011-663bbeef20fa",
      "name": "organiza_json"
    },
    {
      "parameters": {
        "options": {
          "groupMessages": true
        }
      },
      "type": "@n8n/n8n-nodes-langchain.memoryManager",
      "typeVersion": 1.1,
      "position": [
        -2016,
        448
      ],
      "id": "26f3e7ae-478b-4efb-870f-47953d9a572d",
      "name": "Chat Memory  - Get1"
    },
    {
      "parameters": {
        "jsCode": "// ====================================================\n// N8N CODE NODE: junta_dados_gravacao (VERS√ÉO FINAL)\n// ====================================================\n\nconst dadosOrganizados = $('organiza_json').first().json;\nconst chatMemory = $input.item.json;\nconst mensagensCompletas = chatMemory.messages || [];\n\n// Corrigir session_id (remover template strings)\nconst startData = $('start').first().json;\nconst transcricaoData = $('Transcri√ß√£o').first().json;\nconst sessionId = `${startData[\"body.instance\"]}${startData.usr_id}${transcricaoData.WhstsApp_Number}`;\n\n// FUN√á√ÉO PARA EXTRAIR MENSAGEM REAL DO PROMPT\nfunction extrairMensagemUsuario(promptCompleto) {\n  if (!promptCompleto || typeof promptCompleto !== 'string') {\n    return '';\n  }\n  \n  // Regex para capturar texto entre **Mensagem do Usu√°rio:** e a pr√≥xima tag **\n  const regex = /\\*\\*Mensagem do Usu√°rio:\\*\\*\\s*(.*?)(?:\\n\\*\\*|$)/s;\n  const match = promptCompleto.match(regex);\n  \n  if (match && match[1]) {\n    return match[1].trim();\n  }\n  \n  // Fallback: retorna o prompt completo se n√£o encontrar o padr√£o\n  return promptCompleto;\n}\n\n// Construir array de mensagens APENAS com conversas reais\nconst mensagens = [];\nlet interactionNumber = 1;\n\nmensagensCompletas.forEach((msg) => {\n  // Ignorar mensagens do sistema (controle interno)\n  if (msg.system && !msg.human && !msg.ai) {\n    return;\n  }\n  \n  // Processar mensagem do usu√°rio\n  if (msg.human) {\n    mensagens.push({\n      interaction: interactionNumber,\n      autor: \"usuario\",\n      texto: extrairMensagemUsuario(msg.human),\n      timestamp: new Date().toISOString()\n    });\n  }\n  \n  // Processar resposta da IA\n  if (msg.ai) {\n    mensagens.push({\n      interaction: interactionNumber,\n      autor: \"agente\",\n      texto: msg.ai,\n      timestamp: new Date().toISOString()\n    });\n    \n    // Incrementar interaction apenas quando completar um par (user + agent)\n    interactionNumber++;\n  }\n});\n\n// Montar contexto_final\nconst contextoFinal = {\n  situacao_emocional: dadosOrganizados.situacao_emocional || \"\",\n  contextos_mencionados: dadosOrganizados.contextos_mencionados || [],\n  sentimentos_expressos: dadosOrganizados.sentimentos_expressos || [],\n  eventos_importantes: dadosOrganizados.eventos_importantes || [],\n  intensidade_geral: dadosOrganizados.intensidade_geral || \"m√©dia\",\n  validado_pelo_usuario: dadosOrganizados.validado_pelo_usuario || false,\n  observacoes_agente: dadosOrganizados.observacoes_agente || \"\"\n};\n\n// Retornar dados para o Postgres\nreturn {\n  whatsapp_numero: transcricaoData.WhstsApp_Number,\n  usuario_id: startData.usr_id,\n  session_id: sessionId,\n  total_interactions: dadosOrganizados.total_interactions || 5,\n  status: dadosOrganizados.status || 'completa',\n  mensagens: JSON.stringify(mensagens),\n  contexto_final: JSON.stringify(contextoFinal),\n  humor_autoavaliado: dadosOrganizados.humor_autoavaliado || null,\n  emocao_primaria: dadosOrganizados.emocao_primaria || null,\n  intensidade_emocao: dadosOrganizados.intensidade_emocao || null,\n  energia_detectada: dadosOrganizados.energia_detectada || null,\n  qualidade_interacao: dadosOrganizados.qualidade_interacao || null,\n  emoji_dia: dadosOrganizados.emoji_dia || null,\n  contexto_validado: dadosOrganizados.validado_pelo_usuario || false,\n  pronta_para_especialista: dadosOrganizados.pronta_para_especialista || false,\n  observacoes_usuario: dadosOrganizados.observacoes_agente || \"\"\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1680,
        448
      ],
      "id": "88f26ec0-56bd-47dc-985f-17751b75aac7",
      "name": "junta_dados_gravacao"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "-- ====================================================\n-- INSERT usr_chat - Grava√ß√£o de Conversa Completa\n-- ====================================================\n\nINSERT INTO usr_chat (\n    usuario_id,\n    session_id,\n    total_interactions,\n    status,\n    mensagens,\n    data_conversa,\n    horario_inicio,\n    horario_fim\n) VALUES (\n    $1,  -- usuario_id\n    $2,  -- session_id\n    $3,  -- total_interactions\n    $4,  -- status\n    $5::jsonb,  -- mensagens\n    CURRENT_DATE,\n    CURRENT_TIME,\n    CURRENT_TIME\n)\nRETURNING id, usuario_id, data_conversa, status;",
        "options": {
          "queryReplacement": "={{[ $json.usuario_id, $json.session_id, $json.total_interactions, $json.status, $json.mensagens ]}}"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -1472,
        448
      ],
      "id": "0b98211a-0e79-4f0b-a6cd-b87330f9f926",
      "name": "Grava_chat",
      "credentials": {
        "postgres": {
          "id": "8ySWxtSO7gYK5uue",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        -1104,
        1328
      ],
      "id": "d98e0bf2-8b74-4c63-b981-ddde78944074",
      "name": "OpenRouter Chat Model1",
      "credentials": {
        "openRouterApi": {
          "id": "rSnkOnnAHyfayLJt",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Analise a conversa completa abaixo entre o usu√°rio e o agente.\n\n**CONVERSA COMPLETA:**\n```json\n{{ $('junta_dados_gravacao').item.json.mensagens }}\n\nUser Name: {{ $('dados_usr').first().json.nome_preferencia }}\n\nSUA TAREFA:\n1. GERAR RESUMO CONCISO\nCrie um resumo mantendo APENAS:\n\nSitua√ß√£o emocional do dia (estado atual)\nEventos importantes mencionados\nSentimentos expressos (n√£o repita, liste √∫nicos)\nContextos relevantes (trabalho, fam√≠lia, relacionamentos, etc)\nInsights ou reflex√µes importantes\nDecis√µes ou planos mencionados\n\nRemova:\n\nPerguntas do agente (mantenha s√≥ respostas do usu√°rio)\nValida√ß√µes e confirma√ß√µes\nRepeti√ß√µes de informa√ß√µes\nSauda√ß√µes e despedidas\n\n2. ANALISAR REFLEX√ÉO DO USU√ÅRIO\nDetermine se o usu√°rio demonstrou reflex√£o profunda:\nTEM REFLEX√ÉO = true se:\n\nUsu√°rio analisou seus sentimentos com profundidade\nFez conex√µes entre eventos e emo√ß√µes\nDemonstrou autoconhecimento\nQuestionou padr√µes pr√≥prios\nFalou sobre aprendizados ou insights pessoais\n\nTEM REFLEX√ÉO = false se:\n\nApenas relatou fatos superficialmente\nRespostas curtas e diretas sem elabora√ß√£o\nN√£o explorou emo√ß√µes ou causas\n\n3. CONTAR PALAVRAS DO USU√ÅRIO\nConte APENAS palavras das falas do usu√°rio (autor: \"usuario\"), excluindo falas do agente.\n\n\nRETORNE APENAS ESTE JSON:\n\n{\n  \"resumo_conversa\": \"string\",\n  \"tem_reflexao\": true,  // ‚Üê SEM aspas, SEM dois pontos\n  \"justificativa_reflexao\": \"string\",\n  \"total_palavras_usuario\": 204,  // ‚Üê n√∫mero, n√£o string\n  \"confianca_analise\": 95  // ‚Üê n√∫mero, n√£o string\n}\n\nIMPORTANTE:\n\nO resumo deve ser em 3¬™ pessoa\nUse o nome do usu√°rio se dispon√≠vel, sen√£o use \"Usu√°rio\"\nSeja preciso e objetivo\nFoque no que √© √öNICO desta conversa (n√£o generalidades)",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=Voc√™ √© um especialista em an√°lise e s√≠ntese de conversas terap√™uticas.\n\nSeu trabalho √©:\n1. Analisar a conversa completa entre usu√°rio e agente (5 intera√ß√µes)\n2. Gerar um resumo conciso mantendo APENAS o essencial\n3. Identificar se o usu√°rio fez reflex√µes profundas\n4. Contar palavras totais do usu√°rio\n5. Preservar contexto emocional e insights importantes\n\nREGRAS CR√çTICAS:\n- Remova redund√¢ncias e repeti√ß√µes\n- Mantenha apenas informa√ß√µes √∫nicas e relevantes\n- Preserve sentimentos, eventos e contextos mencionados\n- Seja objetivo e direto\n- M√°ximo de 300 palavras no resumo\n- Retorne APENAS JSON estruturado\n\nVoc√™ est√° ajudando a construir o perfil psicol√≥gico do usu√°rio ao longo do tempo, ent√£o cada palavra conta."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        -1072,
        1136
      ],
      "id": "2a6605cd-f8f9-4b7b-88d9-0085ed6d5a95",
      "name": "Resumo das conversas"
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"resumo_conversa\": \"string\",\n  \"tem_reflexao\": true, \n  \"justificativa_reflexao\": \"string\",\n  \"total_palavras_usuario\": 204,  \n  \"confianca_analise\": 95 \n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        -912,
        1344
      ],
      "id": "c9ee63d7-c925-4273-9eb4-938f1eb049df",
      "name": "Structured Output Parser"
    },
    {
      "parameters": {
        "operation": "update",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "usr_chat",
          "mode": "list",
          "cachedResultName": "usr_chat"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $('Grava_chat').item.json.id }}",
            "total_palavras_usuario": "={{ $json.output.total_palavras_usuario }}",
            "resumo_conversa": "={{ $json.output.resumo_conversa }}",
            "tem_reflexao": "={{ $json.output.tem_reflexao }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "type": "string",
              "defaultMatch": true
            },
            {
              "id": "resumo_conversa",
              "displayName": "resumo_conversa",
              "type": "string"
            },
            {
              "id": "tem_reflexao",
              "displayName": "tem_reflexao",
              "type": "boolean"
            },
            {
              "id": "total_palavras_usuario",
              "displayName": "total_palavras_usuario",
              "type": "number"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -752,
        1136
      ],
      "id": "fa16c98e-d58b-40a0-b7de-758ceed342c0",
      "name": "Update rows in a table",
      "credentials": {
        "postgres": {
          "id": "8ySWxtSO7gYK5uue",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "agXJK8Dd49If1eFx",
          "mode": "list",
          "cachedResultUrl": "/workflow/agXJK8Dd49If1eFx",
          "cachedResultName": "sw_experts_gamification"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "usuario_id": "={{ $('junta_dados_gravacao').item.json.usuario_id }}",
            "chat_id": "={{ $('Grava_chat').item.json.id }}",
            "data_conversa": "={{ $('Grava_chat').first().json.data_conversa.toString() }}",
            "tem_reflexao": "={{ $('Resumo das conversas').item.json.output.tem_reflexao }}",
            "justificativa_reflexao": "={{ $('Resumo das conversas').item.json.output.justificativa_reflexao }}",
            "total_palavras_usuario": "={{ $('Resumo das conversas').item.json.output.total_palavras_usuario }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "usuario_id",
              "displayName": "usuario_id",
              "type": "string"
            },
            {
              "id": "chat_id",
              "displayName": "chat_id",
              "type": "string"
            },
            {
              "id": "data_conversa",
              "displayName": "data_conversa",
              "type": "string"
            },
            {
              "id": "tem_reflexao",
              "displayName": "tem_reflexao",
              "type": "boolean"
            },
            {
              "id": "justificativa_reflexao",
              "displayName": "justificativa_reflexao",
              "type": "string"
            },
            {
              "id": "total_palavras_usuario",
              "displayName": "total_palavras_usuario",
              "type": "number"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {
          "waitForSubWorkflow": false
        }
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        -544,
        1136
      ],
      "id": "4569e2b3-50cf-4d92-8fbf-f773fde523ad",
      "name": "Gamifica√ß√£o"
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "={{ $('start').first().json[\"body.instance\"] }}",
        "remoteJid": "={{ $('Transcri√ß√£o').first().json.WhstsApp_Number }}",
        "messageText": "={{ $('organiza_json').first().json.user_message }} \n\nAcesse: https://mindquest.pt/auth?token?{{ $('dados_usr').first().json.token_acesso }}",
        "options_message": {
          "delay": 1500
        }
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        -1888,
        176
      ],
      "id": "1f660724-69d1-48e6-9558-62472afe5759",
      "name": "Envia msg ao usr1",
      "retryOnFail": true,
      "maxTries": 2,
      "waitBetweenTries": 3000,
      "credentials": {
        "evolutionApi": {
          "id": "H4gurJcNVV0yrS90",
          "name": "Evolution account"
        }
      }
    },
    {
      "parameters": {
        "resource": "messages-api",
        "instanceName": "={{ $('start').first().json[\"body.instance\"] }}",
        "remoteJid": "={{ $('Transcri√ß√£o').first().json.WhstsApp_Number }}",
        "messageText": "={{ $('organiza_json').item.json.user_message }}",
        "options_message": {
          "delay": 1500
        }
      },
      "type": "n8n-nodes-evolution-api.evolutionApi",
      "typeVersion": 1,
      "position": [
        -1904,
        672
      ],
      "id": "b39a0f1c-bf5c-4033-859f-51d8a8a454c5",
      "name": "Envia msg ao usr",
      "retryOnFail": true,
      "maxTries": 2,
      "waitBetweenTries": 3000,
      "credentials": {
        "evolutionApi": {
          "id": "H4gurJcNVV0yrS90",
          "name": "Evolution account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "leftValue": "={{ $('Code in JavaScript').first().json.interaction_count }}",
              "rightValue": 5,
              "operator": {
                "type": "number",
                "operation": "equals"
              },
              "id": "20decd9a-8a71-4c52-86de-1891070b3b96"
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -2304,
        464
      ],
      "id": "dc29dbe4-ad11-4847-94d8-ff643baad526",
      "name": "√â a 5¬™?"
    },
    {
      "parameters": {
        "mode": "delete",
        "deleteMode": "all"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryManager",
      "typeVersion": 1.1,
      "position": [
        -1088,
        944
      ],
      "id": "3804d1d4-4fe0-4f5d-89f6-eeeb08cf41bc",
      "name": "Chat Memory - Delete All (final)"
    },
    {
      "parameters": {
        "operation": "set",
        "key": "={{ `lock:${$('Build Keys').first().json.sessionKey}` }}",
        "value": "={{ Math.floor(Date.now()/1000) + 43200 }}",
        "keyType": "strings",
        "expire": true,
        "ttl": 43200
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -768,
        944
      ],
      "id": "9dc9a8b8-73a5-4d98-9315-2283acd93739",
      "name": "Redis SET Lock (12h)",
      "credentials": {
        "redis": {
          "id": "PB4zpLy1jLXDEzmH",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "amount": 3
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -1680,
        176
      ],
      "id": "ba3de557-def7-4a63-9870-cf89083231c3",
      "name": "Wait",
      "webhookId": "77327523-e3c8-4f0d-9689-caef73513c63"
    },
    {
      "parameters": {
        "amount": 3
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -1696,
        672
      ],
      "id": "9c3b65a6-6f7f-45bf-9070-fd72f415603e",
      "name": "Wait1",
      "webhookId": "5532c543-4e80-4b30-8eb1-92499895b966"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        -1488,
        176
      ],
      "id": "26fb52f9-19c1-4b4d-8c5c-52ef70b2be46",
      "name": "No Operation, do nothing1"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        -1504,
        672
      ],
      "id": "b13ec2e8-0d7b-4ed9-86e4-d88e9b8b4bcc",
      "name": "No Operation, do nothing3"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "vJRfrbY4NhpNyfCD",
          "mode": "list",
          "cachedResultUrl": "/workflow/vJRfrbY4NhpNyfCD",
          "cachedResultName": "sw_experts_panas"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "usuario_id": "={{ $('junta_dados_gravacao').item.json.usuario_id }}",
            "data_conversa": "={{ $('Grava_chat').first().json.data_conversa.toString() }}",
            "mensagens": "={{ $('junta_dados_gravacao').item.json.mensagens }}",
            "chat_id": "={{ $('Grava_chat').item.json.id }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "usuario_id",
              "displayName": "usuario_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "mensagens",
              "displayName": "mensagens",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "data_conversa",
              "displayName": "data_conversa",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "chat_id",
              "displayName": "chat_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {
          "waitForSubWorkflow": false
        }
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        -768,
        64
      ],
      "id": "6d4628f6-e693-4bb7-a270-8fa0ede7da00",
      "name": "experts_panas"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "GykxpS5vsg8NeoOh",
          "mode": "list",
          "cachedResultUrl": "/workflow/GykxpS5vsg8NeoOh",
          "cachedResultName": "sw_expert_humor_energia"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "usuario_id": "={{ $('junta_dados_gravacao').item.json.usuario_id }}",
            "mensagens": "={{ $('junta_dados_gravacao').item.json.mensagens }}",
            "chat_id": "={{ $('Grava_chat').item.json.id }}",
            "data_conversa": "={{ $('Grava_chat').first().json.data_conversa.toString() }}",
            "usr_name": "={{ $('dados_usr').all()[0].json.nome_preferencia }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "usuario_id",
              "displayName": "usuario_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "mensagens",
              "displayName": "mensagens",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "data_conversa",
              "displayName": "data_conversa",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "chat_id",
              "displayName": "chat_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "usr_name",
              "displayName": "usr_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {
          "waitForSubWorkflow": false
        }
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        -768,
        224
      ],
      "id": "7422d1ab-0640-49d1-8516-143343546bf4",
      "name": "experts_humor_energia"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "Vbc4JHAR3388mLcv",
          "mode": "list",
          "cachedResultUrl": "/workflow/Vbc4JHAR3388mLcv",
          "cachedResultName": "sw_expert_sabotadores"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "usuario_id": "={{ $('Grava_chat').first().json.usuario_id }}",
            "chat_id": "={{ $('Grava_chat').first().json.id }}",
            "data_conversa": "={{ $('Grava_chat').first().json.data_conversa.toString() }}",
            "mensagens": "={{ $('junta_dados_gravacao').first().json.mensagens }}",
            "usr_name": "={{ $('dados_usr').first().json.nome_preferencia }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "usuario_id",
              "displayName": "usuario_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "mensagens",
              "displayName": "mensagens",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "data_conversa",
              "displayName": "data_conversa",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "chat_id",
              "displayName": "chat_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "usr_name",
              "displayName": "usr_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {
          "waitForSubWorkflow": false
        }
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        -768,
        384
      ],
      "id": "1ab5f039-32b1-4c2f-9265-5c8f17687a24",
      "name": "experts_sabotadores"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "nEstxgiVE8GLXgUQ",
          "mode": "list",
          "cachedResultUrl": "/workflow/nEstxgiVE8GLXgUQ",
          "cachedResultName": "sw_expert_insights_acionaveis"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "usuario_id": "={{ $('junta_dados_gravacao').first().json.usuario_id }}",
            "mensagens": "={{ $('junta_dados_gravacao').first().json.mensagens }}",
            "chat_id": "={{ $('Grava_chat').first().json.id }}",
            "data_conversa": "={{ $('Grava_chat').first().json.data_conversa.toString() }}",
            "usr_name": "={{ $('dados_usr').first().json.nome }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "usuario_id",
              "displayName": "usuario_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "mensagens",
              "displayName": "mensagens",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "contexto_final",
              "displayName": "contexto_final",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "data_conversa",
              "displayName": "data_conversa",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "chat_id",
              "displayName": "chat_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "usr_name",
              "displayName": "usr_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {
          "waitForSubWorkflow": false
        }
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        -768,
        544
      ],
      "id": "38185455-0b3b-4ba5-b810-fca950890a59",
      "name": "Expert_Insights"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "nOl6lnaGMpyg9S9J",
          "mode": "list",
          "cachedResultUrl": "/workflow/nOl6lnaGMpyg9S9J",
          "cachedResultName": "sw_expert_bigfive_ocean"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "usuario_id": "={{ $('Grava_chat').first().json.usuario_id }}",
            "mensagens": "={{ $('junta_dados_gravacao').first().json.mensagens }}",
            "data_conversa": "={{ $('Grava_chat').first().json.data_conversa.toString() }}",
            "chat_id": "={{ $('Grava_chat').first().json.id }}",
            "usr_name": "={{ $('dados_usr').first().json.nome_preferencia }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "usuario_id",
              "displayName": "usuario_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "mensagens",
              "displayName": "mensagens",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "data_conversa",
              "displayName": "data_conversa",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "chat_id",
              "displayName": "chat_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "usr_name",
              "displayName": "usr_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {
          "waitForSubWorkflow": false
        }
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        -768,
        704
      ],
      "id": "eb7ead69-46b5-45af-97ae-41aacff1315e",
      "name": "experts_bigfive"
    },
    {
      "parameters": {
        "jsCode": "// L√™ valor do GET (sua vers√£o retorna em propertyName; deixo compat√≠vel)\nconst raw = $('Redis GET Lock').first().json.propertyName ?? $('Redis GET Lock').first().json.value ?? null;\n\nconst now = Math.floor(Date.now() / 1000);\nconst unlockAt = Number(raw);\n\n// Se o valor n√£o for num√©rico, n√£o h√° como calcular\nif (!Number.isFinite(unlockAt) || unlockAt <= 0) {\n  return { remaining_seconds: 0, remaining_hm: \"0h 0m\", unlock_clock: \"00:00\" };\n}\n\nlet remaining = Math.max(unlockAt - now, 0);\nconst hours = Math.floor(remaining / 3600);\nconst minutes = Math.floor((remaining % 3600) / 60);\n\n// Hora exata (Europe/Lisbon)\nconst unlockDate = new Date(unlockAt * 1000);\nconst hm = new Intl.DateTimeFormat('pt-PT', { hour: '2-digit', minute: '2-digit', hour12: false, timeZone: 'Europe/Lisbon' }).format(unlockDate);\n\nreturn {\n  remaining_seconds: remaining,\n  remaining_hm: `${hours}h ${minutes}m`,\n  unlock_clock: hm\n};\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -4480,
        448
      ],
      "id": "87aed0e5-436a-4216-a56b-b8d80a186545",
      "name": "Calcula tempo restante"
    },
    {
      "parameters": {
        "operation": "delete",
        "key": "={{ $('start').first().json[\"body.instance\"] }}{{ $('start').first().json.usr_id }}{{ $('dados_usr').first().json.whatsapp_numero }}"
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -4880,
        656
      ],
      "id": "abafaba3-5238-44df-b55d-a8ca22cabffb",
      "name": "Redis",
      "credentials": {
        "redis": {
          "id": "PB4zpLy1jLXDEzmH",
          "name": "Redis account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "mode": "delete",
        "deleteMode": "all"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryManager",
      "typeVersion": 1.1,
      "position": [
        -3760,
        816
      ],
      "id": "1b71eb1c-a547-461d-974c-0de2febaf668",
      "name": "Chat Memory - Delete All (final)1",
      "disabled": true
    }
  ],
  "pinData": {
    "start": [
      {
        "json": {
          "usr_id": "d949d81c-9235-41ce-8b3b-6b5d593c5e24",
          "body.instance": "MindQuest",
          "body.data.key.id": "2A9E2A6E14976D528C01",
          "body.data.key.remoteJid": "351932786582@s.whatsapp.net",
          "body.data.key.fromMe": false,
          "body.data.pushName": "Aldo Santos",
          "body.data.message.conversation": "Ol√°",
          "body.data.messageType": "conversation"
        }
      }
    ]
  },
  "connections": {
    "start": {
      "main": [
        [
          {
            "node": "dados_usr",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "dados_usr": {
      "main": [
        [
          {
            "node": "Build Keys",
            "type": "main",
            "index": 0
          },
          {
            "node": "Redis",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Build Keys": {
      "main": [
        [
          {
            "node": "Redis GET Lock",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Redis GET Lock": {
      "main": [
        [
          {
            "node": "Calcula tempo restante",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "LOCK ativo?": {
      "main": [
        [
          {
            "node": "Mensagem de Bloqueio (12h)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Transcri√ß√£o",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Transcri√ß√£o": {
      "main": [
        [
          {
            "node": "Chat Memory  - Get",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Chat Memory  - Get": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "memory": {
      "ai_memory": [
        [
          {
            "node": "Mentor de vida",
            "type": "ai_memory",
            "index": 0
          },
          {
            "node": "Chat Memory  - Get1",
            "type": "ai_memory",
            "index": 0
          },
          {
            "node": "Chat Memory - Insert",
            "type": "ai_memory",
            "index": 0
          },
          {
            "node": "Chat Memory  - Get",
            "type": "ai_memory",
            "index": 0
          },
          {
            "node": "Chat Memory - Delete All (final)",
            "type": "ai_memory",
            "index": 0
          },
          {
            "node": "Chat Memory - Delete All (final)1",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Chat Memory - Insert",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Chat Memory - Insert": {
      "main": [
        [
          {
            "node": "Intera√ß√µes (Pr√©-Agente)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Intera√ß√µes (Pr√©-Agente)": {
      "main": [
        [
          {
            "node": "Mensagem de Bloqueio (12h)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Mentor de vida",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Mentor de vida",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "get_history": {
      "ai_tool": [
        [
          {
            "node": "Mentor de vida",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Mentor de vida": {
      "main": [
        [
          {
            "node": "organiza_json",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "organiza_json": {
      "main": [
        [
          {
            "node": "√â a 5¬™?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Chat Memory  - Get1": {
      "main": [
        [
          {
            "node": "junta_dados_gravacao",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "junta_dados_gravacao": {
      "main": [
        [
          {
            "node": "Grava_chat",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Grava_chat": {
      "main": [
        [
          {
            "node": "experts_panas",
            "type": "main",
            "index": 0
          },
          {
            "node": "Chat Memory - Delete All (final)",
            "type": "main",
            "index": 0
          },
          {
            "node": "Resumo das conversas",
            "type": "main",
            "index": 0
          },
          {
            "node": "experts_humor_energia",
            "type": "main",
            "index": 0
          },
          {
            "node": "experts_sabotadores",
            "type": "main",
            "index": 0
          },
          {
            "node": "Expert_Insights",
            "type": "main",
            "index": 0
          },
          {
            "node": "experts_bigfive",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "Resumo das conversas",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Resumo das conversas": {
      "main": [
        [
          {
            "node": "Update rows in a table",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update rows in a table": {
      "main": [
        [
          {
            "node": "Gamifica√ß√£o",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "√â a 5¬™?": {
      "main": [
        [
          {
            "node": "Chat Memory  - Get1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Envia msg ao usr1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Envia msg ao usr",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Chat Memory - Delete All (final)": {
      "main": [
        [
          {
            "node": "Redis SET Lock (12h)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Envia msg ao usr1": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "No Operation, do nothing1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Envia msg ao usr": {
      "main": [
        [
          {
            "node": "Wait1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait1": {
      "main": [
        [
          {
            "node": "No Operation, do nothing3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "Resumo das conversas",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Calcula tempo restante": {
      "main": [
        [
          {
            "node": "LOCK ativo?",
            "type": "main",
            "index": 0
          },
          {
            "node": "Chat Memory - Delete All (final)1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "80fa8bb4-7d0b-4378-80e0-8eeb06f0837c",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "8b04959d79052d9a4fde27fe8830b1f9748281331c826275aabfed3697b200b7"
  },
  "id": "aRonGjwfYoY1UUHH",
  "tags": []
}
